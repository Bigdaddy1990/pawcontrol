# .github/workflows/ruff-baseline.yml
name: Ruff baseline (web only)
on: { workflow_dispatch: {} }
permissions: { contents: write, pull-requests: write }
env:
  PYTHON_VERSION: ${{ vars.PYTHON_VERSION != '' && vars.PYTHON_VERSION || '3.14' }}
jobs:
  baseline:
    if: >-
      ${{
        github.event_name == 'workflow_dispatch' && (
          (vars.RUFF_BASELINE_ALLOWLIST == '' && github.actor == github.repository_owner) ||
          (vars.RUFF_BASELINE_ALLOWLIST != '' && contains(format(',{0},', vars.RUFF_BASELINE_ALLOWLIST), format(',{0},', github.actor)))
        )
      }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: actions/setup-python@v6.2.0
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      - run: python -m pip install --upgrade pip ruff prek pyupgrade flake8-type-checking

      - run: |

          ruff check . --fix || true
          ruff check . --fix --unsafe-fixes || true
          ruff check . --add-noqa || true
          ruff check . --extend-select RUF100 --fix || true
          ruff check . --output-format=github || true
          ruff format
          python scripts/enforce_docstring_baseline.py --update
          python scripts.sync_contributor_guides.py --update
          python scripts.enforce_test_requirements.py --update
          python scripts.sync_localization_flags.py \
            --allowlist scripts/sync_localization_flags.allowlist \
            --check
          pre-commit run --all-files || true
          pre-commit run --hook-stage manual python-typing-update --all-files || true

      - uses: peter-evans/create-pull-request@v8
        with:
          branch: chore/ruff-baseline
          title: "chore: ruff baseline (format+fix+noqa)"
          commit-message: "chore: ruff baseline (format+fix+noqa)"
          body: "Automated ruff baseline via GitHub Actions."
