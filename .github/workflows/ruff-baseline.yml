# .github/workflows/ruff-baseline.yml
name: Ruff baseline (web only)
on: { workflow_dispatch: {} }
permissions: { contents: write, pull-requests: write, actions: write, checks: write }
env:
  PYTHON_VERSION: ${{ vars.PYTHON_VERSION != '' && vars.PYTHON_VERSION || '3.14' }}
jobs:
  baseline:
    if: >-
      ${{
        github.event_name == 'workflow_dispatch' && (
          (vars.RUFF_BASELINE_ALLOWLIST == '' && github.actor == github.repository_owner) ||
          (vars.RUFF_BASELINE_ALLOWLIST != '' && contains(format(',{0},', vars.RUFF_BASELINE_ALLOWLIST), format(',{0},', github.actor)))
        )
      }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v6
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      - uses: astral-sh/ruff-action@v3
      - run: python -m pip install --upgrade pip ruff pre-commit

      - run: |
          ruff check . --fix-all|| true
          ruff check . --fix --unsafe-fixes || true
          ruff check . --extend-select RUF100 --fix || true
          ruff check . --output-format=github || true
          ruff format
          pre-commit run --all-files --allow-missing-config || true
          pre-commit run --hook-stage manual python-typing-update --all-files --py314-plus --allow-missing-config || true
          python scripts/enforce_docstring_baseline.py --update
          python scripts.sync_contributor_guides.py --update
          python scripts.enforce_test_requirements.py --update
          python scripts.sync_localization_flags.py \
            --allowlist scripts/sync_localization_flags.allowlist \
            --check

      - uses: peter-evans/create-pull-request@v8
        with:
          branch: chore/ruff-baseline
          title: "chore: ruff baseline (format+fix+noqa)"
          commit-message: "chore: ruff baseline (format+fix+noqa)"
          body: "Automated ruff baseline via GitHub Actions."

#name: Ruff
#on: [ push, pull_request ]
#jobs:
#  ruff:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v4
#      - uses: astral-sh/ruff-action@v3
