# .github/workflows/ruff-baseline.yml
name: Ruff baseline (web only)
on: { workflow_dispatch: {} }
permissions: { contents: write, pull-requests: write }
env:
  PYTHON_VERSION: ${{ vars.PYTHON_VERSION != '' && vars.PYTHON_VERSION || '3.13' }}
jobs:
  baseline:
    if: >-
      ${{
        github.event_name == 'workflow_dispatch' && (
          (vars.RUFF_BASELINE_ALLOWLIST == '' && github.actor == github.repository_owner) ||
          (vars.RUFF_BASELINE_ALLOWLIST != '' && contains(format(',{0},', vars.RUFF_BASELINE_ALLOWLIST), format(',{0},', github.actor)))
        )
      }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v6
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      - run: python -m pip install --upgrade pip ruff
      - run: |
          ruff check . --fix all || true
          ruff check . --fix --unsafe-fixes || true
          ruff check . --add-noqa || true
          ruff check . --extend-select RUF100 --fix || true
          python scripts/enforce_docstring_baseline.py --update
      - uses: peter-evans/create-pull-request@v8
        with:
          branch: chore/ruff-baseline
          title: "chore: ruff baseline (format+fix+noqa)"
          commit-message: "chore: ruff baseline (format+fix+noqa)"
          body: "Automated ruff baseline via GitHub Actions."

#name: Ruff
#on: [ push, pull_request ]
#jobs:
#  ruff:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v4
#      - uses: astral-sh/ruff-action@v3
