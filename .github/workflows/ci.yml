name: CI

on:
  push:
  pull_request:
  workflow_dispatch:

concurrency:
  group: ci-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  id-token: write

jobs:
  hassfest:
    name: Hassfest
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6
      - uses: home-assistant/actions/hassfest@master

  hacs:
    name: HACS Validation
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6
      - uses: hacs/action@main
        with:
          category: integration
          ignore: brands
          repository: ${{ github.repository }}

  tests:
    name: Tests (Python 3.14)
    uses: ./.github/workflows/reusable-python-tests.yml
    secrets: inherit
    with:
      python-version: "3.14"
      run-codecov: true
      upload-coverage-artifact: true
      coverage-artifact-name: ci-coverage-report
      upload-junit-artifact: true
      junit-artifact-name: ci-junit-report
      publish-pages: false
