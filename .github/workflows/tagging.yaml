name: Auto Version Tag

on:
   push:
     paths:
       - 'custom_components/pawcontrol/manifest.json'

permissions:
   contents: write

jobs:
   tag_version:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v6.0.2
         with:
           fetch-depth: 0

       - name: Extract version
         id: get_version
         run: |
           VERSION=$(jq -r .version custom_components/pawcontrol/manifest.json)
           echo "VERSION=$VERSION" >> "$GITHUB_ENV"

       - name: Create Git Tag
         run: |
           git config user.name "github-actions"
           git config user.email "github-actions@github.com"
           git tag "v${VERSION}" 2>/dev/null || echo "Tag already exists."
           git push origin "v${VERSION}" || echo "Push failed or tag already exists."
