# Development plan

## Qualitäts-Gate-Erwartungen
- ✅ `ruff check` – Config-Flow-Basisvalidierung und getypte Feeding-Defaults bleiben lint-frei.【F:custom_components/pawcontrol/config_flow_base.py†L208-L289】【F:custom_components/pawcontrol/types.py†L1659-L1735】【e4ef32†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_base.py tests/unit/test_config_flow_modules.py -q` – Neue Regressionstests decken Name-Validierung und Feeding-Defaults für den Basis-Flow ab.【F:tests/unit/test_config_flow_base.py†L30-L72】【9a2e0a†L1-L10】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – IntegrationNameValidationResult und FeedingSizeDefaults integrieren sich sauber in die Config-Flows.【F:custom_components/pawcontrol/types.py†L1659-L1735】【F:custom_components/pawcontrol/config_flow_base.py†L208-L289】【fc4916†L1-L1】
- ✅ `ruff check` – Config-Flow-TypedDicts und Platzhalter-Builder bleiben lint-frei.【F:custom_components/pawcontrol/config_flow_modules.py†L137-L249】【639e2d†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py -q` – Neue Konfigurationshelfer-Tests sichern Module-, Dashboard- und Feeding-Coercion ab.【F:tests/unit/test_config_flow_modules.py†L5-L142】【5e0bad†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Abhängigkeiten für die Config-Flow-Tests nötig.【c8a4ff†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Config-Flow-Mixe akzeptieren die typisierten Eingaben für Module-, Dashboard- und Feeding-Schritte konsistent.【F:custom_components/pawcontrol/config_flow.py†L1997-L2010】【F:custom_components/pawcontrol/config_flow_dogs.py†L1831-L1884】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L123-L216】【612438†L1-L1】
- ✅ `ruff check` – DateTypedDict-Refactor und neue Tests bleiben lint-frei.【f667a9†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_date_entities.py -q` – Date-Entitäten liefern getypte Attribute und Health-Snapshots ohne Regressionen.【e58016†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Abhängigkeiten für die Date-Entitätstests erforderlich.【7eca04†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – DateExtraAttributes und DogProfileSnapshot bestehen die Typprüfung.【75fa10†L1-L1】
- ✅ `ruff check` – Binärsensor-TypedDicts und numerische Guards laufen lint-frei nach der Union-Umstellung.【be2438†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_binary_sensor.py -q` – Walk-, GPS-, Feeding- und Garden-Binärsensoren liefern strukturierte Attribute ohne Regressionen.【e92846†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Pakete für die Binärsensor-Regressionstests erforderlich.【96fb44†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – die Binärsensor-Helfer bestehen die strengen Typprüfungen nach den neuen Guards.【253fe8†L1-L1】
- ✅ `ruff check` – Runtime-Performance-TypedDicts und Stat-Helper bestehen den Import- und Snapshot-Refactor ohne Lint-Verstöße.【719e80†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_services.py -q` – Daily-Reset- und Service-Telemetrie halten die neuen Performance-Buckets stabil.【c1e461†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_system_health.py -q` – System-Health-Diagnostik konsumiert die typisierten Runtime-Stats ohne Regressionen.【7e89d0†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_generator.py -q` – Dashboard-Metriken nutzen die getypten Performance-Exporte erfolgreich.【802505†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_diagnostics.py -q` – Diagnostikoberflächen lesen die strukturierten Performance-Statistiken korrekt.【d08e52†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – RuntimePerformanceStats und die neuen Helper bestehen die strengen Typanforderungen.【1dd0c3†L1-L1】
- ✅ `ruff check` – Button-Telemetrie und Cache-Helfer bleiben lint-frei nach der neuen TypedDict-Integration.【ab2ddb†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_all_platforms.py -q` – Button-Plattform und Garden-Steuerungen bestehen die typisierten Snapshot-Anpassungen.【2b30a7†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Button-Extras, Modul-Casts und Zeitparser erfüllen die strengen Typregeln.【fb65da†L1-L1】
- ✅ `ruff check` – Select-Plattform und Tracking-Presets bleiben lint-frei nach der JSON-TypedDict-Umstellung.【a42645†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_select_entities.py -q` – GPS- und Benachrichtigungs-Selects persistieren die neuen Snapshot-Casts ohne Regressionen.【b7aa00†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – SelectExtraAttributes, Manager-Casts und Tracking-Konfigurationen bestehen die strenge Typprüfung.【689bcf†L1-L1】
- ✅ `ruff check` – Performance- und Wartungs-Telemetrie laufen lint-frei nach der neuen MaintenanceMetadataPayload-Typisierung.【dec77b†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_performance.py -q` – Performance-Tracker-Änderungen bleiben regressionsfrei und behalten die Benchmarks stabil.【06c6d1†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_performance_scaling.py -q` – Skalierungs-Benchmarks akzeptieren die JSON-typisierten Maintenance-Metadaten ohne Ausreißer.【ab19e4†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine neuen Abhängigkeiten für die Performance-Tests erforderlich.【25ba70†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Maintenance-Metadaten und Coordinator-Tasks sind jetzt streng typisiert.【a8bf56†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – scheitert weiterhin ohne das vendorte PyYAML-Modul; Laufzeitfehler dokumentiert.【894a6d†L1-L26】
- ✅ `ruff check` – GPS-Tracker-Telemetrie und Export-Payloads bleiben lint-frei nach der Umstellung auf TypedDict-Attribute.【f5ac08†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_device_tracker.py -q` – neue GPS-Tracker-Regressionen sichern attribut- und exportbezogene TypedDicts ab.【d1238c†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Abhängigkeiten für die Device-Tracker-Tests erforderlich.【d8e833†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – die getypten Tracker-Attribute und Exporter bestehen die strengen Typvorgaben.【a413ff†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – schlägt weiterhin ohne das vendorte PyYAML-Modul fehl; Container-Limitation dokumentiert.【7a218d†L1-L25】
- ✅ `ruff check` – Health-Calculator- und Feeding-Manager-Refactors laufen lint-frei.【464a8a†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_health_calculator_quality.py tests/unit/test_feeding_manager.py -q` – typisierte Feeding-Historie und Gesundheitsberichte bestehen die Regressionen.【472f2c†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten für die neuen Health-Telemetrie-Tests erforderlich.【646c05†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Feeding- und Health-TypedDicts erfüllen die strengen Typvorgaben.【9fa2a6†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – schlägt weiterhin ohne das vendorte PyYAML-Modul fehl.【aca346†L1-L27】
- ✅ `ruff check` – Feeding-TypedDict-Refactor und Manager-Snapshots bleiben lint-frei.【0ff8bd†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_manager.py -q` – Feeding-Snapshots und Statistik-Caches liefern strukturierte Payloads ohne Regressionen.【34123e†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Abhängigkeiten für die Feeding-Tests erforderlich.【6801a4†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – FeedingSnapshot-, Statistik- und Adapter-Payloads bestehen die strenge Typprüfung.【c8e1e5†L1-L2】
- ✅ `ruff check` – Dashboard-Karten-Optionen und Renderer-Casts bleiben lint-frei nach den neuen TypedDict-Refactors.【d88f6d†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_cards.py -q` – neue Karten-Helper-Tests sichern Themauswahl und Performance-Statistik-Snapshots.【934ba6†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Abhängigkeiten für die Dashboard-Karten-Regressionen erforderlich.【5cd65a†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Kartenoptionen und Renderer-Signaturen bleiben streng typisiert.【8e2cb4†L1-L2】
- ✅ `ruff check` – Number-Attribute-Payloads und Coordinator-Dog-Daten bleiben lint-frei nach den neuen JSON-Aliasen.【714c29†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_missing_sensor_telemetry.py -q` – Regressionen für die typisierten Entity-Attribute bleiben grün und spiegeln die aktualisierten Number-Helfer wider.【caebd2†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Entity-Attribute-Generics und die erweiterten CoordinatorDogData-Snapshots bestehen die strenge Typprüfung.【b18978†L1-L2】
- ✅ `ruff check` – Render-Job-Generics, Dashboard-Casts und Switch-Attribute laufen lint-frei durch die neue Typisierung.【c1c7a3†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_dashboard_renderer.py tests/unit/test_dashboard_generator.py tests/unit/test_dashboard_templates.py tests/components/pawcontrol/test_all_platforms.py -q` – Renderer-, Generator-, Template- und Plattform-Flows bestehen die typisierten Lovelace-/Switch-Änderungen.【dc90c7†L1-L9】【213752†L1-L3】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Testabhängigkeiten für die Renderer- und Dashboard-Suites nötig.【c29639†L1】【8d26f8†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – neue Dashboard- und Switch-TypedDicts bestehen die strenge Typprüfung.【4b8995†L1】【98a1de†L1-L2】
- ✅ `ruff check` – Geofencing-Storage und Benachrichtigungs-TypedDicts bleiben lint-frei.【a6306a†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_geofencing.py -q` – neue Geofence-Storage- und Notification-Tests decken die JSON-konformen Payloads ab.【0cb7da†L1-L10】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Testabhängigkeiten für die Geofencing-Regressionen notwendig.【371114†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – typisierte Geofencing-Speicherpfade bestehen die strenge Typprüfung.【2b5409†L1-L2】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – scheitert weiterhin ohne PyYAML-Vendorpaket; Laufzeitfehler dokumentiert.【fe0b83†L1-L26】
- ✅ `ruff check` – Geofence- und Routenexport-Typisierung bleibt lint-frei.【aa5405†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_gps_manager.py -q` – GPS-Manager liefert strukturierte Snapshots und Export-Payloads mit TypedDicts.【2802b7†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – neue Geofence- und Export-Typen bestehen die strenge Typprüfung.【f39573†L1-L2】
- ✅ `ruff check` – Service-Guard-Typisierung und Guard-Verlaufsnormalisierung bleiben lint-frei.【8fe70f†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_service_guard.py tests/unit/test_services.py tests/unit/test_dashboard_generator.py tests/unit/test_coordinator_tasks.py -q` – Guard-Snapshots, Service-Aggregation und Dashboard-Metriken laufen grün.【7b19a5†L1-L5】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_templates.py -q` – Template-Renderer und Guard-Anzeige bleiben stabil.【90465a†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten notwendig.【aee9df†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Service-Guard-Payloads und Dashboard-Formatter erfüllen die strengen Typvorgaben.【d947d9†L1-L2】
- ✅ `ruff check` – Storage-Namespace-Typisierung und Cache-Generics bleiben lint-frei.【98a381†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_helpers.py tests/unit/test_data_manager.py -q` – Storage-Cache- und Namespace-Guards bestehen die Regressionen.【f88535†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten für die Storage-Typisierung erforderlich.【c31eb2†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – StorageNamespace-Payloads und Cache-Werte erfüllen die strengen Typvorgaben.【675f65†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – schlägt weiterhin ohne PyYAML-Vendorpaket fehl.【1f7a1d†L1-L27】
- ✅ `ruff check` – Missing-Sensor-Telemetrie und Protokoll-Helper bestehen den Lint-Durchlauf.【996c09†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_missing_sensor_telemetry.py -q` – neue Helper-Tests decken Aktivitäts-, Kalorien- und Zeitberechnungen ab.【1e4aa5†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Protokoll-gestützte Modulzugriffe und Sensor-Hilfsfunktionen sind streng typisiert.【dfdda4†L1-L2】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten für die neuen Telemetrie-Tests erforderlich.【933c35†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Lauf scheitert weiterhin ohne PyYAML-Stub und benötigt das Vendor-Paket für den Loader.【ff1743†L1-L27】
- ✅ `ruff check` – System-Health-Typisierung und Listener-Normalisierung bestehen den Lint-Durchlauf.【f7d063†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_system_health.py -q` – manuelle Events und Schwellenwerte liefern strukturierte Health-Snapshots.【74e515†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – System-Health- und Script-Manager-Typisierung bleibt streng.【b1601d†L1-L2】
- ✅ `ruff check` – neue Storage- und Performance-Snapshots bleiben lint-frei.【9ad2b2†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py tests/unit/test_notifications.py -q` – typisierte Storage- und Notification-Telemetrie besteht die Regressionstests.【a2f7d1†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_performance_scaling.py -q` – der Performance-Monitor-Dekorator bleibt unter Last stabil.【e5e34f†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Abhängigkeits-Audit meldet weiterhin keine fehlenden Testpakete.【a32d98†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – neue TypedDicts für Queue- und Laufzeitmetriken bestehen die strenge Typprüfung.【324b7c†L1-L2】
- ✅ `ruff check` – Health-Status-Snapshots und Adapter-Normalisierung laufen lint-frei.【aa04d4†L1-L2】
- ✅ `ruff check` – Coordinator-Observability- und Runtime-TypedDicts bestehen den aktuellen Lint-Durchlauf.【d4fc62†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_coordinator_observability.py tests/unit/test_coordinator_tasks.py tests/unit/test_coordinator.py tests/coverage/coverage_coordinator_observability.py -q` – neue Coordinator-Diagnostik und Scorecard-Kontrollen laufen grün.【23ff7a†L1-L12】
- ✅ `python -m script.enforce_test_requirements` – Requirements-Audit meldet weiterhin keine fehlenden Testpakete.【71ac73†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – aktualisierte Runtime- und Security-TypedDicts bestehen die strenge Typprüfung.【430803†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_health_enhancements.py -q` – typisierte Health-Diagnostik liefert strukturierte Alerts und Empfehlungen.【bd2d75†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Health-TypedDicts und Adapter-Normalisierungen bestehen die strenge Typprüfung.【07e26e†L1-L1】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Testabhängigkeiten für die Health-Testfälle erforderlich.【a1f8ea†L1-L2】
- ✅ `ruff check` – Garden-TypedDicts und Moduladapter-Konversion laufen lint-frei.【b0f945†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_garden_manager_snapshot.py tests/unit/test_runtime_manager_container_usage.py tests/components/pawcontrol/test_all_platforms.py -q` – strukturierte Garden-Snapshots funktionieren für Sensoren, Binärsensoren und Runtime-Manager-Stubs.【e71a9a†L1-L11】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – GardenModulePayload und neue TypedDicts integrieren sich ohne Typkonflikte in Sensoren und Binärsensoren.【598c15†L1-L2】
- ✅ `ruff check` – WalkManager-, Moduladapter- und Door-Sensor-Korrekturen bleiben lint-frei.【bc5a45†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_walk_manager.py tests/unit/test_walk_manager_gps_cache.py tests/unit/test_door_sensor_manager.py tests/unit/test_module_adapter_cache.py -q` – Walk- und Door-Sensor-Flows bestehen die gezielten Regressionstests.【135770†L1-L7】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – WalkManager-, Door-Sensor- und Moduladapter-Anpassungen bleiben streng typisiert.【fee465†L1-L1】
- ✅ `ruff check` – WalkManager- und Snapshot-Refactor läuft lint-frei.【241bbc†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_walk_manager.py tests/unit/test_walk_manager_gps_cache.py -q` – WalkManager-Snapshots und Cache-Diagnostik bleiben stabil.【26e996†L1-L4】
- ✅ `ruff check` – GPS-Routenpuffer und Gerätetracker bleiben lint-frei.【165d60†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_gps_route_buffer.py -q` – neuer GPS-Routenpuffer besteht die Regressionstests.【2dc184†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – Requirements-Audit meldet weiterhin keine zusätzlichen Testabhängigkeiten.【cd3f2b†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – die getypten GPS-Telemetrie-Modelle passieren die strenge Typprüfung.【905b3f†L1-L1】

- Run `ruff check`, `python -m script.enforce_test_requirements`, `pytest -q`, `mypy custom_components/pawcontrol`, and `python -m script.hassfest --integration-path custom_components/pawcontrol` before opening a pull request so the Platinum guardrails stay enforced.【F:.github/copilot-instructions.md†L29-L67】
- Target Python 3.13+ features and reuse the coordinator/manager helpers so runtime data remains fully typed and compatible with Home Assistant expectations.【F:.github/copilot-instructions.md†L45-L118】

- Dashboard-Renderer-Jobs nutzen jetzt generische `RenderJob`-Typen mit typisierten Optionen/Ergebnissen; Generator und Switches casten Renderer-Payloads sowie Attribut-Dicts vor Datei-/State-Operationen, damit Lovelace-Konfigurationen und Entitätsattribute JSON-sicher und strikt typisiert bleiben.【F:custom_components/pawcontrol/dashboard_renderer.py†L79-L363】【F:custom_components/pawcontrol/dashboard_generator.py†L734-L1055】【F:custom_components/pawcontrol/types.py†L1151-L1261】【F:custom_components/pawcontrol/switch.py†L402-L770】
- Die Kartengeneratoren verwenden jetzt `DashboardCardOptions` und `DashboardCardPerformanceStats`, normalisieren Themen über `_resolve_dashboard_theme_option` und umgehen sämtliche `dict[str, Any]`-Casts in den Renderer-Aufrufen; begleitende Tests sichern die Performance-Snapshots und die Themensanitiserung.【F:custom_components/pawcontrol/dashboard_cards.py†L428-L465】【F:custom_components/pawcontrol/dashboard_renderer.py†L419-L437】【F:custom_components/pawcontrol/dashboard_renderer.py†L738-L815】【F:custom_components/pawcontrol/types.py†L1186-L1197】【F:tests/unit/test_dashboard_cards.py†L17-L56】

- ✅ `ruff check` – Wetter-Übersetzungen und Modul-Payloads passieren das Lint-Gate mit den neuen TypedDicts.【5935a0†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_module_adapters.py tests/unit/test_dashboard_templates.py -q` – Wetteradapter und Dashboard-Vorlagen bleiben nach der Typisierung stabil.【480ac0†L1-L10】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Wettermanager, Adapter und Übersetzungshelfer bestehen die strenge Typprüfung.【81e099†L1-L2】
- ✅ `ruff check` – Dashboard-Metadaten-Refactor besteht lint-seitig ohne Auffälligkeiten.【2cedc8†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_generator.py -q` – neue Dashboard-Snapshot-Typen bleiben in den Unit-Tests stabil.【70c40d†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten notwendig.【7d0833†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Dashboard-Generator läuft mit den neuen TypedDicts typrein durch.【400d52†L1-L2】

- ✅ `ruff check` – JSON-kompatible TypedDicts und Snapshot-Generics bestehen das aktuelle Lint-Gate ohne Beanstandungen.【5f45c0†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py tests/unit/test_door_sensor_manager.py tests/unit/test_dashboard_templates.py -q` – Cache-Monitore, Snapshot-Klone und Dashboard-Helfer laufen nach den JSON-Anpassungen stabil grün.【78723e†L1-L11】
- ⚠️ `PYTHONPATH=. pytest -q` – Vollsuite nach ~10 Minuten und 555 erfolgreichen Tests wegen Laufzeit beendet; bis dahin keine neuen Fehler sichtbar.【a54575†L1-L8】
- ✅ `python -m script.enforce_test_requirements` – Abhängigkeits-Audit meldet weiterhin keine fehlenden Pakete für die Testläufe.【45cbf5†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – strukturierte JSON- und Snapshot-Typen bestehen die strikte Typprüfung.【5b665d†L1-L2】

- ✅ `ruff check` – Person-Manager-Telemetrie und Benachrichtigungs-Fallback bestehen den aktuellen Lint-Durchlauf.【3fdce6†L1-L2】
- ✅ `ruff check` – neue Datumskonvertierungen und Cache-Klone bestehen den aktuellen Lint-Durchlauf ohne Beanstandungen.【61f6ae†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_template_cache.py tests/unit/test_walk_manager_gps_cache.py -q` – Template- und GPS-Caches bleiben mit den typisierten Klonpfaden stabil.【b47c65†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – weiterhin keine fehlenden Testabhängigkeiten notwendig.【a573e0†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – die behobenen Utils- und Dashboard-Typen lassen die Vollprüfung wieder fehlerfrei durchlaufen.【af30db†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_person_entity_manager.py -q` – die neuen Snapshot-/Diagnose-Typen liefern strukturierte Ergebnisse.【ef4adb†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – weiterhin keine fehlenden Testabhängigkeiten für die aktualisierten Suites.【8d697b†L1-L1】

- ✅ `ruff check` – lint läuft weiterhin ohne Beanstandungen.【6d43eb†L1-L2】
- ⚠️ `PYTHONPATH=. pytest -q` – Vollsuite bleibt aus Zeitgründen offen; gezielte Cache-Regressionstests laufen grün (siehe unten).【b16d70†L1-L8】
- ✅ `PYTHONPATH=. pytest tests/unit/test_template_cache.py tests/unit/test_walk_manager_gps_cache.py -q` – neue Cache-Snapshots und Telemetrie bleiben stabil.【f728bb†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – das Abhängigkeits-Audit meldet weiterhin keine Abweichungen.【e3a607†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_module_adapter_cache.py -q` – Moduladapter-Telemetrie und Snapshot-Fehlerpfade bleiben stabil.【574014†L1-L8】
- ✅ `ruff check` – aktuelle TypedDict-Refactorings bestehen lint-seitig ohne Beanstandung.【b0ffec†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py tests/unit/test_door_sensor_manager.py -q` – Cache-Monitore für Script-, Door-Sensor- und Storage-Namespace bleiben stabil.【01ee02†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – weiterhin keine fehlenden Testabhängigkeiten.【b9a110†L1-L1】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – lokaler Lauf nach PyYAML-Installation erneut grün.【8e3c41†L1-L1】
- ✅ Coverage-Shim-Integration – nutzt jetzt `sys.monitoring` auf Python 3.13+ für bessere Performance und fällt bei belegten Tool-IDs transparent auf klassische Trace-Hooks zurück.【F:coverage.py†L120-L235】

## Erledigte Arbeiten
- Die Binärsensoren validieren Hunger-, Walk-, GPS-, Health- und Garden-Payloads jetzt mit `int | float`-, `str`- und Mapping-Guards, sodass Attribute wie `last_feeding_hours`, `estimated_remaining`, `accuracy` und `pending_confirmations` ohne untypisierte Fallbacks exportiert werden.【F:custom_components/pawcontrol/binary_sensor.py†L875-L1433】【F:custom_components/pawcontrol/binary_sensor.py†L1660-L1833】
- Neue Komponenten-Tests decken Online-, Hunger-, Walk-, GPS-, Health- und Garden-Binärsensoren ab und stellen sicher, dass die getypten Snapshot-Pfade stabil bleiben.【F:tests/components/pawcontrol/test_binary_sensor.py†L83-L321】
- Die Select-Plattform nutzt jetzt `SelectExtraAttributes`, Tracking-/Genauigkeits-Presets und JSON-kompatible Info-TypedDicts, sodass Basis- und Spezial-Selects strukturierte Snapshots aktualisieren und Manager-Aufrufe typsicher bleiben.【F:custom_components/pawcontrol/types.py†L96-L169】【F:custom_components/pawcontrol/select.py†L520-L775】【F:custom_components/pawcontrol/select.py†L818-L1239】【F:custom_components/pawcontrol/select.py†L1456-L1482】
- Die Select-Tests verwenden die Coordinator-Typalias und sichern GPS- sowie Benachrichtigungs-Selects gegen die neue Typisierung ab.【F:tests/components/pawcontrol/test_select_entities.py†L1-L144】
- Der Wetter-Stack nutzt jetzt `WeatherTranslations`, getypte Koerzions-Helfer und Sequenz-Signaturen, während der Moduladapter `WeatherAlertPayload`/`WeatherConditionsPayload` liefert und damit JSON-sichere Diagnosen ohne `dict[str, Any]` bereitstellt.【F:custom_components/pawcontrol/weather_translations.py†L11-L35】【F:custom_components/pawcontrol/weather_manager.py†L391-L499】【F:custom_components/pawcontrol/weather_manager.py†L697-L775】【F:custom_components/pawcontrol/module_adapters.py†L783-L875】【F:custom_components/pawcontrol/types.py†L2169-L2204】
- Die Number-Plattform nutzt jetzt `EntityAttributePayload`/`NumberExtraAttributes` für `extra_state_attributes`, aktualisiert `CoordinatorDogData` mit JSON-kompatiblen Profil- und Modul-Snapshots und meidet damit verbleibende `dict[str, Any]`-Fälle in den Number-Helfern.【F:custom_components/pawcontrol/types.py†L87-L95】【F:custom_components/pawcontrol/types.py†L3445-L3464】【F:custom_components/pawcontrol/number.py†L403-L433】【F:custom_components/pawcontrol/number.py†L558-L580】【F:custom_components/pawcontrol/number.py†L614-L622】【F:custom_components/pawcontrol/number.py†L695-L718】
- Die Storage-Schicht nutzt jetzt `StorageNamespaceKey`, `StorageNamespacePayload` und einen typisierten `OptimizedDataCache`, sodass Laden, Speichern und Bereinigung der Stores ohne `dict[str, Any]`-Fallbacks auskommen und Coordinator-Monitore strukturierte JSON-Payloads erhalten.【F:custom_components/pawcontrol/types.py†L87-L103】【F:custom_components/pawcontrol/helpers.py†L454-L768】
- `PawControlDataManager.async_get_module_data` prüft Storage-Overrides nun auf Mapping-Kompatibilität, bevor sie mit den Profilmodulen verschmolzen werden, womit `_coerce_mapping` nur noch gültige Dictionaries sieht.【F:custom_components/pawcontrol/data_manager.py†L1768-L1778】
- Die Helper-Regressionstests spiegeln die Literal-Store-Schlüssel und JSON-Payloads der neuen Storage-Typisierung wider und sichern damit die Cache-Casts ab.【F:tests/components/pawcontrol/test_helpers.py†L1-L65】
- Die fehlenden Sensoren nutzen jetzt Protokoll-basierte `_ModuleDataProvider`-Helper samt typisierten Snapshot-Funktionen, wodurch Aktivitäts-, Kalorien- und Laufzeitberechnungen ohne untypisierte Dict-Zugriffe auskommen.【F:custom_components/pawcontrol/missing_sensors.py†L36-L200】【F:custom_components/pawcontrol/missing_sensors.py†L395-L537】
- `FeedingModuleTelemetry` und `WalkModuleTelemetry` erweitern die bestehenden Payloads um Planungs- und Lifetime-Felder, damit die Sensor-Helper strukturierte TypedDicts konsumieren.【F:custom_components/pawcontrol/types.py†L1649-L1686】【F:custom_components/pawcontrol/types.py†L2080-L2100】
- Das Feeding-Subsystem nutzt jetzt `FeedingSnapshot`, `FeedingStatisticsSnapshot` und verwandte TypedDicts, speichert Manager-Caches als typsichere Snapshots und liefert dem Moduladapter sowie den Tests strukturierte Payloads für Diagnostik und Statistiken.【F:custom_components/pawcontrol/types.py†L1899-L1967】【F:custom_components/pawcontrol/feeding_manager.py†L1555-L1759】【F:custom_components/pawcontrol/module_adapters.py†L328-L399】【F:tests/unit/test_feeding_manager.py†L406-L439】
- Neue Unit-Tests verifizieren die Helper-Berechnungen für Aktivitätslevel, Kalorien, Zeitdifferenzen und Fütterungspläne, sodass die Telemetrie auch ohne reale Koordinatoren regressionssicher bleibt.【F:tests/unit/test_missing_sensor_telemetry.py†L1-L78】
- Der Datenmanager liefert mit `DataManagerMetricsSnapshot` eine typsichere Diagnoseoberfläche, und der Benachrichtigungsmanager sowie der globale Performance-Monitor geben jetzt `NotificationQueueStats` bzw. `PerformanceMonitorSnapshot` zurück, sodass Coordinator-Diagnosen ohne `dict[str, Any]` auskommen.【F:custom_components/pawcontrol/data_manager.py†L2634-L2642】【F:custom_components/pawcontrol/helpers.py†L1608-L1617】【F:custom_components/pawcontrol/helpers.py†L1769-L1801】【F:custom_components/pawcontrol/types.py†L1571-L1577】【F:custom_components/pawcontrol/types.py†L2760-L2776】【F:custom_components/pawcontrol/types.py†L3474-L3479】
- System-Health aggregiert Service-Execution-Snapshots jetzt über `ManualResilienceEventsTelemetry`, typisierte Threshold-Zusammenfassungen und Literal-Indikatoren; der Script-Manager normalisiert Automationseinträge und Listener-Metadaten auf die neuen TypedDicts, und gezielte Tests sichern die strukturierte Ausgabe.【F:custom_components/pawcontrol/system_health.py†L110-L407】【F:custom_components/pawcontrol/system_health.py†L420-L599】【F:custom_components/pawcontrol/script_manager.py†L660-L1014】【F:custom_components/pawcontrol/types.py†L2629-L2688】【F:tests/components/pawcontrol/test_system_health.py†L15-L120】
- Health-Enhancements exportieren jetzt `HealthStatusSnapshot`- und `HealthAppointmentRecommendation`-TypedDicts, normalisieren gespeicherte Alerts/Medikationen im Health-Adapter und sichern die strukturierte Telemetrie mit gezielten Unit-Tests ab.【F:custom_components/pawcontrol/health_enhancements.py†L375-L602】【F:custom_components/pawcontrol/module_adapters.py†L600-L742】【F:custom_components/pawcontrol/types.py†L318-L388】【F:tests/unit/test_health_enhancements.py†L1-L88】
- Der Coordinator-Runtime-Stack liefert für Adaptive-Polling, Update-Zyklen und Entity-Budgets jetzt streng typisierte TypedDict-Snapshots; die Observability-Helfer normalisieren Bool-Coercion-Metriken trotz mehrfach geladener Telemetry-Module, und die Security-Scorecard nutzt neue Webhook-/Budget-Checks samt Literal-Status, während der Coordinator die erweiterten Performance-Payloads (inklusive Resilienz-, Service- und Zyklusdaten) zurückgibt.【F:custom_components/pawcontrol/coordinator_runtime.py†L229-L307】【F:custom_components/pawcontrol/coordinator_observability.py†L150-L276】【F:custom_components/pawcontrol/types.py†L2797-L2865】【F:custom_components/pawcontrol/coordinator.py†L490-L537】
- GardenManager exportiert GardenModulePayload, Stats- und Pending-Confirmation-TypedDicts, während Moduladapter, Sensoren und Binärsensoren die strukturierten Snapshots konsumieren; ein neuer Unit-Test deckt die typisierte Snapshot-Erzeugung ab.【F:custom_components/pawcontrol/garden_manager.py†L188-L1162】【F:custom_components/pawcontrol/module_adapters.py†L772-L834】【F:custom_components/pawcontrol/sensor.py†L910-L970】【F:custom_components/pawcontrol/binary_sensor.py†L560-L620】【F:tests/unit/test_garden_manager_snapshot.py†L1-L83】
- RuntimePerformanceStats, PerformanceTrackerBucket und die neuen Telemetry-Helper sorgen dafür, dass Koordinatoren, Services, Dashboards, Diagnostik und System-Health strikt typisierte Performance-Daten mit gemeinsamen `performance_buckets` erhalten; die Daily-Reset-Tests sichern das neue Bucket-Layout.【F:custom_components/pawcontrol/types.py†L4436-L4470】【F:custom_components/pawcontrol/types.py†L4524-L4527】【F:custom_components/pawcontrol/telemetry.py†L78-L105】【F:custom_components/pawcontrol/performance.py†L60-L107】【F:custom_components/pawcontrol/services.py†L438-L483】【F:custom_components/pawcontrol/services.py†L4781-L4810】【F:custom_components/pawcontrol/coordinator.py†L524-L528】【F:custom_components/pawcontrol/coordinator_tasks.py†L995-L1014】【F:custom_components/pawcontrol/dashboard_generator.py†L280-L329】【F:custom_components/pawcontrol/diagnostics.py†L1231-L1304】【F:custom_components/pawcontrol/system_health.py†L513-L524】【F:tests/unit/test_services.py†L861-L869】
- Health-Calculator und Feeding-Manager nutzen neue TypedDicts für Zielwerte, Verlaufssnapshots und Health-Reports; `_normalise_health_override` speist Health-Metriken ohne lose `dict[str, Any]`, und die aktualisierten Unit-Tests decken die strukturierten Payloads ab.【F:custom_components/pawcontrol/types.py†L308-L401】【F:custom_components/pawcontrol/health_calculator.py†L415-L969】【F:custom_components/pawcontrol/feeding_manager.py†L210-L376】【F:custom_components/pawcontrol/feeding_manager.py†L2212-L2369】【F:custom_components/pawcontrol/feeding_manager.py†L2550-L2629】【F:tests/unit/test_health_calculator_quality.py†L1-L198】
- WalkManager schützt GPS-Vergleichskoordinaten jetzt strikt gegen `None`, liefert Tages-/Wochenstatistiken ohne `dict.get`-Fallen und nutzt für aktive Walk-Snapshots typsichere Container-Zugriffe.【F:custom_components/pawcontrol/walk_manager.py†L500-L520】【F:custom_components/pawcontrol/walk_manager.py†L1426-L1492】
- Door-Sensor-Manager normalisiert Abschlussdauern ausschließlich aus numerischen Payloads und behält Minutenwerte als Floats, sodass automatische Endungen keine Typwarnungen mehr auslösen.【F:custom_components/pawcontrol/door_sensor_manager.py†L1184-L1212】
- Der Walk-Moduladapter liefert für Ausfälle ein vollständig befülltes `WalkModulePayload`, damit Koordinatoren trotz Cache-Fallback sämtliche Pflichtfelder erhalten.【F:custom_components/pawcontrol/module_adapters.py†L351-L383】
- Der WalkManager nutzt jetzt `WalkSessionSnapshot`, `WalkStatisticsSnapshot`, `WalkGPSSnapshot` und `WalkPerformanceSnapshot`, pflegt seine Caches mit PEP-695-Generics und liefert koordinatorkompatible Leistungsdaten sowie getypte Historienkopien ohne lose `dict[str, Any]`-Rückgaben.【F:custom_components/pawcontrol/types.py†L1797-L1990】【F:custom_components/pawcontrol/walk_manager.py†L316-L1353】
- Der GPS-Gerätetracker nutzt jetzt `GPSRouteBuffer`, `GPSLocationSample` und typisierte Routensnapshots für Koordinator-Updates, Exporte und Abschlussmeldungen, wodurch untypisierte Dictionaries entfallen.【F:custom_components/pawcontrol/device_tracker.py†L190-L813】【F:custom_components/pawcontrol/types.py†L1621-L1727】
- Neue Unit-Tests sichern den `GPSRouteBuffer` gegen Pruning-, Snapshot- und Clear-Regressionen ab.【F:tests/unit/test_gps_route_buffer.py†L1-L57】
- `PersonEntityManager` nutzt jetzt einen generischen `PersonNotificationCache` mit TypedDict-Snapshots für Statistiken, Diagnostik und Koordinator-Exports; ein aktualisierter Test deckt die neuen Telemetrieverträge ab.【F:custom_components/pawcontrol/person_entity_manager.py†L49-L833】【F:custom_components/pawcontrol/types.py†L1434-L1784】【F:tests/unit/test_person_entity_manager.py†L1-L51】
- Cache-Diagnostik und Reparaturaggregate verwenden JSON-kompatible Aliase, generische Snapshots und streng typisierte Casts; Manager- und Namespace-Diagnostik casten per-dog Payloads auf diese Strukturen.【F:custom_components/pawcontrol/types.py†L72-L2079】【F:custom_components/pawcontrol/data_manager.py†L605-L680】【F:custom_components/pawcontrol/door_sensor_manager.py†L425-L483】【F:custom_components/pawcontrol/script_manager.py†L283-L333】【F:custom_components/pawcontrol/person_entity_manager.py†L789-L834】
- Die Benachrichtigungs-API liefert einen vollständig getypten Personen-Kontext, sodass Fallbacks alle Pflichtfelder der neuen Snapshot-Typen ausfüllen.【F:custom_components/pawcontrol/notifications.py†L2248-L2265】
- `PawControlDashboardGenerator` persistiert Dashboard-Metadaten jetzt über typisierte Store-Payloads und Snapshot-TypedDicts; Optionen werden vor dem Speichern defensiv kopiert und die Callback-Helfer liefern strukturierte Performance-Snapshots für Diagnostik und UI.【F:custom_components/pawcontrol/dashboard_generator.py†L89-L215】【F:custom_components/pawcontrol/dashboard_generator.py†L728-L912】【F:custom_components/pawcontrol/dashboard_generator.py†L1548-L1606】
- Utils- und Dashboard-Helfer beseitigen die verbleibenden Mypy-Warnungen mit strenger nummerischer Datumskonvertierung und generisch typisierten Cache-Klonen.【F:custom_components/pawcontrol/utils.py†L170-L178】【F:custom_components/pawcontrol/utils.py†L1376-L1499】【F:custom_components/pawcontrol/dashboard_templates.py†L690-L699】
- `TemplateCache` und `GPSCache` exportieren jetzt komplett typisierte Statistiken samt PEP-695-Generics, Metadaten-Snapshots und koordinatorfähiger Diagnostik; dedizierte Regressionstests sichern die neuen Telemetrieverträge.【F:custom_components/pawcontrol/dashboard_templates.py†L320-L829】【F:custom_components/pawcontrol/walk_manager.py†L61-L256】【F:tests/unit/test_template_cache.py†L1-L83】【F:tests/unit/test_walk_manager_gps_cache.py†L1-L52】
- `AdaptiveCache` und `OptimizedDataCache` nutzen jetzt PEP-695-Generics sowie präzisere TypedDict-Payloads, wodurch die Cache-Diagnostik strukturierte Stats zurückliefert und Coordinator-Snapshots ohne lose `dict[str, Any]`-Casts auskommen.【F:custom_components/pawcontrol/data_manager.py†L92-L176】【F:custom_components/pawcontrol/data_manager.py†L244-L278】【F:custom_components/pawcontrol/helpers.py†L104-L210】【F:custom_components/pawcontrol/helpers.py†L342-L416】
- `NotificationCache` und der Benachrichtigungsmanager exportieren jetzt strukturierte TypedDict-Snapshots inklusive PEP-695-Generics, wodurch Cache-Monitore und Coordinatoren konsistente Diagnostik erhalten und Performance-Metriken typsicher kopiert werden können.【F:custom_components/pawcontrol/notifications.py†L213-L347】【F:custom_components/pawcontrol/notifications.py†L573-L613】【F:custom_components/pawcontrol/notifications.py†L1902-L1955】
- Moduladapter-TTL-Caches liefern jetzt getypte Statistiken, Metadaten und Fehlersnapshots; der Coordinator-Monitor aggregiert diese Telemetrie ohne `dict[str, Any]`-Fallbacks und neue Regressionstests sichern die Schnittstelle.【F:custom_components/pawcontrol/module_adapters.py†L64-L256】【F:custom_components/pawcontrol/data_manager.py†L405-L483】【F:tests/unit/test_module_adapter_cache.py†L1-L223】
- Script- und Door-Sensor-Manager exportieren nun vollständig typisierte Cache-Snapshots samt PEP-695-Generics; Storage-Namespaces und der Entity-Budget-Monitor liefern strukturierte TypedDict-Metriken inklusive koordinatorkompatibler Fall-back-Pfade.【F:custom_components/pawcontrol/script_manager.py†L242-L365】【F:custom_components/pawcontrol/door_sensor_manager.py†L320-L494】【F:custom_components/pawcontrol/data_manager.py†L360-L520】【F:custom_components/pawcontrol/types.py†L1402-L1491】
- Selector-Shim und Datumshelfer spiegeln jetzt die offiziellen Home-Assistant-Typdefinitionen inklusive PEP-695-Generics; neue Regressionstests sichern die Fallback-Pfade, während `ensure_utc_datetime` über Overloads und Typhilfen strenger typisiert ist.【F:custom_components/pawcontrol/selector_shim.py†L1-L170】【F:custom_components/pawcontrol/utils.py†L1376-L1499】【F:tests/unit/test_selector_shim.py†L1-L58】
- Hassfest- und HACS-Prüfungen laufen jetzt in einem gemeinsamen `marketplace-validation`-Job der CI, während der eigenständige Workflow nur noch nächtlich oder manuell ausgeführt wird. Damit entfallen doppelte Blocker auf Pull Requests, die Compliance-Gates bleiben aber weiterhin täglich überwacht.【F:.github/workflows/ci.yml†L229-L249】【F:.github/workflows/hassfest.yml†L1-L32】
- ✅ Ergänzt: Die Portionen-Validierungs-Tests decken jetzt sowohl die 70 %-Grenze als auch extrem kleine Portionen ab, womit die Validierungswarnungen für Hoch- und Niedrigfälle dauerhaft abgesichert sind.【F:tests/unit/test_utils_portion_validation.py†L1-L85】
- Die Config-Flow-Basis liefert jetzt `IntegrationNameValidationResult` und `FeedingSizeDefaults`, sodass Namensvalidierung und Größen-Defaults strukturierte TypedDicts mit Testsicherung bereitstellen.【F:custom_components/pawcontrol/config_flow_base.py†L208-L289】【F:custom_components/pawcontrol/types.py†L1659-L1735】【F:tests/unit/test_config_flow_base.py†L30-L72】
- Neuer CI-Job „Localization & Guide Sync“ erzwingt `python -m script.sync_localization_flags --allowlist script/sync_localization_flags.allowlist --check` sowie `python -m script.sync_contributor_guides --check`, sodass Setup-Flag-Tabellen und Contributor-Guides bei Drift Pull-Requests sofort blockieren; der Aggregator „All Checks Passed“ pollt das Ergebnis über die GitHub-API und markiert Branch-Protection-Checks auch dann als fehlgeschlagen, wenn der Rest der Pipeline bereits abgeschlossen ist.【F:.github/workflows/ci.yml†L142-L161】【F:.github/workflows/ci.yml†L245-L338】
- Die Workflow-Concurrency begrenzt Pull-Request-Läufe weiterhin per gemeinsamer Gruppe, lässt Push-Jobs aber weiterlaufen: Coverage- und Compliance-Checks deaktivieren das Abbrechen außerhalb von Pull Requests, während Release-Drafter und release-please für Push-Ereignisse commit-basierte Gruppen nutzen, damit veröffentlichungsrelevante Läufe unabhängig voneinander bleiben.【F:.github/workflows/coverage.yml†L14-L17】【F:.github/workflows/hassfest.yml†L9-L32】【F:.github/workflows/release-please.yml†L8-L11】【F:.github/workflows/release-drafter.yml†L9-L12】
- GitHub-Actions-Workflows nutzen jetzt abgestimmte Concurrency-Gruppen pro Pull Request oder Branch, um neuere Läufe zu priorisieren und Feedback schneller bereitzustellen. Details liefert die [GitHub-Dokumentation zu Concurrency-Gruppen](https://docs.github.com/en/actions/using-jobs/using-concurrency).
  - **Hinweis:** Um Unterbrechungen lang laufender Pipelines zu vermeiden, gelten folgende Ausnahmen:
    - **Release-Workflows:** Bleiben bei Push-Ereignissen branch-basiert, damit nur der jüngste Lauf Release-Entwürfe und -PRs aktualisiert.
    - **Coverage- und Compliance-Prüfungen:** Deaktivieren das Abbrechen außerhalb von Pull Requests, um Artefakte zu erhalten.
    - **Übrige Workflows:** Behalten Branch-basierte Gruppen für kontrollierte Abbrüche bei.【F:.github/workflows/coverage.yml†L14-L17】【F:.github/workflows/hassfest.yml†L9-L32】【F:.github/workflows/pre-commit.yaml†L9-L12】【F:.github/workflows/release-please.yml†L8-L11】【F:.github/workflows/release-drafter.yml†L9-L12】
- Die Coverage-Shim bevorzugt nun `sys.monitoring`, modelliert die Callbacks über streng getypte Protokolle und fällt nur noch bei belegten Tool-IDs auf klassische Trace-Hooks zurück, sodass Python-3.13-Builds ohne `sys.settrace`-Support weiterhin Zeilenabdeckung und Laufzeitmetriken erfassen; die Regressionstests bestätigen die Messung.【F:coverage.py†L1-L451】【f70812†L1-L8】
- Der Coverage-Publisher kapselt GitHub-Aufrufe über `open_github_api_url`, erzwingt HTTPS und den API-Host vor jedem Request, validiert Redirect-Ziele und ersetzt den direkten `urlopen`-Aufruf durch einen Context-Wrapper, womit Bandit B310 dauerhaft adressiert wird.【F:script/publish_coverage.py†L9-L33】【F:script/publish_coverage.py†L268-L288】【F:script/publish_coverage.py†L383-L409】
- `annotatedyaml` lädt jetzt automatisch den vendored Build, fällt aber ohne System-Paket auf das lokal gebündelte Stub-Modul zurück, sodass `script.hassfest` und die Hassfest-Tests auch in Minimalumgebungen funktionieren.【F:annotatedyaml/__init__.py†L1-L74】
- Die Test-Blueprints erhalten mit `pyyaml` eine deklarierte Abhängigkeit, womit Resilience-E2E-Läufe das YAML-Schema einlesen können.【F:requirements_test.txt†L3-L11】
- Die Performance-Benchmarks setzen den `EntityFactory`-Timing-Guard explizit auf `True`, damit Pytest 8 keine falschen Regressionen mehr meldet.【F:tests/components/pawcontrol/test_entity_performance.py†L20-L26】【F:tests/components/pawcontrol/test_entity_performance.py†L113-L118】
- Neues Guard-Skript `script/enforce_test_requirements.py` prüft automatisch, ob alle in den Tests verwendeten Drittanbieter-Module auch in `requirements_test.txt` deklariert sind, damit Importfehler künftig frühzeitig auffallen.【F:script/enforce_test_requirements.py†L1-L130】
- Der Guard hängt jetzt an den Pre-Commit-Hooks und in allen Contributor-Guides, sodass lokale Qualitäts-Gates das Requirements-Audit automatisch ausführen.【F:.github/copilot-instructions.md†L29-L53】【F:.pre-commit-config.yaml†L1-L80】【F:README.md†L31-L44】【F:CONTRIBUTING.md†L36-L44】
- Spezifische Tests sichern den `annotatedyaml`-Fallback samt Fehlermeldungen für ungültige YAML-Dateien ab und verhindern unbeabsichtigte Regressionen.【F:tests/unit/test_annotatedyaml_fallback.py†L1-L54】
- Das CI- und Coverage-Workflow führen das Requirements-Audit jetzt innerhalb der Testjobs aus, sodass fehlende Paketdeklarationen Pull-Requests sofort stoppen.【F:.github/workflows/ci.yml†L67-L86】【F:.github/workflows/coverage.yml†L23-L52】
- Der Fixture-Watcher erkennt jetzt zusätzlich Contextlib-Helfer wie `asynccontextmanager`, `nullcontext`, `closing`, `AsyncExitStack.enter_async_context` und `push_async_callback`, sodass auch verschachtelte Kontextmanager-Ketten verbotene Fixtures nicht mehr weiterreichen.【F:tests/unit/test_fixture_usage_guard.py†L240-L537】【F:tests/unit/test_fixture_usage_guard.py†L1339-L1528】
- Die Guard-Tests erfassen nun ebenfalls TaskGroup-Scheduler sowie dynamische `setattr`-Descriptor-Builder, damit auch asyncio-Helfer und Laufzeitzuweisungen keine verbotenen Fixtures mehr verstecken.【F:tests/unit/test_fixture_usage_guard.py†L189-L303】【F:tests/unit/test_fixture_usage_guard.py†L1454-L1528】
- Der Fixture-Watcher verfolgt jetzt auch `__getattr__`-/`__getattribute__`-Forwarder, dataclass-Feldfabriken und dedupliziert doppelte Meldungen, sodass dynamische Proxy-Helfer verbotene Fixtures nicht mehr durchlassen.【F:tests/unit/test_fixture_usage_guard.py†L90-L210】【F:tests/unit/test_fixture_usage_guard.py†L511-L538】【F:tests/unit/test_fixture_usage_guard.py†L888-L1009】【F:tests/unit/test_fixture_usage_guard.py†L1470-L1510】
- Neu dazu gekommen ist die Erkennung von `dataclasses.make_dataclass`-Feldern, `__class_getitem__`-Proxyketten und getattr-basierten Modul-Forwardern, wodurch auch verschachtelte dynamische Loader keine verbotenen Fixtures mehr durchrutschen lassen.【F:tests/unit/test_fixture_usage_guard.py†L420-L580】【F:tests/unit/test_fixture_usage_guard.py†L888-L1015】【F:tests/unit/test_fixture_usage_guard.py†L1521-L1617】
- Der Fixture-Watcher erkennt jetzt `types.SimpleNamespace`-Fabriken, `ModuleSpec`-Loader und `module_from_spec`-Wrapper als verbotene Alias-Wege und bringt gezielte Regressionstests für die neuen Importlib-Pfade mit.【F:tests/unit/test_fixture_usage_guard.py†L1592-L1648】
- Die Guard-Tests decken nun auch `pkgutil.resolve_name`-Aliaswege, `types.ModuleType`-Dictionary-Updates sowie `runpy.run_module`-Namespaces mit `init_globals` ab, sodass dynamische Loader keine verbotenen Fixtures mehr verstecken können.【F:tests/unit/test_fixture_usage_guard.py†L1789-L1909】
- Die Serialisierung der manuellen Resilience-Historie markiert `recorded_age` nun explizit als optionalen Integer, womit mypy die Fallback-Pfade nicht mehr beanstandet.【F:custom_components/pawcontrol/script_manager.py†L1242-L1249】
- Direkte `getattr(... )()`-Aufrufe, `pkgutil.walk_packages`-Loaderketten und `runpy.run_path`-Namespaces schlagen jetzt im Fixture-Guard an, inklusive gezielter Regressionstests für die neuen Wrapper-Pfade.【F:tests/unit/test_fixture_usage_guard.py†L183-L206】【F:tests/unit/test_fixture_usage_guard.py†L1893-L1950】
- Weitere Guard-Heuristiken verfolgen `pkgutil.iter_modules`-Spezifikationen, `importlib.resources.as_file`-Kontexte und `zipimport`-Loader, sodass selbst dynamisch konstruierte Module verbotene Fixtures nicht mehr weiterreichen.【F:tests/unit/test_fixture_usage_guard.py†L189-L236】【F:tests/unit/test_fixture_usage_guard.py†L1292-L1321】
- Der Fixture-Watcher deckt zusätzlich `importlib.resources.contents`-, `pkgutil.get_importer`- und `zipimport.zipimporter.get_source`-Ketten ab, wodurch auch diese Loader verbotene Fixtures nicht mehr durchschleusen können.【F:tests/unit/test_fixture_usage_guard.py†L1967-L2018】【F:tests/unit/test_fixture_usage_guard.py†L2052-L2070】【F:tests/unit/test_fixture_usage_guard.py†L2021-L2048】
- Neu hinzugekommen sind Regressionstests für `pkgutil.get_data`, `importlib.resources.open_binary` sowie `zipimport.zipimporter.load_module`, damit auch diese Loaderketten keine verbotenen Fixtures mehr verdecken.【F:tests/unit/test_fixture_usage_guard.py†L2030-L2080】【F:tests/unit/test_fixture_usage_guard.py†L2117-L2132】
- Der Fixture-Watcher deckt nun ebenfalls `importlib.resources.open_text`, `pkgutil.get_loader` und `zipimport.zipimporter.get_code` ab und bringt Regressionstests für die neuen Loaderpfade mit, sodass auch diese Alias-Ketten verbotene Fixtures nicht mehr durchlassen.【F:tests/unit/test_fixture_usage_guard.py†L2060-L2124】
- Die Guard-Tests sichern jetzt auch `importlib.resources.open_file`, `importlib.resources.read_binary` sowie `zipimport.zipimporter.find_module` ab, sodass selbst Kontextmanager und weitere Loaderketten keine verbotenen Fixtures mehr verstecken.【F:tests/unit/test_fixture_usage_guard.py†L2107-L2160】
- Neu hinzugekommen ist die Abdeckung für `importlib.resources.files(...).joinpath(...).open()`, `pkgutil.find_loader` und `zipimport.zipimporter.find_loader`, wodurch auch kombinierte Ressourcenpfade und modulare Finder keine verbotenen Fixtures mehr durchrutschen lassen.【F:tests/unit/test_fixture_usage_guard.py†L2163-L2182】【F:tests/unit/test_fixture_usage_guard.py†L2185-L2206】【F:tests/unit/test_fixture_usage_guard.py†L2225-L2242】
- Die Guard-Tests erkennen jetzt zusätzlich `importlib.resources.files(...).joinpath(...).read_text()` sowie `zipimport.zipimporter.find_spec`, damit textbasierte Ressourcenpfade und neue Spezifikationsfinder keine verbotenen Fixtures mehr verdecken.【F:tests/unit/test_fixture_usage_guard.py†L2363-L2392】【F:tests/unit/test_fixture_usage_guard.py†L2608-L2634】
- Neu hinzugekommen ist die Abdeckung für `files(...).joinpath(...).with_suffix(...).open_text()`, verschachtelte `spec.loader`-Ketten und `invalidate_caches`-Wrapper, sodass auch kombinierte Importlib-/Zipimport-Helfer keine verbotenen Fixtures mehr verstecken.【F:tests/unit/test_fixture_usage_guard.py†L2492-L2538】【F:tests/unit/test_fixture_usage_guard.py†L2687-L2731】
- Der Fixture-Watcher erkennt jetzt auch Pfadhelfer wie `with_name`, `with_stem`, `relative_to` sowie `spec.loader.exec_module`-Rückgaben, wodurch weitere Importlib-Ressourcenketten keine verbotenen Fixtures mehr tarnen.【F:tests/unit/test_fixture_usage_guard.py†L2539-L2609】【F:tests/unit/test_fixture_usage_guard.py†L2275-L2337】
- Der Fixture-Watcher folgt jetzt auch `with_segments`-, `resolve`- und `parent.joinpath`-Pfaden sowie `setdefault`-Mutationen, damit selbst nachgelagerte Loader-Ketten oder `exec_module`-Callbacks keine verbotenen Fixtures mehr verstecken.【F:tests/unit/test_fixture_usage_guard.py†L2841-L2904】【F:tests/unit/test_fixture_usage_guard.py†L2543-L2577】【F:tests/unit/test_fixture_usage_guard.py†L441-L512】
- Die Guard-Heuristiken decken nun zusätzlich `Path.parents[...]`-Zugriffe ab, sodass auch `parents[0]`- und `parents[2]`-Ketten keine verbotenen Fixtures mehr verschleiern; Regressionstests sichern die neuen Importlib-Ressourcenpfade.【F:tests/unit/test_fixture_usage_guard.py†L3044-L3098】
- Die Prioritäts-Stabilisierungsroutine des `EntityFactory` nutzt jetzt einen LRU-Cache, wodurch die deterministische Workload-Signatur nur einmal pro Modul/Prioritäts-Kombination berechnet werden muss; dadurch sinkt die Streuung der Performance-Tests trotz aktivem Timing-Guard.【F:custom_components/pawcontrol/entity_factory.py†L41-L57】【F:custom_components/pawcontrol/entity_factory.py†L806-L808】
- Die Performance-Skalierungs- und Produktions-Benchmarks erzwingen den Timing-Guard explizit, sodass die Varianz-Grenzen auch unter Pytest 8 stabil eingehalten werden.【F:tests/components/pawcontrol/test_entity_performance_scaling.py†L105-L110】【F:tests/components/pawcontrol/test_entity_performance_scaling.py†L678-L683】

## Fehlerliste
- Pytest-Vollsuite lokal sehr zeitintensiv (Abbruch nach 555 bestandenen Tests). Für vollständige Sicherheit sollte der Durchlauf mit mehr Ressourcen wiederholt werden; bislang keine regressionsbedingten Fehlschläge sichtbar.【a54575†L1-L8】
- ✅ Behoben: Die Binärsensoren verursachten zahlreiche mypy-Fehler wegen untypisierter `dict.get`-Zugriffe; die neuen `int | float`-/`str`-Guards und Mapping-Prüfungen beseitigen die Beanstandungen dauerhaft.【F:custom_components/pawcontrol/binary_sensor.py†L875-L1433】【F:custom_components/pawcontrol/binary_sensor.py†L1660-L1833】【253fe8†L1-L1】
- ✅ Behoben: `mypy --config-file pyproject.toml custom_components/pawcontrol` läuft wieder ohne Fehler, weil Datumskonvertierungen und Cache-Klone jetzt strikt typisiert sind.【F:custom_components/pawcontrol/utils.py†L170-L178】【F:custom_components/pawcontrol/utils.py†L1376-L1499】【F:custom_components/pawcontrol/dashboard_templates.py†L690-L699】【af30db†L1-L1】
- ✅ Behoben: WalkManager-, Door-Sensor- und Moduladapter-Snapshots erfüllen wieder alle TypedDict-Verträge; mypy läuft nach den gezielten Anpassungen ohne Restfehler.【F:custom_components/pawcontrol/walk_manager.py†L500-L520】【F:custom_components/pawcontrol/walk_manager.py†L1426-L1492】【F:custom_components/pawcontrol/door_sensor_manager.py†L1184-L1212】【F:custom_components/pawcontrol/module_adapters.py†L351-L383】【fee465†L1-L1】
- ✅ Behoben: Die Kompatibilitäts-Shims (`selector_shim`, `ensure_utc_datetime`) spiegeln wieder die offiziellen Home-Assistant-Typen, sodass `mypy` auch unter der Stub-Laufzeit ohne Konflikte durchläuft; ein Vollabgleich mit echten Core-Paketen bleibt nach Upstream-Releases vorgesehen.【F:custom_components/pawcontrol/selector_shim.py†L1-L170】【F:custom_components/pawcontrol/utils.py†L1376-L1499】【978cc9†L1-L2】
- ✅ Behoben: Die Performance-Skalierungstests (`test_single_dog_performance`, `test_concurrent_operations_scaling`, `test_profile_performance_distribution`, `test_cache_efficiency_under_load`) scheiterten, weil `_ensure_min_runtime` auf CI-Runnern Submillisekunden-Schlafdauern überzog. Der Guard nutzt jetzt nur noch für Wartezeiten über 1,5 ms grobe Sleeps und fällt bei kürzeren Intervallen auf einen eng überwachten Spin-Wait mit gelegentlichem `time.sleep(0)` zurück, wodurch die Benchmarks wieder unter den geforderten Schwellen bleiben.【F:custom_components/pawcontrol/entity_factory.py†L805-L834】【cea389†L1-L9】

## Verbesserungsplan
1. **Vendor-Pfad beobachten.** Bei kommenden Home-Assistant-Releases prüfen, ob der echte `annotatedyaml` Build verfügbar ist und das Fallback nachgelagert aufräumen.【F:annotatedyaml/__init__.py†L28-L74】
2. **Fixture-Watcher pflegen.** Neue Companion-, Voice- oder Supervisor-Hilfsfixtures beobachten und den Guard bei Bedarf um zusätzliche Prüfungen erweitern – insbesondere falls künftige `hassfest`-Versionen weitere Loader-Ketten wie Companion-Proxys für neue Clients einführen.【F:tests/unit/test_fixture_usage_guard.py†L9-L120】【F:tests/unit/test_fixture_usage_guard.py†L2363-L2634】
3. **Wrapper-Erkennung weiterdenken.** Beobachte kombinierte Ressourcenpfade wie `Path.parents[1].with_segments(...).open_text()` oder `parents[0].resolve().joinpath(...)` sowie weitere `exec_module`-Callbacks, die Module via `setitem`/`setdefault` nachträglich mutieren, damit keine neuen Alias-Formen durchrutschen.【F:tests/unit/test_fixture_usage_guard.py†L441-L512】【F:tests/unit/test_fixture_usage_guard.py†L2841-L2904】【F:tests/unit/test_fixture_usage_guard.py†L2543-L2577】
4. **Routenexport-Endpunkte absichern.** Nach den neuen Gerätetests zusätzlich die Service- und Koordinatorpfade mit Snapshot- oder End-to-End-Tests abdecken, damit die `GPSRouteExportPayload`-Verträge auch bei Mehrfach-Routen stabil bleiben.【F:custom_components/pawcontrol/device_tracker.py†L720-L912】【F:tests/unit/test_device_tracker.py†L70-L119】
5. **Vollinstallation validieren.** Nach Home-Assistant-Releases erneut `mypy` und `hassfest` gegen eine echte Laufzeit fahren, sobald die Upstream-Pakete aktualisiert sind, damit die in `pyproject.toml` hinterlegten Strictness-Gates auch außerhalb der Stub-Umgebung eingehalten bleiben.【F:pyproject.toml†L37-L72】
6. **Übersetzungsabdeckung ausweiten.** Prüfe mittelfristig, ob neben den Setup-Flags weitere Schlüssel automatisch gespiegelt oder via JSON-Schema getestet werden sollten; derselbe Workflow kann zusätzliche Konsistenzprüfungen übernehmen, sobald neue Kategorien als kritisch gelten.【F:.github/workflows/ci.yml†L120-L156】【F:script/sync_localization_flags.py†L1-L158】
7. **Runtime-Guard-Monitoring.** Beobachte bei kommenden Benchmark-Anpassungen, ob die Hybrid-Strategie aus Grobschlaf und Feintuning weitere Optimierung braucht oder optional per Feature-Flag deaktiviert werden muss, falls Plattformen ohne Hochfrequenz-Timer auftauchen.【F:custom_components/pawcontrol/entity_factory.py†L796-L818】
8. **Geofencing-Speicher E2E validieren.** Einen Coordinator-/Diagnostics-Test ergänzen, der gespeicherte Zonen mitsamt `metadata` lädt und `_notify_zone_event` auslöst, damit die neuen Storage-TypedDicts end-to-end verifiziert bleiben.【F:custom_components/pawcontrol/geofencing.py†L151-L221】【F:tests/unit/test_geofencing.py†L19-L111】
9. **Wetter-Übersetzungen testen.** Einen gezielten Test für `_get_translation` und `_resolve_translation_value` ergänzen, damit Sprachpräfixe und Fallbacks dauerhaft abgesichert bleiben.【F:custom_components/pawcontrol/weather_manager.py†L414-L477】
10. **Button-Snapshots absichern.** Einen gezielten Test ergänzen, der die neuen ButtonExtraAttributes und Modul-Casts gegen den Koordinator-Cache prüft, damit die gepufferten Datenstrukturen langfristig stabil bleiben.【F:custom_components/pawcontrol/button.py†L780-L868】【F:custom_components/pawcontrol/button.py†L1312-L1964】
11. **Binärsensor-Edge-Cases testen.** Zusatzfälle für Gesundheitsnotfälle und Geofence-Alarme simulieren, damit `PawControlHealthEmergencyBinarySensor` und `PawControlGeofenceAlertBinarySensor` auch bei fehlerhaften Payloads typisierte Defaults liefern.【F:custom_components/pawcontrol/binary_sensor.py†L1362-L1426】【F:custom_components/pawcontrol/binary_sensor.py†L1750-L1833】
12. **Config-Flow E2E validieren.** Einen UI-Flow-Test ergänzen, der die neuen TypedDict-Eingaben für Module-, Dashboard- und Feeding-Schritte end-to-end prüft, damit reale Setups die strukturierten Payloads verwenden.【F:custom_components/pawcontrol/config_flow_modules.py†L137-L249】【F:tests/unit/test_config_flow_modules.py†L21-L142】

## Monitoring & Rhythmus
- Durchlaufe monatlich die Aufgaben aus `docs/MAINTENANCE.md`, damit Lokalisierungen, Diagnostik und Qualitätsnachweise aktuell bleiben.【F:docs/MAINTENANCE.md†L1-L40】
- Aktualisiere nach Feature-Änderungen die Contributor-Guides per `python -m script.sync_contributor_guides`, damit alle Assistenten dieselben Richtlinien ausliefern.【F:script/sync_contributor_guides.py†L1-L92】
