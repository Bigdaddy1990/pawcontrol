# Development plan

## Quality gate expectations
- Run `ruff check`, `pytest -q`, `mypy custom_components/pawcontrol`, and `python -m script.hassfest --integration-path custom_components/pawcontrol` before opening a pull request so Platinum-level guardrails stay enforced.【F:.github/copilot-instructions.md†L10-L28】
- Target Python 3.13+ features and reuse PawControl helpers (coordinators, managers, and typed constants) to keep runtime data on the typed surface.【F:.github/copilot-instructions.md†L29-L94】

## Latest tooling snapshot
- ✅ `ruff check` – passes after reorganising the dashboard card imports for the literal dog field migration.【a72016†L1-L2】
- ✅ `pytest -q` – full suite passes (941 passed, 1 skipped).【797f98†L1-L5】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – exited cleanly with no findings.【d9f0e6†L1-L2】
- ❌ `mypy custom_components/pawcontrol` – strict typing now fails with 32 errors concentrated in the button, binary sensor, config flow, and dashboard generator helpers that still require literal field aliases or stub updates.【f1ffd2†L1-L47】

## Recent improvements
- Migrated the dashboard card generators to literal dog field aliases, updating
  module lookups and optional image metadata so gather helpers operate on
  `DogConfigData` without stringly typed keys.【F:custom_components/pawcontrol/dashboard_cards.py†L432-L506】【F:custom_components/pawcontrol/dashboard_cards.py†L790-L908】【F:custom_components/pawcontrol/types.py†L2160-L2187】
- Streamlined `_normalise_options_snapshot` to mutate plain dictionaries before
  casting, ensuring notifications, per-dog overrides, and advanced settings all
  funnel through typed helpers without triggering literal-key errors.【F:custom_components/pawcontrol/options_flow.py†L244-L297】
- Hardened weather settings normalisation by constraining notification
  thresholds to `NotificationThreshold`, coercing coordinator defaults only when
  they match the expected types, and reusing the clamped interval helper so GPS
  options remain strictly typed.【F:custom_components/pawcontrol/options_flow.py†L870-L908】
- Converted profile estimators to operate on concrete module dictionaries while
  reusing the mapping views for validation, keeping entity projections typed for
  both previews and description placeholders.【F:custom_components/pawcontrol/options_flow.py†L1472-L1592】
- Typed the number, date, and datetime platform batching helpers to consume
  `DogConfigData` and `DogModulesMapping`, and guarded food recommendations
  against missing native values so entity attributes stay safe under mypy.【F:custom_components/pawcontrol/number.py†L123-L205】【F:custom_components/pawcontrol/number.py†L520-L707】【F:custom_components/pawcontrol/date.py†L180-L226】【F:custom_components/pawcontrol/datetime.py†L104-L160】
- Reworked the config-flow dashboard step so setup now emits literal-typed
  `DashboardSetupConfig` keys, normalises booleans, and only schedules the
  GPS entity step when module toggles warrant it.【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L75-L156】
- Updated the base config-flow helpers to index dogs through the literal field
  aliases, compute presentation strings safely, and keep suggestion utilities
  typed when iterating through `DogConfigData` payloads.【F:custom_components/pawcontrol/config_flow_base.py†L285-L441】
- Normalised text, switch, sensor, and select entity setup to rely on
  `DogConfigData` and `DogModulesConfig`, preventing `object` fallbacks while
  exposing module toggles through typed accessors for Platinum telemetry.【F:custom_components/pawcontrol/text.py†L155-L205】【F:custom_components/pawcontrol/switch.py†L260-L310】【F:custom_components/pawcontrol/sensor.py†L181-L276】【F:custom_components/pawcontrol/select.py†L200-L306】
- Added literal dashboard field aliases so front-end, diagnostics, and setup
  helpers share a single TypedDict surface for telemetry caching.【F:custom_components/pawcontrol/types.py†L1048-L1096】
- Hardened integration setup by casting service registry checks away from
  unittest mocks, transforming typed dog payloads into manager-friendly
  dictionaries, guarding optional coordinator callables, and refining integer
  coercion for fractional `Real` inputs so strict typing no longer flags the
  setup path—reducing the mypy backlog to 190 errors.【F:custom_components/pawcontrol/__init__.py†L600-L878】【F:custom_components/pawcontrol/validation.py†L132-L195】
- Replaced tuple-based entity caches with typed dataclasses, normalised
  availability/attribute timestamp handling, and widened the sentinel
  coordinator typing so optimized entities reuse strictly typed payloads while
  hass-less registry sentinels continue to satisfy mypy’s requirements.【F:custom_components/pawcontrol/optimized_entity_base.py†L80-L118】【F:custom_components/pawcontrol/optimized_entity_base.py†L567-L908】
- Normalised the platform cache retrieval, coordinator statistics accessors,
  and service execution diagnostics so cached platform tuples stay immutable,
  guard payloads record resilience summaries, and coordinator helpers expose
  structured telemetry, trimming the strict-typing backlog to 200 errors.【F:custom_components/pawcontrol/__init__.py†L320-L386】【F:custom_components/pawcontrol/coordinator.py†L452-L516】【F:custom_components/pawcontrol/services.py†L406-L520】【F:custom_components/pawcontrol/types.py†L1798-L1804】
- Tightened the weather module adapter fallback, helper guard diagnostics, and
  coordinator task typing so weather payload caching, guard telemetry exports,
  and module fetch loops operate on literal module names without duplicate
  annotations.【F:custom_components/pawcontrol/module_adapters.py†L560-L625】【F:custom_components/pawcontrol/helper_manager.py†L160-L276】【F:custom_components/pawcontrol/coordinator_runtime.py†L1-L94】【F:custom_components/pawcontrol/types.py†L1438-L1472】
- Normalised walk route telemetry with the new `WalkRoutePoint` typed dict,
  updated cache monitor registration to expose typed snapshot providers without
  reusing configuration buffers for entry IDs, extended repairs metadata with
  timestamp anomaly tracking, and populated coordinator performance metrics via
  explicit guard-field assignments so strict typing accepts the rejection
  telemetry surface.【F:custom_components/pawcontrol/types.py†L1588-L1604】【F:custom_components/pawcontrol/types.py†L2736-L2780】【F:custom_components/pawcontrol/data_manager.py†L904-L935】【F:custom_components/pawcontrol/data_manager.py†L2330-L2349】【F:custom_components/pawcontrol/coordinator_tasks.py†L724-L765】
- Guarded dog configuration merges to only treat stored mappings as mutable
  dictionaries, exported rejection metrics through typed payloads before
  snapshot serialisation, widened module adapter bindings to accept optional
  managers, and provided a writable runtime manager property plus typed module
  access overloads so coordinator consumers stay aligned with the
  `CoordinatorRuntimeManagers` container.【F:custom_components/pawcontrol/data_manager.py†L2424-L2428】【F:custom_components/pawcontrol/coordinator_observability.py†L11-L13】【F:custom_components/pawcontrol/coordinator_observability.py†L122-L131】【F:custom_components/pawcontrol/module_adapters.py†L742-L763】【F:custom_components/pawcontrol/coordinator.py†L69-L75】【F:custom_components/pawcontrol/coordinator.py†L282-L292】【F:custom_components/pawcontrol/coordinator.py†L435-L448】
- Validated the Lovelace statistics view’s resilience metrics markdown with
  integration coverage and refreshed README plus quickstart guidance so the
  packaged Platinum dashboard exposes the rejection counters without manual
  tweaks.【F:tests/components/pawcontrol/test_dashboard_renderer.py†L56-L140】【F:README.md†L753-L780】【F:docs/resilience-quickstart.md†L181-L186】
- Hardened script automation caching, person state tracking, and geofencing/
  weather module payload builders so the mypy backlog drops to 242 errors while
  keeping diagnostics snapshots fully typed.【F:custom_components/pawcontrol/script_manager.py†L86-L220】【F:custom_components/pawcontrol/person_entity_manager.py†L326-L404】【F:custom_components/pawcontrol/module_adapters.py†L348-L654】
- Normalised advanced options, dog configuration door sensor fields, and coordinator empty payload scaffolding to rely on string-literal TypedDict keys, while aligning the circuit breaker error hierarchy with the Home Assistant exception type so strict typing no longer flags the coordinator defaults.【F:custom_components/pawcontrol/types.py†L514-L576】【F:custom_components/pawcontrol/types.py†L2235-L2265】【F:custom_components/pawcontrol/coordinator_support.py†L302-L349】【F:custom_components/pawcontrol/resilience.py†L60-L118】
- Routed coordinator statistics snapshots through the dashboard generator and renderer so the statistics summary now surfaces rejection metrics alongside module counts, with updated diagnostics documentation and targeted regression coverage for the new resilience block.【F:custom_components/pawcontrol/dashboard_generator.py†L120-L226】【F:custom_components/pawcontrol/dashboard_renderer.py†L148-L222】【F:custom_components/pawcontrol/dashboard_templates.py†L1330-L1399】【F:docs/diagnostik.md†L30-L39】【F:tests/unit/test_dashboard_generator.py†L210-L272】【F:tests/unit/test_dashboard_templates.py†L390-L436】
- Captured garden service validation payloads and enforced non-empty validation messages so telemetry records failed confirmations and activities, with regression tests covering the new diagnostics surfaces.【F:custom_components/pawcontrol/services.py†L139-L180】【F:custom_components/pawcontrol/services.py†L3835-L4089】【F:tests/components/pawcontrol/test_services.py†L238-L318】【F:tests/unit/test_services.py†L38-L90】
- Updated the compliance gap analysis and README Platinum callouts to flag strict typing, resilience UI validation, and documentation blockers so reviewers can track outstanding Platinum work alongside the new resilience telemetry.【F:docs/compliance_gap_analysis.md†L16-L43】【F:README.md†L1139-L1150】
- Hardened device removal gating by merging runtime data and options-sourced dogs before allowing cleanup and expanded regression coverage for runtime, options, and foreign-device scenarios.【F:custom_components/pawcontrol/__init__.py†L1485-L1532】【F:tests/components/pawcontrol/test_init.py†L1001-L1118】
- Shared `CONF_DOOR_SENSOR_SETTINGS` across helpers so stored overrides no longer rely on bespoke keys.【F:custom_components/pawcontrol/const.py†L129-L142】
- Normalised door sensor overrides through `_coerce_bool` and companion helpers before persisting them, ensuring reloads retain clamped values without restarting monitors unnecessarily.【F:custom_components/pawcontrol/door_sensor_manager.py†L40-L347】【F:custom_components/pawcontrol/types.py†L1921-L1995】
- Expanded regression coverage to assert alias handling, numeric toggle coercion, persistence, removals, and no-op updates for the door sensor manager workflow.【F:tests/unit/test_door_sensor_manager.py†L23-L310】
- Hardened door sensor initialisation so non-string entity IDs and unsupported override payloads are ignored before normalisation, keeping runtime persistence typed and backed by regression coverage.【F:custom_components/pawcontrol/door_sensor_manager.py†L721-L808】【F:tests/unit/test_door_sensor_manager.py†L292-L339】
- Added a door sensor configuration step to the options flow that normalises overrides via `ensure_door_sensor_settings_config`, persists changes through `PawControlDataManager.async_update_dog_data`, and verifies normal/removal paths with targeted unit tests.【F:custom_components/pawcontrol/options_flow.py†L2105-L2255】【F:tests/unit/test_options_flow.py†L162-L276】
- Re-exported `DEFAULT_CONFIDENCE_THRESHOLD` from the door sensor manager so downstream helpers and tests can import the canonical threshold and dataclass defaults stay aligned with the typed settings model.【F:custom_components/pawcontrol/door_sensor_manager.py†L44-L60】【F:custom_components/pawcontrol/door_sensor_manager.py†L474-L488】
- Captured door sensor persistence failures by logging runtime telemetry, raising repair issues, and surfacing diagnostics plus localized guidance, with regression coverage for the error path and snapshot exports.【F:custom_components/pawcontrol/options_flow.py†L2183-L2259】【F:custom_components/pawcontrol/telemetry.py†L164-L233】【F:custom_components/pawcontrol/repairs.py†L50-L419】【F:custom_components/pawcontrol/diagnostics.py†L137-L150】【F:custom_components/pawcontrol/diagnostics.py†L695-L748】【F:custom_components/pawcontrol/strings.json†L1317-L1320】【F:tests/unit/test_options_flow.py†L1327-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L142-L214】
- Tightened discovery orchestration to coerce requested categories into typed lists, guard `asyncio.gather` results against `BaseException`, and collapse duplicate registry results by confidence so asynchronous scans stay deterministic under mypy.【F:custom_components/pawcontrol/discovery.py†L1-L182】【F:custom_components/pawcontrol/discovery.py†L437-L454】
- Normalised coordinator diagnostics by coercing raw statistics into `CoordinatorStatisticsPayload`, backfilling rejection metrics, and merging legacy keys so telemetry stays typed while redaction tests retain their expectations.【F:custom_components/pawcontrol/diagnostics.py†L688-L840】
- Converted module adapter caches to Python 3.13 type-parameter syntax and now accept typed module flag mappings so coordinator tasks no longer funnel through `dict[str, Any]` payload stubs before scheduling adapter fetches.【F:custom_components/pawcontrol/module_adapters.py†L63-L174】【F:custom_components/pawcontrol/module_adapters.py†L794-L814】
- Typed the coordinator payload pipeline end-to-end by introducing `CoordinatorDogData`, defaulting module states to `"unknown"`, and updating runtime helpers to return structured telemetry snapshots instead of loose dictionaries.【F:custom_components/pawcontrol/types.py†L1855-L1902】【F:custom_components/pawcontrol/coordinator_support.py†L46-L330】【F:custom_components/pawcontrol/coordinator_runtime.py†L324-L465】【F:custom_components/pawcontrol/coordinator.py†L150-L357】【F:custom_components/pawcontrol/coordinator_accessors.py†L1-L47】
- Typed the module adapter protocol end-to-end by introducing `ModuleCacheMetrics`, `CoordinatorModuleTask`, and `CoordinatorRuntimeManagers`, updating adapters, runtime fetchers, and diagnostics monitors to operate on structured tasks and cache metrics instead of dictionary shims.【F:custom_components/pawcontrol/types.py†L1296-L1351】【F:custom_components/pawcontrol/module_adapters.py†L777-L876】【F:custom_components/pawcontrol/coordinator_runtime.py†L428-L466】【F:custom_components/pawcontrol/coordinator_support.py†L196-L625】【F:custom_components/pawcontrol/data_manager.py†L376-L450】
- Normalised coordinator data access to return typed module payloads by extending `CoordinatorDataAccessMixin`/`PawControlCoordinator`, wiring runtime manager containers through dedicated accessors, and adding regression coverage for typed versus untyped module fallbacks.【F:custom_components/pawcontrol/coordinator_accessors.py†L1-L83】【F:custom_components/pawcontrol/coordinator.py†L1-L335】【F:tests/unit/test_coordinator_accessors.py†L1-L57】
- Routed entity caches, select/button platforms, and service validators through the shared `CoordinatorRuntimeManagers` container so typed module payloads and persistence helpers no longer depend on direct attribute shims, with regression coverage exercising the new pathways.【F:custom_components/pawcontrol/optimized_entity_base.py†L741-L855】【F:custom_components/pawcontrol/select.py†L433-L504】【F:custom_components/pawcontrol/button.py†L933-L949】【F:custom_components/pawcontrol/services.py†L1149-L1660】【F:custom_components/pawcontrol/types.py†L2292-L2345】【F:tests/components/pawcontrol/test_select_entities.py†L24-L133】【F:tests/unit/test_coordinator.py†L205-L225】
- Extended runtime manager container usage to sensors, numbers, switches, and diagnostics so entity helpers resolve managers through shared accessors without legacy attribute fallbacks, and select helpers/tests reuse the containerised lookup path.【F:custom_components/pawcontrol/entity.py†L1-L160】【F:custom_components/pawcontrol/sensor.py†L904-L925】【F:custom_components/pawcontrol/number.py†L600-L618】【F:custom_components/pawcontrol/switch.py†L500-L553】【F:custom_components/pawcontrol/diagnostics.py†L40-L450】【F:custom_components/pawcontrol/select.py†L424-L446】【F:tests/components/pawcontrol/test_all_platforms.py†L207-L230】【F:tests/unit/test_services.py†L494-L522】
- Routed garden binary sensors, birthdate telemetry, emergency datetime notifications, and custom message text entities through the shared runtime manager container so fallbacks resolve managers even when coordinator attributes are absent, with targeted regression coverage for garden, date/datetime, and notification workflows.【F:custom_components/pawcontrol/binary_sensor.py†L537-L576】【F:custom_components/pawcontrol/date.py†L573-L731】【F:custom_components/pawcontrol/datetime.py†L327-L675】【F:custom_components/pawcontrol/text.py†L287-L724】【F:tests/unit/test_runtime_manager_container_usage.py†L85-L327】
- Added `_async_call_hass_service` to the entity base and wired date, datetime, and text helpers through it so hass-less entities skip service calls cleanly, with new regression coverage exercising the guard behaviour.【F:custom_components/pawcontrol/entity.py†L5-L198】【F:custom_components/pawcontrol/date.py†L573-L731】【F:custom_components/pawcontrol/datetime.py†L327-L675】【F:custom_components/pawcontrol/text.py†L287-L724】【F:tests/unit/test_runtime_manager_container_usage.py†L260-L327】
- Routed visitor mode switches, module feature toggles, and garden confirmation buttons through `_async_call_hass_service` so hass-less contexts short-circuit safely, and expanded runtime manager container tests to assert the new guard paths.【F:custom_components/pawcontrol/switch.py†L578-L806】【F:custom_components/pawcontrol/button.py†L1871-L1908】【F:tests/unit/test_runtime_manager_container_usage.py†L332-L374】
- Centralised Home Assistant service guards via `async_call_hass_service_if_available`, wiring helper creation/removal, notification delivery, entity helpers, and the legacy notification queue through the shared guard so hass-less contexts short-circuit with regression coverage for helper creation and persistent notification acknowledgement.【F:custom_components/pawcontrol/utils.py†L169-L263】【F:custom_components/pawcontrol/entity.py†L170-L194】【F:custom_components/pawcontrol/helper_manager.py†L563-L944】【F:custom_components/pawcontrol/notifications.py†L1460-L1806】【F:custom_components/pawcontrol/helpers.py†L1406-L1477】【F:tests/unit/test_data_manager.py†L333-L365】【F:tests/unit/test_notifications.py†L737-L756】
- Captured guard telemetry for Home Assistant service calls by introducing `ServiceGuardResult`/`ServiceGuardSummary`, a context manager for aggregating guard outcomes, and persistence in `_record_service_result`, with notification and grooming/GPS services recording whether calls executed or skipped and regression coverage validating guard skip metrics.【F:custom_components/pawcontrol/service_guard.py†L1-L46】【F:custom_components/pawcontrol/utils.py†L187-L264】【F:custom_components/pawcontrol/services.py†L384-L473】【F:tests/unit/test_services.py†L741-L780】
- Aggregated helper manager guard metrics into cache diagnostics by tracking every guarded helper service call, exporting `service_guard_metrics`, and covering hass-less creation/removal flows with new regression tests.【F:custom_components/pawcontrol/helper_manager.py†L166-L283】【F:custom_components/pawcontrol/helper_manager.py†L628-L1016】【F:custom_components/pawcontrol/types.py†L1252-L1273】【F:custom_components/pawcontrol/types.py†L1473-L1506】【F:tests/unit/test_data_manager.py†L304-L426】
- Normalised advanced options snapshots through `ensure_advanced_options`, wiring `_normalise_options_snapshot`, `_current_advanced_options`, and `_build_advanced_settings` to reuse the typed helper while regression tests assert legacy payloads coerce correctly.【F:custom_components/pawcontrol/types.py†L455-L551】【F:custom_components/pawcontrol/options_flow.py†L248-L295】【F:custom_components/pawcontrol/options_flow.py†L676-L683】【F:custom_components/pawcontrol/options_flow.py†L1080-L1109】【F:tests/unit/test_options_flow.py†L923-L1061】
- Exported guarded service telemetry through the new `service_execution` diagnostics block, updated the README and diagnostics guide with guard metric locations, and expanded diagnostics regression coverage to assert guard summaries and metadata stay serialisable for support tooling.【F:custom_components/pawcontrol/diagnostics.py†L780-L867】【F:README.md†L722-L741】【F:docs/diagnostik.md†L31-L38】【F:tests/components/pawcontrol/test_diagnostics.py†L129-L203】
- Canonicalised performance mode constants so the select platform, advanced options, and helpers share the `balanced` default while preserving the legacy `standard` alias, with regression tests covering alias normalisation and option alignment.【F:custom_components/pawcontrol/types.py†L456-L509】【F:custom_components/pawcontrol/const.py†L341-L347】【F:custom_components/pawcontrol/select.py†L23-L43】【F:custom_components/pawcontrol/select.py†L763-L779】【F:tests/unit/test_types_performance_mode.py†L1-L35】
- Synced documentation and configuration copy with the balanced performance default by documenting the alias handling in the README, diagnostics guide, and advanced option translations so users see the canonical mode and backwards-compatible `standard` mapping during setup.【F:README.md†L292-L296】【F:docs/diagnostik.md†L43-L48】【F:custom_components/pawcontrol/strings.json†L293-L297】【F:custom_components/pawcontrol/translations/en.json†L296-L303】【F:custom_components/pawcontrol/translations/de.json†L296-L303】

## Error backlog
1. **Strict typing debt** – mypy still reports 32 errors across the button, binary sensor, config flow, and dashboard generator helpers; adopt literal field aliases and update missing stubs before re-enabling the strict gate.【f1ffd2†L1-L47】
2. **Diagnostics schema monitoring** – coordinator and diagnostics payloads must keep the rejection metrics schema aligned with the Platinum dashboard expectations; continue validating telemetry and docs whenever payloads evolve.【F:custom_components/pawcontrol/coordinator_observability.py†L82-L150】【F:custom_components/pawcontrol/diagnostics.py†L602-L666】【F:docs/diagnostik.md†L24-L48】
3. **Config-flow harness stability** – compat shims and tests ensure exception aliases stay rebound after reloads; reconfigure/update flows still need focused validation work.【F:custom_components/pawcontrol/compat.py†L93-L218】【F:tests/components/pawcontrol/test_config_flow.py†L40-L120】【F:tests/helpers/homeassistant_test_stubs.py†L1852-L1875】
4. **Resilience telemetry follow-up** – continue validating circuit breaker metrics across diagnostics and documentation as dashboard UX evolves, keeping resilience payloads aligned with Platinum reviewer expectations.【F:custom_components/pawcontrol/resilience.py†L200-L312】【F:custom_components/pawcontrol/coordinator_tasks.py†L672-L829】【F:docs/diagnostik.md†L24-L48】
5. **Notification quiet-hours fixture** – the time patch remains critical for Python 3.13 compatibility; audit remaining call sites for naive `dt.now` usage before expanding automation coverage.【F:tests/unit/test_notifications.py†L371-L404】

## Improvement opportunities
- Keep Copilot, Claude, and Gemini contributor instructions synchronised whenever workflows (such as door sensor overrides) change so community PRs follow the same Platinum guardrails.【F:.github/copilot-instructions.md†L1-L110】【F:.claude/agents/copilot-instructions.md†L1-L120】【F:.gemini/styleguide.md†L1-L40】
- Continue monitoring `_coerce_bool` telemetry for unexpected payloads and extend regression coverage if new shapes surface from legacy options.【F:custom_components/pawcontrol/door_sensor_manager.py†L90-L180】【F:tests/unit/test_door_sensor_manager.py†L86-L170】
- Track resilience UI updates so diagnostics, docs, and coordinator observability stay aligned with the latest rejection metrics schema.【F:custom_components/pawcontrol/coordinator_observability.py†L82-L150】【F:docs/diagnostik.md†L24-L48】

## Next sprint priorities
1. **Device removal compliance** – Fold the new runtime/options safeguards into compliance tracking and complete manual removal validation so the Platinum blocker can close confidently.【F:custom_components/pawcontrol/__init__.py†L1485-L1532】【F:tests/components/pawcontrol/test_init.py†L1001-L1118】【F:docs/compliance_gap_analysis.md†L16-L25】
2. **Strict typing remediation** – Continue reducing the 32-error backlog so `mypy custom_components/pawcontrol` can return to green and Platinum quality gates stay enforceable.【f1ffd2†L1-L47】
3. **Coverage automation** – Restore automated coverage publication once the Home Assistant harness stabilises so Platinum evidence remains auditable without manual uploads.【F:README.md†L24-L70】【F:docs/compliance_gap_analysis.md†L16-L25】

## Regression coverage highlights
- `tests/unit/test_door_sensor_manager.py` protects alias handling, numeric toggle coercion, persistence through the data manager, removals, and monitoring restarts for the door sensor manager helpers.【F:tests/unit/test_door_sensor_manager.py†L23-L310】
- Config flow and compat tests safeguard the exception rebinding harness so reloads keep using the active Home Assistant exceptions.【F:tests/components/pawcontrol/test_config_flow.py†L40-L120】【F:tests/unit/test_exception_alias_rebinds.py†L1-L184】
- Door sensor persistence failure and diagnostics telemetry are exercised through targeted unit tests to ensure repair issues fire and telemetry surfaces in snapshots.【F:tests/unit/test_options_flow.py†L1327-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L142-L214】
- Runtime manager container regression tests cover garden binary sensors, birthdate persistence, emergency notifications, custom message routing, and hass-guarded visitor buttons/switches to prevent regressions when hass-free stubs exercise manager fallbacks.【F:tests/unit/test_runtime_manager_container_usage.py†L82-L374】
- Garden service regression tests now assert confirmation and activity failures capture payload telemetry for diagnostics and service statistics.【F:tests/components/pawcontrol/test_services.py†L238-L318】【F:tests/unit/test_services.py†L38-L90】
