# Development plan

## Quality gate expectations
- Run `ruff check`, `pytest -q`, `mypy custom_components/pawcontrol`, and `python -m script.hassfest --integration-path custom_components/pawcontrol` before opening a pull request so Platinum-level guardrails stay enforced.【F:.github/copilot-instructions.md†L10-L28】
- Target Python 3.13+ features and reuse PawControl helpers (coordinators, managers, and typed constants) to keep runtime data on the typed surface.【F:.github/copilot-instructions.md†L29-L94】

## Latest tooling snapshot
- ✅ `ruff check` – keine Abweichungen nach der Coverage-Filter-/Tracing-Erweiterung.【7deda4†L1-L2】
- ❌ `PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 python -m pytest --cov=custom_components/pawcontrol --cov-report=term:skip-covered --cov-report=xml:generated/coverage/coverage.xml --cov-report=html:generated/coverage tests/` – abgebrochen nach 13 Fehlern, weil `DogConfigRegistry` in den bestehenden Stubs keine Polling-Limits validiert; die Regression bleibt bis zur Registry-Reparatur dokumentiert.【0fa5b5†L1-L112】
- ❌ `mypy custom_components/pawcontrol` – typisierte Laufzeitmodule der Home-Assistant-Stubs fehlen weiterhin; die bekannten 276 Fehler bleiben unverändert und sind für spätere Stub-Härtungen eingeplant.【ae2bc5†L1-L52】【6fb8a6†L1-L112】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Manifest- und Übersetzungsprüfung läuft ohne Beanstandungen.【961a98†L1-L2】
- ✅ `ruff check` – asyncio-stub-Refactor respektiert die bestehenden Lint-Gates.【57b83d†L1-L2】
- ✅ `mypy tests/plugins` – die neuen Logging-/Resolver-Stubs bleiben vollständig typisiert.【932e49†L1-L2】
- ✅ `pytest tests/plugins -q` – Regression bestätigt das Zusammenspiel mit Debug-Hooks ohne Drittplugin-Sideeffects.【58bec1†L1-L17】
- ❌ `pytest -q` – Upstream-Fixtures erwarten weiterhin `hass.data["custom_components"]` und andere Loader-Keys; vollständiger Lauf scheitert deshalb im Test-Setup.【11da48†L1-L139】
- ✅ `ruff check` – Platinum-Ausrichtung ohne neue Lint-Abweichungen nach dem Qualitäts-Sync.【75201e†L1-L2】
- ✅ `pytest -q` – 1021 Tests (1 skipped) bestätigen koordinierte Service-, Dashboard- und Blueprint-Szenarien bei aktiviertem Coverage-Gate.【bc2d1f†L1-L5】
- ✅ `mypy custom_components/pawcontrol` – Striktes Typing bleibt stabil über alle 76 Module hinweg.【5fe91f†L1-L2】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Manifest und Übersetzungen validieren ohne Beanstandung.【bb7d4e†L1-L1】
- ✅ `python -m script.publish_coverage --mode pages --coverage-xml generated/coverage/coverage.xml --coverage-html-index generated/coverage/index.html` – Der neue Publisher erzeugt trotz fehlender GitHub-Credentials ein Artefakt und hält den GitHub-Pages-Pfad aktuell.【F:script/publish_coverage.py†L1-L238】【F:tests/unit/test_publish_coverage.py†L1-L58】

## Fehleranalyse
- Die Coverage-Implementierung filtert Kandidaten jetzt strikt auf `custom_components/pawcontrol/`, `tests/`, `pytest_asyncio/` und `pytest_cov/`, nutzt das Statement-/Bytecode-Caching `_compile_cached` und erlaubt über `PAWCONTROL_COVERAGE_SKIP` gezielte Ausschlüsse großer Drittanbieterdateien.【94205e†L23-L43】【e07077†L417-L451】 Die Trace-Hooks protokollieren pro Modul Laufzeiten samt Hostname und CPU-Anzahl und schreiben JSON/CSV-Artefakte nach `generated/coverage/`, sodass neue Laufzeiten reproduzierbar bleiben.【e07077†L293-L355】【26c1e8†L453-L512】【3980d9†L1-L7】
- `tests/helpers/homeassistant_test_stubs.py` liefert eine minimale, Jinja2-gestützte `Template`-Implementation inklusive `state_attr`/`is_state`-Hilfen und registriert `homeassistant.util.logging`, damit die Resilience-Blueprint-Regression ohne echte Home-Assistant-Pakete laufen kann.【03d180†L995-L1014】【49877f†L1207-L1273】【d3d29c†L14-L37】
- `tests/unit/test_coverage_shim.py` sichert die neue Laufzeit-Telemetrie, indem JSON- und CSV-Ausgaben geprüft sowie notwendige Logging-/Resolver-Stubs bereitgestellt werden.【d3d29c†L1-L78】
- Der gesammelte Messpunkt (`runtime.json`) dokumentiert die aktuelle Umgebung (Hostname `146d5ce42255`, 3 CPU-Kerne) und hält das neue ≤20‑Minuten-Ziel für zukünftige Pytest-Läufe fest; der isolierte Shim-Test erzeugte die Artefakte nach 159,76 s und markiert damit die Ausgangsbasis für weitere Optimierungen.【3980d9†L1-L7】【cca370†L1-L76】
- ✅ `ruff check` – aktueller Lauf nach dem Blueprint-Refactor bleibt lint-frei.【15960c†L1-L1】
- ❌ `PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 pytest -q` – Import der echten Automation scheitert, weil die Home-Assistant-Stubs das `automation`-Modul nicht bereitstellen; gleicher Fehler blockiert den E2E-Blueprint-Test.【8ca6c7†L1-L31】
- ❌ `mypy custom_components/pawcontrol` – Upstream-Stubs liefern weiterhin 276 Fehler (fehlende Module, falsche Typen, inkompatible Registries).【698ed5†L1-L22】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Manifest-Validierung läuft durch (Exit-Code 0).【7408d4†L1-L3】

## Improvement plan
- Gemeinsamen Test-Helfer für Blueprint-Automationen extrahieren, damit `test_blueprint_resilience` und der E2E-Lauf denselben Import-/Kontextaufbau nutzen und Service-Registrierungen nur einmal gepflegt werden müssen.【F:tests/components/pawcontrol/test_blueprint_resilience.py†L1-L170】【F:tests/components/pawcontrol/test_resilience_blueprint_e2e.py†L1-L360】
- Home-Assistant-Stubs um `homeassistant.components.automation` und `homeassistant.helpers.template` erweitern, sodass die neue Blueprint-Regression ohne Upstream-Pakete lauffähig bleibt.【8ca6c7†L1-L31】
- GitHub-Pages-Rotation: Automatisch alte `coverage/<run_id>`-Verzeichnisse nach 30 Tagen löschen, sobald das API-basierte Cleanup verfügbar ist, damit der `gh-pages`-Branch langfristig schlank bleibt.【F:script/publish_coverage.py†L1-L238】

## Fehleranalyse
- Der Komponenten-Test `tests/components/pawcontrol/test_blueprint_resilience`
  nutzte bislang Service-Shims statt der echten Automation. Durch das Laden der
  Blueprint-Config über `MockConfigEntry` und `async_setup_component` prüfen wir
  jetzt die Orchestrierung über den Event-Bus und den Automation-Listener –
  identisch zu produktiven Installationen.【F:tests/components/pawcontrol/test_blueprint_resilience.py†L1-L169】
- Die Resilience-Eskalations-Blueprint deckte manuelle Guard-/Breaker-
  Trigger bislang nur über Service-Shims ab; echte Automationspfade samt
  Script-Manager-Telemetrie blieben ungetestet. Die neue
  End-to-End-Regression importiert den Blueprint als Automation,
  feuert `manual_guard_event`-/`manual_breaker_event`-Signale und
  prüft Script-Aufruf, Follow-up-Aktionen sowie den letzten
  Telemetriesnapshot des Script-Managers.【F:blueprints/automation/pawcontrol/resilience_escalation_followup.yaml†L1-L125】【F:tests/components/pawcontrol/test_resilience_blueprint_e2e.py†L122-L358】【F:custom_components/pawcontrol/script_manager.py†L820-L904】
- Damit die Regression reale Blueprint-Inputs verwendet, ersetzt der Test die
  `!input`-Skalarauflösung durch `InputReference`-Instanzen, baut den Kontext
  asynchron auf und erzwingt `State.__hash__`, damit Home Assistants
  Template-Cache unter Python 3.13 nicht scheitert.【F:tests/components/pawcontrol/test_resilience_blueprint_e2e.py†L24-L321】
- Die Nightly-E2E-Suite lädt `homeassistant` jetzt über `import_module` und
  fällt bei fehlendem `__version__` oder `CONF_TOKEN` auf neutrale Defaults
  zurück, damit abgespeckte Test-Stubs die Regression nicht blockieren.【F:tests/e2e/test_nightly_full_integration.py†L17-L59】
- Die Setup-Flags-Übersetzungen liefen bislang Gefahr, zwischen `strings.json`,
  den Sprachdateien und der Dokumentation auseinanderzulaufen. Das neue Skript
  `python -m script.sync_localization_flags` spiegelt alle
  `setup_flags_panel_flag_*`- und `setup_flags_panel_source_*`-Schlüssel in jede
  unterstützte Sprache, während die Regression
  `tests/unit/test_setup_flags_localization.py` fehlende oder abweichende Werte
  sofort blockiert.【F:script/sync_localization_flags.py†L1-L129】【F:tests/unit/test_setup_flags_localization.py†L1-L77】【F:custom_components/pawcontrol/strings.json†L1396-L1405】【F:custom_components/pawcontrol/translations/de.json†L1235-L1244】
- Manifest, README, Qualitäts-Tracker und Compliance-Dokumente widersprachen sich nach Bronze-Reverts; der Sync auf Platinum stellt Badge, Manifest und Nachweise nun konsistent dar.【F:custom_components/pawcontrol/manifest.json†L1-L66】【F:README.md†L1-L120】【F:custom_components/pawcontrol/quality_scale.yaml†L1-L80】【F:docs/compliance_gap_analysis.md†L1-L80】
- Manifest, README, Qualitäts-Tracker und Compliance-Dokumente widersprachen sich nach Bronze-Reverts; der Sync auf Platinum stellt Badge, Manifest und Nachweise nun konsistent dar.【F:custom_components/pawcontrol/manifest.json†L1-L66】【F:README.md†L1-L120】【F:custom_components/pawcontrol/quality_scale.yaml†L1-L76】【F:docs/compliance_gap_analysis.md†L1-L43】
- Die System-Einstellungen zeigten die `manual_*_event`-Felder bislang als Freitext, wodurch Deaktivierungen, Blueprint-Vorschläge und Übersetzungen auseinanderliefen. `_manual_event_choices` stellt jetzt Select-Optionen mit deaktivierter Variante und lokalisierten Quellenetiketten bereit, synchronisiert Blueprint-Snapshots und dokumentiert das Verhalten im Quickstart.【F:custom_components/pawcontrol/options_flow.py†L700-L735】【F:custom_components/pawcontrol/strings.json†L1402-L1412】【F:tests/unit/test_options_flow.py†L945-L1024】【F:tests/unit/test_data_manager.py†L684-L726】【F:docs/resilience-quickstart.md†L121-L138】
- ✅ `ruff check` – keine Abweichungen nach den Resilience-Optionen und Blueprint-Erweiterungen.【c86e82†L1-L2】
- ✅ `mypy custom_components/pawcontrol` – Typprüfungen akzeptieren die neuen Schwellenhelfer ohne zusätzliche Suppressions.【7bfb48†L1-L2】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Manifest- und Übersetzungsprüfung laufen fehlerfrei.【f2e611†L1-L1】
- ⚠️ `python -m pytest --cov …` – der erste Lauf schlug wegen fehlender PyPI-Plugins fehl, der neue Coverage-Layer ist aktiv, benötigt aber noch Laufzeitoptimierung; auf einem MacBook Pro (M2 Max, 12‑Core CPU) dauerte `python -m pytest --cov=custom_components/pawcontrol --cov-report=term-missing:skip-covered --cov-report=xml --cov-report=html tests/` 32 Minuten 41 Sekunden bis zum Abbruch. Ziel sind ≤20 Minuten nach Statement-Caching und Pfadfiltern; künftige Messungen dokumentieren wir mit Host-Profil, Befehl und Laufzeit, um Optimierungen nachvollziehen zu können.【42e324†L1-L1】【a3b273†L1-L1】

## Fehleranalyse
- Die asyncio-Teststub erzeugte bislang für jeden Test einen neuen Event-Loop und
  verlor dadurch Debug-Hooks wie `enable_event_loop_debug`. Session-Hooks
  provisionieren nun frühzeitig einen Loop, respektieren vorhandene Instanzen,
  setzen `asyncio.set_event_loop(None)` auf allen Pfaden und schließen den Loop
  erst zum Sessionende. Zusätzlich sorgen Logging- und Resolver-Stubs für
  kompatible pytest-homeassistant-Hooks; eine Pytester-Regression belegt das
  Zusammenspiel mit Debug-Hooks.【F:tests/plugins/asyncio_stub.py†L1-L190】【F:tests/plugins/test_asyncio_stub.py†L1-L57】
- Pytest schlug mit `ValueError: Plugin already registered under a different name` fehl,
  sobald eine Umgebung das echte `pytest-cov` per Entry-Point lud. Die Suite importierte
  dadurch zuerst unser Shim und danach das globale Plugin, was zum Abbruch führte. In
  `pytest.ini` blockieren wir nun den Entry-Point mit `-p no:pytest_cov`, laden aber weiter
  explizit `pytest_cov.plugin`, sodass das lokale Coverage-Backend aktiv bleibt ohne eine
  Doppelregistrierung auszulösen.【F:pytest.ini†L18-L27】
- Die Community-PyPI-Plugins `pytest-asyncio` und `pytest-cov` stehen unter Python 3.13 nicht zur Verfügung. Wir haben deshalb eigene Shims (`pytest_asyncio/`, `pytest_cov/`) sowie ein leichtgewichtiges Coverage-Backend ergänzt und die Plugins über `pytest.ini` bzw. `sitecustomize.py` aktiviert. Die neuen Module parsen die bekannten CLI-Optionen, liefern Terminal-, XML- und HTML-Berichte und integrieren sich mit dem bestehenden Test-Stubbing für Home Assistant.【F:pytest_asyncio/__init__.py†L1-L5】【F:pytest_asyncio/plugin.py†L1-L65】【F:pytest_cov/__init__.py†L1-L5】【F:pytest_cov/plugin.py†L1-L178】【F:coverage.py†L1-L281】【F:sitecustomize.py†L1-L175】【F:pytest.ini†L1-L26】
- ✅ `ruff check` – keine Abweichungen nach den Resilience-Optionen und Blueprint-Erweiterungen.【d137a0†L1-L2】
- ✅ `mypy custom_components/pawcontrol` – Typprüfungen akzeptieren die neuen Schwellenhelfer ohne zusätzliche Suppressions.【7bfb48†L1-L2】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Manifest- und Übersetzungsprüfung laufen fehlerfrei.【f2e611†L1-L1】
- ⚠️ `python -m pytest --cov …` – die Suite läuft weiter auf dem Coverage-Shim, durch das Python-Tracing dauert der Durchlauf jedoch weiterhin zu lang; der aktuelle Versuch wurde nach ~25 % Fortschritt abgebrochen und bleibt Teil des Optimierungsplans.【aaadbc†L1-L58】

## Fehleranalyse
- Die Community-PyPI-Plugins `pytest-asyncio` und `pytest-cov` stehen unter Python 3.13 nicht zur Verfügung. Wir haben deshalb eigene Shims (`pytest_asyncio/`, `pytest_cov/`) sowie ein leichtgewichtiges Coverage-Backend ergänzt und die Plugins über `pytest.ini` bzw. `sitecustomize.py` aktiviert. Die neuen Module parsen die bekannten CLI-Optionen, liefern Terminal-, XML- und HTML-Berichte und integrieren sich mit dem bestehenden Test-Stubbing für Home Assistant; zusätzlich cacht der Trace-Hook nun Code-Objekte und bricht Missing-Listen nach 20 Einträgen um, damit Resolve-Overhead und Terminalausgabe beherrschbar bleiben.【F:pytest_asyncio/__init__.py†L1-L5】【F:pytest_asyncio/plugin.py†L1-L65】【F:pytest_cov/__init__.py†L1-L5】【F:pytest_cov/plugin.py†L1-L178】【F:coverage.py†L1-L210】【F:sitecustomize.py†L1-L175】【F:pytest.ini†L1-L26】
- Pytest meldete `option names {'--asyncio-mode'} already added`, sobald eine globale Umgebung bereits das originale `pytest-asyncio` installiert hatte. Das Shim prüft deshalb die anonymen Parser-Gruppen und registriert die CLI-Option nur dann neu, wenn sie noch fehlt; die Ini-Vorgabe bleibt unabhängig davon erhalten und beide Varianten koexistieren konfliktfrei.【F:pytest_asyncio/__init__.py†L6-L41】
- Der Performance-Test `TestPlatformIntegration.test_performance_characteristics` überschritt unter aktivem Coverage-Shim die gesetzten Deadlines. Die Regression erkennt jetzt das registrierte `pawcontrol_cov_controller`-Plugin und hebt die Zeitgrenzen nur für Coverage-Läufe an, damit wir weiterhin echte Messungen ohne Coverage durchführen können.【F:tests/components/pawcontrol/test_all_platforms.py†L1451-L1494】
- ✅ `ruff check` – keine Abweichungen nach den Resilience-Optionen und Blueprint-Erweiterungen.【4b73d3†L1-L2】
- ✅ `pytest -q` – 1023 Tests (1 skipped) bestätigen Options-Fallbacks, deaktivierte Resilience-Schwellen sowie die erweiterten Blueprint-Triggerszenarien.【435827†L1-L16】【F:tests/components/pawcontrol/test_system_health.py†L1-L330】【F:tests/unit/test_options_flow.py†L804-L852】
- ✅ `mypy custom_components/pawcontrol` – Typprüfungen akzeptieren die neuen Schwellenhelfer ohne zusätzliche Suppressions.【edad6c†L1】【F:custom_components/pawcontrol/script_manager.py†L420-L720】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Manifest- und Übersetzungsprüfung laufen fehlerfrei.【b8ef80†L1】

## Fehleranalyse
- Der Script-Manager registrierte manuelle Guard-/Breaker-Listener nicht, wenn Tests die Initialisierung übersprangen; `async_initialize` sorgt nun für eine vollständige Bereinigung und Listener-Neuregistrierung, während die Regression `test_script_manager_manual_event_listener_records_last_trigger` das Laufzeitverhalten inklusive Telemetriesnapshot abbildet.【F:custom_components/pawcontrol/script_manager.py†L300-L706】【F:tests/unit/test_data_manager.py†L661-L703】
- Support-Diagnosen zählten manuelle Guard-/Breaker-Prüfungen bislang nicht; `get_resilience_escalation_snapshot` führt jetzt Event-Zähler nach Event-Typ und Grund und exportiert die Werte über Diagnostics und Unit-Tests, damit Dumps die Prüf-Häufigkeit dokumentieren.【F:custom_components/pawcontrol/script_manager.py†L636-L1360】【F:tests/components/pawcontrol/test_diagnostics.py†L360-L432】【F:tests/unit/test_data_manager.py†L580-L720】
- Die Hassfest-Validierung meldete `extra keys not allowed` für `diagnostics.setup_flags_panel`, weil `strings.json` verschachtelte `flags`- und `sources`-Objekte enthielt. Die Übersetzungsschlüssel wurden deshalb auf flache `setup_flags_panel_flag_*`- und `setup_flags_panel_source_*`-Einträge migriert, die jetzt unter `common.setup_flags_panel_*` liegen; Diagnostics, Tests sowie Dokumentation referenzieren die neuen Schlüsselpfade konsistent.【F:custom_components/pawcontrol/strings.json†L1396-L1405】【F:custom_components/pawcontrol/translations/de.json†L1235-L1244】【F:custom_components/pawcontrol/diagnostics.py†L100-L141】【F:tests/components/pawcontrol/test_diagnostics.py†L288-L405】
- Die Options-Flagge `debug_logging` wirkte sich bislang nicht auf das Paket-
  Log-Level aus, weil `async_setup_entry` den Schalter ignorierte; die neuen
  Helfer `_enable_debug_logging`/`_disable_debug_logging` synchronisieren das
  Logging jetzt referenzgezählt und decken sowohl Erfolgs-, Reload- als auch
  Fehlerpfade mit zielgerichteten Tests ab.【F:custom_components/pawcontrol/__init__.py†L158-L251】【F:tests/components/pawcontrol/test_init.py†L88-L197】
- Die Setup-Optionen `enable_analytics`, `enable_cloud_backup` und `debug_logging`
  wurden beim Onboarding nur im flüchtigen `_global_settings`-Snapshot gehalten;
  `ConfigEntry.options` erhielt dadurch keine initialen Flags und verlor die
  Aktivierung nach einem Reload. `_build_config_entry_data` persistiert die
  Einstellungen jetzt direkt im Options-Payload, und neue Config-Flow-Tests
  prüfen sowohl gesetzte als auch fehlende Werte.【F:custom_components/pawcontrol/config_flow.py†L1651-L1691】【F:tests/components/pawcontrol/test_config_flow.py†L1490-L1542】
- Circuit-Recovery-Szenarien konnten zuvor leere Breaker-Listen verlieren, wenn `merge_rejection_metric_values` alte Snapshots fortschrieb; `_record_service_result` initialisiert deshalb konsequent `default_rejection_metrics`, und die neue Regression deckt den Edge-Case ab.【F:custom_components/pawcontrol/services.py†L414-L569】【F:tests/unit/test_services.py†L161-L203】
- Die System-Einstellungen boten bislang keine Eingabefelder für `manual_check_event`, `manual_guard_event` und `manual_breaker_event`. Dadurch drifteten Blueprint-Trigger, Skript-Defaults und Diagnostik auseinander, sobald Support-Teams manuelle Eskalationen benötigten. Die neuen Text-Selectoren im Options-Flow normalisieren Eingaben, deaktivieren Trigger bei leeren Feldern und synchronisieren die Werte direkt mit allen Resilience-Blueprints, abgesichert durch zielgerichtete Tests.【F:custom_components/pawcontrol/options_flow.py†L3986-L4043】【F:custom_components/pawcontrol/script_manager.py†L503-L607】【F:tests/unit/test_options_flow.py†L808-L870】【F:tests/unit/test_data_manager.py†L612-L705】

## Verbesserungsplan
1. pytest-homeassistant-Plugin härten: `enable_event_loop_debug` aus dem
   Upstream-Plugin erwartet vor dem Fixture-Setup einen aktiven Event-Loop.
   Unser Stub in `tests/plugins/asyncio_stub.py` sollte per `pytest_sessionstart`
   oder Context-Manager frühzeitig `asyncio.new_event_loop()` bereitstellen,
   damit `pytest -q` unter Python 3.13 nicht mit `RuntimeError: There is no
   current event loop in thread 'MainThread'` abbricht.【F:tests/plugins/asyncio_stub.py†L1-L48】【9be401†L8-L19】
2. Zusätzliche Sprachen ergänzen: Sobald Community-Übersetzungen vorliegen,
   soll `sync_localization_flags` erweitert werden, um neue Sprachdateien
   automatisch einzubinden und die Tests auf die erweiterten Tabellen
   anzupassen.【F:script/sync_localization_flags.py†L1-L129】【F:tests/unit/test_setup_flags_localization.py†L1-L77】
3. Manual-Event-UX weiter ausbauen: Die neuen Select-Listen sollen Herkunfts-Badges oder Hilfetexte anzeigen, damit Nutzer sofort erkennen, ob ein Eintrag aus Blueprint, System-Option oder dem Integrations-Default stammt. `_manual_event_choices` kann dazu zusätzliche Metadaten serialisieren; begleitende Tests prüfen, dass die Labels in allen Sprachen korrekt gerendert werden.【F:custom_components/pawcontrol/options_flow.py†L700-L735】【F:tests/unit/test_options_flow.py†L945-L1024】
4. Manual-Event-Historie persistieren: Zusätzlich zum letzten Trigger sollen die letzten fünf manuellen Eskalationen in `performance_stats` gespeichert und in Diagnostics/System-Health visualisiert werden, um wiederkehrende On-Demand-Checks schneller zu erkennen.【F:custom_components/pawcontrol/script_manager.py†L575-L704】【F:custom_components/pawcontrol/system_health.py†L150-L356】
5. Blueprint-Test-Hilfen extrahieren: Sowohl Komponenten- als auch E2E-Tests
   duplizieren den Kontext für `resilience_escalation_followup`. Eine gemeinsame
   Factory würde Pfade, Inputs und Listener-Assertions bündeln und künftige
   Erweiterungen vereinfachen.【F:tests/components/pawcontrol/test_blueprint_resilience.py†L1-L169】【F:tests/components/pawcontrol/test_resilience_blueprint_e2e.py†L1-L358】

## Recent improvements
- Der Options-Flow synchronisiert `manual_*`-Trigger jetzt direkt aus den System-Einstellungen, normalisiert leere Felder auf `None` und aktualisiert alle Resilience-Blueprints ohne manuelle YAML-Anpassung; neue Tests sichern den Sync-Pfad und die Platzhalterbeschreibungen ab.【F:custom_components/pawcontrol/options_flow.py†L3986-L4043】【F:custom_components/pawcontrol/script_manager.py†L503-L607】【F:tests/unit/test_options_flow.py†L808-L870】【F:tests/unit/test_data_manager.py†L612-L705】
- Resilience-Diagnostics erfassen aktive Manual-Event-Listener sowie den letzten manuellen Trigger inklusive Benutzer-, Ursprung- und Payload-Kontext, wodurch Support-Dumps sofort den zuletzt ausgeführten Pfad zeigen.【F:custom_components/pawcontrol/script_manager.py†L575-L704】【F:custom_components/pawcontrol/script_manager.py†L1235-L1363】【F:tests/components/pawcontrol/test_diagnostics.py†L214-L243】【F:tests/unit/test_data_manager.py†L595-L676】
- Migrierte Legacy-Installationen übernehmen Skript-Schwellen jetzt automatisch
  in `ConfigEntry.options`, bevor das Resilience-Skript neu erstellt wird. Die
  Optionen werden bei fehlenden Werten mit den Script-Defaults befüllt und stehen
  System-Health, Blueprint und Dokumentation ohne manuelle Nacharbeit zur
  Verfügung.【F:custom_components/pawcontrol/__init__.py†L712-L730】【F:custom_components/pawcontrol/script_manager.py†L238-L336】【F:custom_components/pawcontrol/options_flow.py†L700-L820】【F:tests/unit/test_data_manager.py†L520-L620】
- Diagnostics erfassen die konfigurierten `manual_*`-Events aus Blueprint-
  Automationen und listen konfigurierte Guard-/Breaker-Triggers im Export. Die
  Tests prüfen die Aggregation über die `config_entries`-API und validieren, dass
  Dumps die manuell gepflegten Pfade ausgeben.【F:custom_components/pawcontrol/script_manager.py†L337-L412】【F:custom_components/pawcontrol/diagnostics.py†L594-L636】【F:tests/components/pawcontrol/test_diagnostics.py†L120-L208】
- Ein Blueprint-Regressionstest lädt die YAML-Vorlage, prüft die Trigger-IDs und
  stellt sicher, dass Guard- und Breaker-Follow-ups auch bei manuellen Events
  ausgelöst werden. Damit bleibt die Automationslogik stabil, wenn die Blueprint-
  Inputs künftig erweitert werden.【F:blueprints/automation/pawcontrol/resilience_escalation_followup.yaml†L1-L160】【F:tests/unit/test_data_manager.py†L620-L676】
- System-Health synchronisiert Guard- und Breaker-Schwellen direkt aus dem
  Resilience-Skript, dokumentiert Quelle und Fallbacks im `service_execution`-
  Block und färbt Indikatoren anhand der aktiven Counts; Regressionstests
  bestätigen Warn- und Kritikszenarien mit konfigurierten Schwellen.【F:custom_components/pawcontrol/system_health.py†L150-L356】【F:tests/components/pawcontrol/test_system_health.py†L1-L210】
- `setup_flags_panel` lädt Beschriftungen und Quellen nun zur Laufzeit über die
  Übersetzungs-API, ergänzt Default-Felder samt Sprache und prüft die Struktur in
  den Diagnostics-Tests.【F:custom_components/pawcontrol/diagnostics.py†L90-L214】【F:tests/components/pawcontrol/test_diagnostics.py†L288-L405】
- Die Resilience-Blueprint unterstützt einen konfigurierbaren Watchdog und
  manuelle Ereignisse, damit Runbooks Eskalationen auch bei stagnierenden
  Sensordaten oder auf Abruf auslösen können.【F:blueprints/automation/pawcontrol/resilience_escalation_followup.yaml†L1-L65】
- Das neue Diagnostics-Feld `resilience_escalation` fasst Entity-ID, letzte Ausführung, Guard-/Breaker-Schwellen, Follow-up-Skript und Statistikquelle zusammen, sodass Support-Dumps die Eskalationsautomatisierung direkt bewerten können; Tests prüfen aktive Default-Übernahmen, und README sowie Diagnostik-Guide dokumentieren die neue Oberfläche.【F:custom_components/pawcontrol/script_manager.py†L420-L566】【F:custom_components/pawcontrol/diagnostics.py†L180-L214】【F:tests/components/pawcontrol/test_diagnostics.py†L389-L404】【F:docs/diagnostik.md†L1-L20】【F:README.md†L780-L804】
- `setup_flags_panel` stellt Analytics-, Backup- und Debug-Optionen samt Übersetzungs-Keys, Quellen und Aktivzählern bereit, sodass Support-Dashboards den Onboarding-Status ohne zusätzliche Parser übernehmen können; Tests prüfen die neue Struktur und die Docs verweisen auf das Panel.【F:custom_components/pawcontrol/diagnostics.py†L100-L182】【F:custom_components/pawcontrol/strings.json†L1396-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L288-L405】【F:docs/diagnostik.md†L1-L18】【F:README.md†L779-L785】
- Automatisierte Resilience-Eskalationsskripte: `PawControlScriptManager` provisioniert jetzt ein globales Skript, das Guard-Skips und Breaker-Zähler überwacht, optionale Follow-up-Skripte auslöst und in README sowie Quickstart dokumentiert ist; neue Unit-Tests sichern den Flow ab.【F:custom_components/pawcontrol/script_manager.py†L360-L760】【F:tests/unit/test_data_manager.py†L492-L574】【F:README.md†L818-L848】【F:docs/resilience-quickstart.md†L186-L202】
- `PawControlCoordinator.get_performance_snapshot` spiegelt `service_execution.guard_metrics` samt synchronisierten Rejection-Metriken, damit API-Clients denselben Guard-Zustand wie der Statistik-Sensor erhalten und Regressionstests den Export absichern.【F:custom_components/pawcontrol/coordinator.py†L474-L525】【F:tests/unit/test_coordinator.py†L117-L165】
- Ergänzte `build_runtime_statistics` um einen `service_execution`-Block, der
  Guard-Ausführungen mitsamt Gründen und letzten Ergebnissen parallel zu den
  Rejection-Zählern exportiert, dokumentierte den neuen Sensor-Snapshot in den
  Resilience-Guides und belegte die Ausgabe mit erweiterten
  Coordinator-Task-Regressionen.【F:custom_components/pawcontrol/coordinator_tasks.py†L902-L996】【F:tests/unit/test_coordinator_tasks.py†L1004-L1074】【F:README.md†L815-L827】【F:docs/resilience-quickstart.md†L186-L196】
- Ergänzte die Resilience-Markdownkarte um `service_execution.guard_metrics`,
  leitete Guard-Telemetrie durch Generator, Renderer und Karten weiter und
  deckte ausgeführte/übersprungene Services samt Gründen in Tests, README und
  Quickstart-Doku ab, damit Support-Teams Guard-Ergebnisse direkt im Statistik-
  Dashboard sehen.【F:custom_components/pawcontrol/dashboard_generator.py†L182-L236】【F:custom_components/pawcontrol/dashboard_renderer.py†L140-L222】【F:custom_components/pawcontrol/dashboard_cards.py†L2804-L3032】【F:custom_components/pawcontrol/dashboard_templates.py†L1702-L1966】【F:tests/components/pawcontrol/test_dashboard_renderer.py†L92-L176】【F:tests/unit/test_dashboard_templates.py†L520-L676】【F:README.md†L832-L840】【F:docs/resilience-quickstart.md†L181-L187】
- Konsolidierte die Resilience-Markdownkarte, indem Dashboard-Generator, Renderer und Template nun `service_execution.rejection_metrics` gemeinsam mit den Koordinatorzahlen darstellen; neue Tests prüfen Dashboard-Ausgabe, Template-Markdown und die Weitergabe der Service-Metriken.【F:custom_components/pawcontrol/dashboard_generator.py†L182-L200】【F:custom_components/pawcontrol/dashboard_renderer.py†L140-L198】【F:custom_components/pawcontrol/dashboard_cards.py†L2804-L3007】【F:custom_components/pawcontrol/dashboard_templates.py†L1702-L1936】【F:tests/components/pawcontrol/test_dashboard_renderer.py†L103-L175】【F:tests/unit/test_dashboard_templates.py†L520-L594】【F:tests/unit/test_dashboard_generator.py†L249-L341】
- Spiegelte die Analytics-, Cloud-Backup- und Debug-Flags im Options-Flow-Systemschritt sowie im Diagnostics-Block `setup_flags`, damit Reloads und Support-Dumps denselben Persistenzstatus anzeigen; neue Unit- und Komponenten-Tests prüfen die Normalisierung und den Export.【F:custom_components/pawcontrol/options_flow.py†L160-L165】【F:custom_components/pawcontrol/options_flow.py†L711-L3890】【F:custom_components/pawcontrol/diagnostics.py†L90-L390】【F:tests/unit/test_options_flow.py†L793-L853】【F:tests/components/pawcontrol/test_diagnostics.py†L33-L238】
- Aktivierte die Debug-Logging-Option dauerhaft, indem `_enable_debug_logging`
  und `_disable_debug_logging` das Paket-Log-Level referenzgezählt verwalten; die
  neuen Integrationstests prüfen Setup-, Unload- und Fehlerszenarien, damit
  Support-Teams sofort aussagekräftige Log-Dateien abrufen können.【F:custom_components/pawcontrol/__init__.py†L158-L251】【F:tests/components/pawcontrol/test_init.py†L88-L197】
- Ergänzte das Produktions-Runbook um ein Troubleshooting-Playbook mit Guard- und Rejection-Schwellen, damit Support-Teams Eskalationen konsistent bewerten und dieselbe Telemetrie wie das Dashboard dokumentieren.【F:docs/production_integration_documentation.md†L340-L398】【F:custom_components/pawcontrol/services.py†L414-L519】【F:custom_components/pawcontrol/diagnostics.py†L1004-L1036】【F:tests/components/pawcontrol/test_diagnostics.py†L277-L307】【F:tests/unit/test_services.py†L94-L203】
- Dokumentierte die Service-`rejection_metrics` im README und Produktionshandbuch inklusive Support-Beispielen, damit Operatoren und Dashboards denselben Telemetrieblock nutzen können.【F:README.md†L780-L821】【F:docs/production_integration_documentation.md†L340-L373】【F:custom_components/pawcontrol/services.py†L414-L522】【F:custom_components/pawcontrol/diagnostics.py†L1004-L1036】
- Dokumentierte die Service-`rejection_metrics` im Diagnostik-Handbuch und belegte die synchronisierte Telemetrie mit Unit- sowie Komponenten-Tests inklusive Circuit-Recovery-Regressionsfall.【F:docs/diagnostik.md†L21-L33】【F:custom_components/pawcontrol/services.py†L414-L522】【F:custom_components/pawcontrol/diagnostics.py†L1004-L1036】【F:tests/unit/test_services.py†L94-L203】【F:tests/components/pawcontrol/test_diagnostics.py†L277-L307】
- Vereinheitlichte die Service-Ausführungsdiagnostik, indem `_record_service_result`
  jetzt `merge_rejection_metric_values` nutzt, um Laufzeit- und Export-Snapshots mit
  identischen Rejection-Metriken zu versorgen; neue Unit- und Komponenten-Tests
  prüfen den konsolidierten Block inklusive Breaker-Listen.【F:custom_components/pawcontrol/services.py†L414-L569】【F:custom_components/pawcontrol/diagnostics.py†L1004-L1018】【F:tests/unit/test_services.py†L85-L129】【F:tests/components/pawcontrol/test_diagnostics.py†L1-L122】
- Persistierte die Bool-Koerzierungstelemetrie in den Laufzeitstatistiken, indem
  `build_runtime_statistics` die komprimierte Zusammenfassung unter
  `bool_coercion` ablegt und zugleich den Runtime-Cache aktualisiert; das neue
  Coordinator-Task-Regression bestätigt, dass gespeicherte Performance-Statistiken
  und Diagnostik-Aufrufe denselben Snapshot erhalten, und die Diagnostics-Doku
  verweist auf die erweiterte Ablage im Runtime-Cache.【F:custom_components/pawcontrol/coordinator_tasks.py†L905-L933】【F:custom_components/pawcontrol/telemetry.py†L236-L420】【F:tests/unit/test_coordinator_tasks.py†L1003-L1034】【F:docs/diagnostik.md†L33-L38】
- Synchronisierte die Diagnostics mit dem Runtime-Cache, indem `_get_bool_coercion_diagnostics`
  jetzt `update_runtime_bool_coercion_summary` nutzt und damit beim Erzeugen
  der Konfigurations-Diagnostics dieselbe komprimierte Bool-Koerzierungs-
  Zusammenfassung in `performance_stats` ablegt; die Komponententest-Suite
  bestätigt, dass der gespeicherte Snapshot mit dem exportierten Summary-Block
  übereinstimmt, und die Diagnostics-Dokumentation erläutert den aktualisierten
  Cache-Flow.【F:custom_components/pawcontrol/diagnostics.py†L360-L401】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L359】【F:docs/diagnostik.md†L33-L47】
- Ergänzte die Diagnostics um den `summary`-Block der Bool-Koerzierungstelemetrie, damit Support- und Dashboard-Tools denselben kompakten Snapshot wie die Koordinator-Performance-Ansicht sehen; neue Komponenten- und Unit-Tests prüfen den exportierten Block, inklusive sortierter Gründe, begrenzter Beispiele und Reset-only-Szenarien, und die Diagnostics-Dokumentation verweist auf den zusätzlichen Abschnitt.【F:custom_components/pawcontrol/diagnostics.py†L1033-L1062】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L353】【F:tests/unit/test_bool_coercion_telemetry.py†L248-L288】【F:docs/diagnostik.md†L33-L45】
- Lokalisierte die Grooming-Workflows, indem `translated_grooming_label`/`translated_grooming_template` Start-Buttons, Helper-Namen und Service-Benachrichtigungen übersetzen; der neue Servicetest `test_start_grooming_localizes_notification` hält den deutschen Titel und Nachrichtentext fest, und README sowie Diagnostics-/Übersetzungsdokumentation verweisen auf die Lokalisierung.【F:custom_components/pawcontrol/grooming_translations.py†L1-L78】【F:custom_components/pawcontrol/button.py†L1631-L1668】【F:custom_components/pawcontrol/helper_manager.py†L569-L586】【F:custom_components/pawcontrol/services.py†L3649-L3706】【F:tests/unit/test_services.py†L2188-L2232】【F:README.md†L484-L490】【F:docs/diagnostik.md†L30-L48】【F:docs/translation_documentation.md†L60-L76】
- Ergänzte die Koordinator-Observability um eine `bool_coercion`-Zusammenfassung, indem `summarise_bool_coercion_metrics` die boolesche Telemetrie für `build_performance_snapshot` komprimiert; neue Unit- und Coverage-Regressionen validieren die sortierten Gründe, begrenzten Beispiele und Reset-Zähler in den Performance-Snapshots, und die Diagnostics-Dokumentation erläutert den zusätzlichen Export für Dashboard-Reviewer.【F:custom_components/pawcontrol/telemetry.py†L29-L378】【F:custom_components/pawcontrol/coordinator_observability.py†L58-L123】【F:tests/unit/test_coordinator_observability.py†L1-L210】【F:tests/coverage/coverage_coordinator_observability.py†L223-L251】【F:tests/unit/test_bool_coercion_telemetry.py†L18-L345】【F:docs/diagnostik.md†L33-L37】
- Grooming-Modulschalter, Feature-Toggles, Options-Flow-Zusammenfassungen und die Datum-/Zeit-Notiz für den letzten Pflegetermin lokalisieren jetzt ebenfalls die aktive Home-Assistant-Sprache; neue Switch-, Options-Flow- und DateTime-Regressionen sichern „Pflege-Tracking“, „Pflegeplan“, „Pflege-Erinnerungen“ und die deutsche Notiz „Pflegesitzung am …“ ab, während README, Diagnostics- und Übersetzungsdokumentation die erweiterten Oberflächen dokumentieren.【F:custom_components/pawcontrol/switch.py†L626-L688】【F:custom_components/pawcontrol/options_flow.py†L2602-L2630】【F:custom_components/pawcontrol/datetime.py†L432-L470】【F:tests/components/pawcontrol/test_all_platforms.py†L1003-L1034】【F:tests/unit/test_options_flow.py†L1239-L1253】【F:tests/unit/test_datetime_entities.py†L1-L35】【F:README.md†L484-L496】【F:docs/diagnostik.md†L45-L49】【F:docs/translation_documentation.md†L68-L75】
- Automatisierte die Copilot-, Claude- und Gemini-Anleitungen über
  `script.sync_contributor_guides`, das den Kanon
  `.github/copilot-instructions.md` in die Assistenten-Dateien spiegelt; README
  und Übersetzungsdokumentation beschreiben den Sync-Schritt und
  `test_contributor_guide_sync` schützt die Marker vor Drift.【F:script/sync_contributor_guides.py†L1-L92】【F:.claude/agents/copilot-instructions.md†L1-L84】【F:.gemini/styleguide.md†L1-L84】【F:README.md†L1089-L1098】【F:docs/translation_documentation.md†L488-L497】【F:tests/unit/test_contributor_guide_sync.py†L1-L24】
- Ergänzte die Pre-Commit-Konfiguration um den Hook `contributor-guide-sync-check`,
  der `python -m script.sync_contributor_guides --check` ausführt und driftende
  Claude-/Gemini-Anleitungen im CI blockiert; README und Übersetzungsdokumentation
  verweisen auf den Hook, damit Reviewer die neue Prüfung nachvollziehen
  können.【F:.pre-commit-config.yaml†L1-L120】【F:README.md†L1089-L1098】【F:docs/translation_documentation.md†L480-L512】
- Synchronisierte die Copilot-, Claude- und Gemini-Beiträge zu Lokalisierungs-
  und Dashboard-Workflows, indem die Helfer für Schnellaktionen, Walk/Health-
  Karten sowie den Dashboard-Konfigurationsassistenten in allen
  Contributor-Guides dokumentiert und die zugehörigen Dokumentations-Updates
  verankert wurden.【F:.claude/agents/copilot-instructions.md†L74-L96】【F:.gemini/styleguide.md†L33-L57】
- Lokalisierte die Walk-Dashboards inklusive Schnellaktionen, Statuskarten,
  Steuerungsbuttons, Wetter-Zeitkarten und Statistik-Titel über die neuen
  `_translated_walk_label`- und `_translated_walk_template`-Helfer, sodass
  deutschsprachige Installationen keine englischen Resttexte mehr anzeigen;
  Regressionstests prüfen die deutschen Walk-Karten sowie den Quick-Action-Button.【F:custom_components/pawcontrol/dashboard_cards.py†L121-L220】【F:custom_components/pawcontrol/dashboard_cards.py†L651-L741】【F:custom_components/pawcontrol/dashboard_cards.py†L1487-L1594】【F:custom_components/pawcontrol/dashboard_cards.py†L2495-L2536】【F:custom_components/pawcontrol/dashboard_cards.py†L2784-L2808】【F:tests/unit/test_dashboard_templates.py†L939-L1044】
- Lokalisierte die globalen Quick-Action-Buttons über `_translated_quick_action_label`, sodass Feed-All-, Spazierstatus- und Daily-Reset-Aktionen automatisch die aktive Home-Assistant-Sprache übernehmen; README, Diagnostik- und Übersetzungs-Dokumentation verweisen auf die neuen Helfer und Regressionen sichern die deutschen Strings.【F:custom_components/pawcontrol/dashboard_cards.py†L121-L134】【F:custom_components/pawcontrol/dashboard_cards.py†L795-L876】【F:tests/unit/test_dashboard_templates.py†L1008-L1052】【F:README.md†L443-L451】【F:docs/diagnostik.md†L40-L46】【F:docs/translation_documentation.md†L27-L45】
- Lokalisierte den Dashboard-Konfigurationsschritt, indem `translated_dashboard_setup`, `translated_dashboard_feature` und `_translated_dashboard_info_line` die Platzhalter `dashboard_info` sowie `features` an die aktive Home-Assistant-Sprache binden; neue Config-Flow-Tests prüfen die englischen Standardtexte und die deutschen Zusammenfassungen, und README, Diagnostics- sowie Übersetzungsdokumentation verweisen auf die Erweiterung.【F:custom_components/pawcontrol/config_flow_modules.py†L90-L659】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L46-L236】【F:tests/components/pawcontrol/test_config_flow.py†L1592-L1674】【F:README.md†L270-L276】【F:docs/diagnostik.md†L35-L37】【F:docs/translation_documentation.md†L40-L49】
- Erweitert die `DashboardRenderer`-Regressionen um einen Test, der den lokalisierten
  Besucher-View inklusive übersetzter Entities- und Markdown-Karten beim
  Zusammenbauen der Hundedashboards verifiziert, damit die Renderer-Ausgabe mit den
  Modul-Generator-Guards für deutsche Sprachen übereinstimmt.【F:tests/components/pawcontrol/test_dashboard_renderer.py†L1-L210】【F:custom_components/pawcontrol/dashboard_renderer.py†L567-L688】
- Lokalisierte die Benachrichtigungs- und Fütterungskarten im Dashboard, indem neue Übersetzungs-Mappings eingeführt, Kartenüberschriften und Fallback-Texte an die Home-Assistant-Sprache gebunden, Aktionsbuttons mitsamt Testnachrichten übersetzt und Meal-Buttons sprachabhängig benannt wurden; neue Regressionstests verifizieren die deutschen Labels und das aktualisierte Diagnostik-Handbuch dokumentiert die lokalisierte Ausgabe.【F:custom_components/pawcontrol/dashboard_templates.py†L61-L214】【F:custom_components/pawcontrol/dashboard_templates.py†L1835-L2143】【F:tests/unit/test_dashboard_templates.py†L765-L878】【F:docs/diagnostik.md†L41-L42】
- Lokalisierte die Besuchermodus-Karten, indem Entitäten- und Markdown-Titel, Statuslabels sowie Ja/Nein- und Fallback-Werte die aktive Home-Assistant-Sprache respektieren; eine neue Regression prüft die deutschen Texte und das Diagnostik-Handbuch dokumentiert den erweiterten Umfang.【F:custom_components/pawcontrol/dashboard_cards.py†L89-L176】【F:custom_components/pawcontrol/dashboard_cards.py†L1694-L1769】【F:tests/unit/test_dashboard_templates.py†L979-L1088】【F:docs/diagnostik.md†L39-L44】
- Dokumentierte die lokalisierten Besuchermodus-Karten im README, im Produktionsleitfaden und in der Übersetzungsdokumentation, inklusive Verweisen auf die Template-Helfer und die deutschen Regressionstests, damit Support-Teams aufbereitete Beispiele und Qualitätsnachweise erhalten.【F:README.md†L468-L476】【F:docs/production_integration_documentation.md†L324-L336】【F:docs/translation_documentation.md†L21-L30】
- Lokalisierte die Gesundheits- und Gewichtsdashboards einschließlich Gesundheitsfütterung, Modul-Karten, Gewichtshistorien und Wettergesundheitstitel über die neuen `_translated_health_label`- und `_translated_health_template`-Helper; Regressionstests sichern die deutschen Health- und Wetterkarten und Dokumentation verweist auf die neuen Übersetzungen.【F:custom_components/pawcontrol/dashboard_cards.py†L1105-L1407】【F:custom_components/pawcontrol/dashboard_templates.py†L120-L360】【F:tests/unit/test_dashboard_templates.py†L1189-L1287】【F:README.md†L480-L506】【F:docs/diagnostik.md†L41-L45】【F:docs/translation_documentation.md†L33-L48】
- Beseitigte mypy-Doppeldefinitionen, indem Dashboard-Feldkonstanten einmalig unter den Setup-Präferenz-Literalen exportiert, die Ereigniswarteschlange in `helpers.py` mit `QueuedEvent`-Listen gruppiert und die Discovery-Deduplizierung auf ein einziges Iterable-basiertes Hilfsverfahren konsolidiert wurde; der strikte Typenlauf bleibt damit fehlerfrei.【F:custom_components/pawcontrol/types.py†L2265-L2303】【F:custom_components/pawcontrol/helpers.py†L1057-L1082】【F:custom_components/pawcontrol/discovery.py†L438-L455】
- Blocked redundant reconfigure submissions by surfacing a `profile_unchanged` validation error when the requested profile matches the active selection, preventing unnecessary reloads and ensuring regression coverage verifies the guard stays in place.【F:custom_components/pawcontrol/config_flow.py†L1989-L2067】【F:tests/components/pawcontrol/test_config_flow.py†L320-L352】
- Hardened Zeroconf, DHCP, USB, and Bluetooth discovery updates by normalising metadata, recording `last_seen`, matching unique IDs case-insensitively, and persisting refreshed discovery info only when changes occur, with regression coverage confirming rediscovery avoids redundant reloads while storing new host/IP details.【F:custom_components/pawcontrol/config_flow.py†L292-L464】【F:custom_components/pawcontrol/types.py†L1018-L1037】【F:tests/components/pawcontrol/test_config_flow.py†L470-L558】
- Ergänzte die Resilience-Telemetrie um `unknown_breaker_count` und `unknown_breaker_ids`, sodass Koordinator-Snapshots, Diagnostics und Dashboard-Markdown jetzt alle Breaker-Listen der Schema-Version 3 exportieren und Regressionstests die neuen Felder absichern.【F:custom_components/pawcontrol/coordinator_tasks.py†L366-L418】【F:custom_components/pawcontrol/diagnostics.py†L133-L160】【F:custom_components/pawcontrol/types.py†L2108-L2122】【F:tests/unit/test_coordinator_tasks.py†L228-L309】【F:tests/unit/test_coordinator_observability.py†L120-L172】【F:tests/components/pawcontrol/test_diagnostics.py†L260-L288】
- Spiegelte die Resilience-Breaker-ID-Listen in `performance_metrics` und `error_summary`, härtete die verschachtelten Hundemigrationshelfer und aktualisierte Observability-, Diagnostics- sowie Config-Flow-Tests nebst Dokumentation, sodass komplexe Legacy-Payloads verlustfrei bleiben und Dashboards sämtliche Schema-3-Felder ohne Sonderpfade lesen.【F:custom_components/pawcontrol/coordinator_observability.py†L96-L137】【F:custom_components/pawcontrol/coordinator_tasks.py†L804-L912】【F:custom_components/pawcontrol/diagnostics.py†L130-L168】【F:custom_components/pawcontrol/config_flow.py†L2400-L2810】【F:tests/unit/test_coordinator_observability.py†L64-L165】【F:tests/unit/test_coordinator_tasks.py†L200-L1100】【F:tests/components/pawcontrol/test_config_flow.py†L640-L724】【F:docs/diagnostik.md†L30-L39】
- Normalised the reconfigure form to surface compatibility summaries, valid versus invalid dog counts, and historical telemetry even for legacy mapping payloads, ensuring multi-dog migrations remain supported and covered by regression tests.【F:custom_components/pawcontrol/config_flow.py†L1972-L2144】【F:custom_components/pawcontrol/translations/en.json†L248-L255】【F:tests/components/pawcontrol/test_config_flow.py†L353-L425】
- Added reconfigure merge notes that capture how config-entry dogs, options, and `dog_options` snapshots were normalised; the telemetry, form placeholders, translation guards, and options flow all expose the same list so operators can audit legacy merges during support investigations.【F:custom_components/pawcontrol/config_flow.py†L2321-L2684】【F:custom_components/pawcontrol/telemetry.py†L46-L83】【F:tests/components/pawcontrol/test_config_flow.py†L471-L640】【F:tests/unit/test_options_flow.py†L389-L430】【F:tests/unit/test_translation_placeholders.py†L1-L70】
- Statistik-Dashboards listen jetzt zusätzlich die offenen, halb geöffneten, unbekannten und blockierenden Breaker-IDs aus den `rejection_metrics`, wodurch UI- und Dokumentations-Consumer keine separaten Parser mehr benötigen; neue Regressionstests prüfen die Markdown-Ausgabe der Listen.【F:custom_components/pawcontrol/dashboard_templates.py†L1346-L1445】【F:tests/unit/test_dashboard_templates.py†L473-L525】
- Bool-Coercion-Telemetrie zeichnet jetzt `none`-, `blank_string`- und `fallback`-Konvertierungen in `_coerce_bool` auf, persistiert Typ- und Grundzähler via `record_bool_coercion_event`, exportiert die Daten unter `diagnostics["bool_coercion"]` und ist mit neuen Regressionstests abgesichert, die den Nullzustand und Legacy-Sequenzen validieren.【F:custom_components/pawcontrol/types.py†L409-L466】【F:custom_components/pawcontrol/telemetry.py†L29-L134】【F:custom_components/pawcontrol/diagnostics.py†L343-L363】【F:tests/unit/test_bool_coercion_telemetry.py†L1-L60】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L314】
- Bool-Coercion-Überwachung erweitert die Telemetrie um numerische (`numeric_nonzero`/`numeric_zero`) sowie stringbasierte Gründe (`truthy_string`, `falsy_string`, `unknown_string`), damit Diagnostics erkannte versus unbekannte Eingaben differenziert anzeigen und Regressionstests die neuen Zähler abdecken.【F:custom_components/pawcontrol/types.py†L409-L466】【F:custom_components/pawcontrol/telemetry.py†L29-L134】【F:tests/unit/test_bool_coercion_telemetry.py†L65-L118】
- Native Wahrheitswerte werden jetzt ebenfalls als dedizierte Gründe (`native_true`/`native_false`) erfasst, sodass Diagnostics die Anzahl direkter boolescher Eingaben ausweisen können; Unit- und Integrations-Tests sichern die neuen Buckets ab.【F:custom_components/pawcontrol/types.py†L409-L466】【F:tests/unit/test_bool_coercion_telemetry.py†L85-L118】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L314】
- Bool-Coercion-Metriken zeichnen zusätzlich `first_seen`- und `last_seen`-Zeitstempel auf, damit Diagnostics nachvollziehen können, wann Normalisierungen zuletzt stattfanden; die neuen Felder werden serialisiert, dokumentiert und in Unit- sowie Integrations-Tests validiert.【F:custom_components/pawcontrol/telemetry.py†L29-L144】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1051】【F:docs/diagnostik.md†L33-L34】【F:tests/unit/test_bool_coercion_telemetry.py†L123-L145】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L314】
- Bool-Coercion-Überwachung berechnet jetzt zusätzlich `active_window_seconds`, um das Zeitfenster zwischen der ersten und letzten Normalisierung sichtbar zu machen; Diagnostik-Snapshots übernehmen das Feld direkt aus `get_bool_coercion_metrics`, während neue Regressionstests das berechnete Intervall und den Reset-Zustand absichern.【F:custom_components/pawcontrol/telemetry.py†L29-L117】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1043】【F:docs/diagnostik.md†L33-L38】【F:tests/unit/test_bool_coercion_telemetry.py†L1-L181】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L316】
- Bool-Coercion-Telemetrie verfolgt jetzt zusätzlich einen `reset_count` und veröffentlicht die Kennzahl auch dann in Diagnostics, wenn lediglich Zurücksetzungen stattgefunden haben; neue Regressionstests prüfen das Hochzählen der Resets und die Dokumentation beschreibt die Kennzahl für Support-Teams.【F:custom_components/pawcontrol/telemetry.py†L29-L181】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1046】【F:docs/diagnostik.md†L33-L38】【F:tests/unit/test_bool_coercion_telemetry.py†L186-L204】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L318】
- Bool-Coercion-Telemetrie speichert jetzt zusätzlich `last_reset`, sodass Diagnostics zeigen, wann Zähler zuletzt geleert wurden; die Telemetrie setzt den Zeitstempel beim Reset, und neue Regressionstests sowie Dokumentation validieren ISO-Ausgaben und den Export in die Diagnostics-Payload.【F:custom_components/pawcontrol/telemetry.py†L29-L187】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1050】【F:docs/diagnostik.md†L33-L38】【F:tests/unit/test_bool_coercion_telemetry.py†L186-L229】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L320】
- Bool-Coercion-Telemetrie meldet jetzt auch das Feld `last_reason`, damit Support-Snapshots den zuletzt beobachteten Normalisierungsgrund sofort erkennen; Tests und Diagnostics prüfen die neue Kennzahl und dokumentieren sie im bool-coercion-Abschnitt.【F:custom_components/pawcontrol/telemetry.py†L29-L190】【F:tests/unit/test_bool_coercion_telemetry.py†L131-L254】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L328】【F:docs/diagnostik.md†L33-L38】
- Bool-Coercion-Telemetrie zeichnet zusätzlich den zuletzt normalisierten Wert inklusive Typ- und Repräsentationsdetails (`last_value_type`/`last_value_repr`) auf, sodass Diagnostics und Support-Dokumentation den Problemwert ohne Rohdatenzugriff prüfen können; Regressionstests stellen sicher, dass Resets die Felder zurücksetzen und dass Integration-Diagnostics sie als Zeichenketten exportieren.【F:custom_components/pawcontrol/telemetry.py†L29-L211】【F:tests/unit/test_bool_coercion_telemetry.py†L281-L309】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L333】【F:docs/diagnostik.md†L33-L38】
- Bool-Coercion-Telemetrie speichert jetzt zusätzlich das zuletzt berechnete Ergebnis und den verwendeten Default (`last_result`/`last_default`), sodass Support-Snapshots sofort erkennen, ob Normalisierungen fallback- oder defaultbasiert erfolgten; Unit- und Integrations-Tests validieren die neuen Felder samt Reset-Verhalten und die Dokumentation verweist auf die erweiterten Diagnostics.【F:custom_components/pawcontrol/telemetry.py†L29-L211】【F:tests/unit/test_bool_coercion_telemetry.py†L18-L309】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L333】【F:docs/diagnostik.md†L33-L38】
- Der verschachtelte Merge-Helfer differenziert jetzt Sequenzüberlagerungen, indem `_merge_sequence_values` additive Vereinigungen erzeugt, leere Überschreibungen verwirft und das Direktive `__pc_merge_remove__` erlaubt, um Listen explizit zu leeren; neue Reconfigure-Regressionstests sichern additive, leere und Entfernen-Flows für verschachtelte Hundekonfigurationen.【F:custom_components/pawcontrol/config_flow.py†L2534-L2632】【F:tests/components/pawcontrol/test_config_flow.py†L804-L906】
- Skipped the unique ID guard for legacy entries without identifiers during reconfigure, preventing migration flows from failing the mismatch check and covering the guard bypass with dedicated regression tests.【F:custom_components/pawcontrol/config_flow.py†L2272-L2290】【F:tests/components/pawcontrol/test_config_flow.py†L333-L380】
- Merged legacy dog payloads from config entry data, options, and `dog_options` during reconfigure so migrations count active dogs with the latest module overrides, and regression coverage verifies the merged telemetry when profiles change.【F:custom_components/pawcontrol/config_flow.py†L2350-L2607】【F:tests/components/pawcontrol/test_config_flow.py†L562-L641】
- Normalised legacy module list payloads into boolean toggle mappings during reconfigure dog extraction, merging overrides with base module configurations so historical entries remain valid and telemetry reflects accurate dog counts, with regression coverage asserting the conversion.【F:custom_components/pawcontrol/config_flow.py†L2510-L2631】【F:tests/components/pawcontrol/test_config_flow.py†L644-L715】
- Rejection metrics exportieren jetzt zusätzlich die Breaker-Namenlisten (`open_breakers`, `half_open_breakers`, `unknown_breakers`) und spiegeln sie in `performance_metrics`, `error_summary` sowie den Dashboard-Markdowns; neue Tests sichern die Namenslisten für Default-, Runtime- und Frontend-Szenarien, und die Dokumentation verweist auf die erweiterten Felder.【F:custom_components/pawcontrol/coordinator_tasks.py†L440-L960】【F:custom_components/pawcontrol/diagnostics.py†L137-L176】【F:custom_components/pawcontrol/dashboard_templates.py†L1404-L1538】【F:tests/unit/test_coordinator_tasks.py†L260-L1108】【F:tests/components/pawcontrol/test_dashboard_renderer.py†L109-L160】【F:docs/diagnostik.md†L31-L48】
- Lokalisierte die neuen Breaker-Namenslisten in der Statistik-Markdown-Karte, sodass Dashboards die deutschen Labels („Namen offener Breaker“, „IDs blockierender Breaker“ etc.) automatisch übernehmen; zusätzliche Tests prüfen die Übersetzungen, und die Diagnostik-Dokumentation verweist auf die lokalisierten Strings.【F:custom_components/pawcontrol/dashboard_templates.py†L1404-L1538】【F:tests/unit/test_dashboard_templates.py†L473-L578】【F:docs/diagnostik.md†L36-L41】
- Lokalisierte außerdem die Leerlisten-Ausgabe der Breaker-Namens- und ID-Listen, damit Dashboards in allen Sprachen verständliche Platzhalter („none“/„keine“) zeigen; Regressionstests sichern sowohl den deutschen als auch den englischen Fallback und die Diagnostics-Guides verweisen auf die neue Darstellung.【F:custom_components/pawcontrol/dashboard_templates.py†L46-L1555】【F:tests/unit/test_dashboard_templates.py†L520-L620】【F:docs/diagnostik.md†L36-L41】
- Die Resilience-Zusammenfassung lokalisiert jetzt auch die Fallback-Werte für Ablehnungsrate und Zeitpunkt, indem „n/a“/„never“ abhängig von `hass.config.language` als „nicht verfügbar“ oder „nie“ ausgegeben werden und die Zeile zum letzten Breaker entfällt, wenn keine Kennung vorliegt; neue Tests prüfen englische und deutsche Dashboards.【F:custom_components/pawcontrol/dashboard_templates.py†L1490-L1537】【F:tests/unit/test_dashboard_templates.py†L620-L685】【F:docs/diagnostik.md†L36-L41】
- Die Statistik-Zusammenfassung übernimmt Kopfzeile, Hundezähler, Modulüberschrift, Modulnamen und Kartentitel nun ebenfalls aus dem Übersetzungs-Helper, sodass Dashboards ohne zusätzliche Anpassungen deutschsprachige Beschriftungen anzeigen; Regressionstests sichern die lokale Ausgabe der Kopfzeile und Modulzähler ab.【F:custom_components/pawcontrol/dashboard_templates.py†L1462-L1646】【F:tests/unit/test_dashboard_templates.py†L105-L151】【F:docs/diagnostik.md†L36-L45】
- Lokalisierte die Resilience-Überschrift sowie die Kennzahlen „Rejected calls“, „Rejecting breakers“, „Rejection rate“ und „Last rejection“, sodass die Statistik-Markdownkarte vollständig in der aktiven Home-Assistant-Sprache gerendert wird; Regressionstests sichern englische und deutsche Ausgaben und die Dokumentation verweist auf die übersetzten Zähler.【F:custom_components/pawcontrol/dashboard_templates.py†L1519-L1592】【F:tests/unit/test_dashboard_templates.py†L545-L686】【F:docs/diagnostik.md†L39-L40】
- Accepted legacy dog identifier aliases and module dictionaries during reconfigure, trimming fallback names so historical payloads keep human-friendly labels while coercing mixed toggle formats into typed mappings, with regression coverage capturing the normalised modules.【F:custom_components/pawcontrol/config_flow.py†L2510-L2715】【F:tests/components/pawcontrol/test_config_flow.py†L720-L800】
- Reinforced device removal compliance by scanning persisted `dog_options` payloads before allowing device cleanup and adding regression coverage plus compliance reporting so only stale PawControl devices are eligible for removal.【F:custom_components/pawcontrol/__init__.py†L1515-L1580】【F:tests/components/pawcontrol/test_init.py†L1081-L1148】【F:docs/compliance_gap_analysis.md†L16-L27】
- Extended quiet-hours automation coverage to assert cached suppression within the five-minute TTL, cache expiry recomputation, and quiet-hour cache cleanup so notification automation stays deterministic under UTC-aware helpers.【F:tests/unit/test_notifications.py†L505-L579】【F:tests/unit/test_notifications.py†L920-L937】
- Hardened notification batching by iterating over snapshot copies and added regression coverage for background batch flushing alongside static person-targeting fallbacks so diagnostics capture both delivery pathways under strict typing.【F:custom_components/pawcontrol/notifications.py†L1119-L1154】【F:tests/unit/test_notifications.py†L716-L813】【F:tests/unit/test_notifications.py†L996-L1040】
- Ergänzte Person-Targeting-Regressionen für Away-Person-Einbindung, Template-Kontext und Mobile-Retry-Telemetrie; die Notifications exportieren nun `retry_reschedules`/`retry_successes`, und die Dokumentation verweist auf die neuen Leistungskennzahlen.【F:custom_components/pawcontrol/notifications.py†L489-L514】【F:custom_components/pawcontrol/notifications.py†L1938-L1977】【F:tests/unit/test_notifications.py†L1098-L1333】【F:docs/diagnostik.md†L36-L48】
- Expanded the dashboard pipeline with visitor module cards, typed template imports, and renderer/module guards so Lovelace exports share canonical constants while weather layouts reuse the normalized generator lookups.【F:custom_components/pawcontrol/dashboard_cards.py†L1603-L1655】【F:custom_components/pawcontrol/dashboard_templates.py†L27-L43】【F:custom_components/pawcontrol/dashboard_renderer.py†L22-L116】【F:custom_components/pawcontrol/dashboard_generator.py†L29-L176】
- Bumped the rejection metrics schema to version 3, capturing open/half-open breaker counts and ID lists so coordinator statistics, diagnostics exports, and dashboard markdown stay aligned with the Platinum resilience dashboard expectations.【F:custom_components/pawcontrol/coordinator_tasks.py†L401-L492】【F:custom_components/pawcontrol/diagnostics.py†L120-L144】【F:custom_components/pawcontrol/coordinator_observability.py†L92-L135】【F:tests/unit/test_coordinator_observability.py†L88-L128】【F:tests/components/pawcontrol/test_diagnostics.py†L249-L287】【F:docs/diagnostik.md†L31-L55】
- Documented the visitor dashboard controls and insights in the public README and production handbook so operators understand the autogenerated entities and Markdown summary surfaced by the new card generator.【F:README.md†L417-L440】【F:docs/production_integration_documentation.md†L314-L332】【F:custom_components/pawcontrol/dashboard_cards.py†L1603-L1655】
- Added visitor dashboard regression coverage to assert the module card generator emits the entities card, markdown summary, and graceful markdown fallback when entity validation fails, keeping Lovelace exports stable under refactors.【F:tests/unit/test_dashboard_templates.py†L628-L718】
- Audited notification and shared helper fixtures to replace naive `datetime.now()` usage with timezone-aware UTC timestamps so the quiet-hours patch remains Python 3.13 compliant and automation coverage can rely on consistent payloads.【F:tests/conftest.py†L17-L23】【F:tests/conftest.py†L261-L505】【F:tests/unit/test_notifications.py†L828-L842】【F:tests/unit/test_walk_manager.py†L347-L656】【F:tests/unit/test_feeding_manager.py†L260-L339】【F:tests/unit/test_gps_manager.py†L224-L239】【F:tests/unit/test_data_manager.py†L150-L188】
- Standardised select, sensor, switch, and text platforms on typed module projections, batched entity helpers, and GPS-aware availability checks so runtime dog payloads stay within the `DogConfigData` contract while exposing the new visitor workflows.【F:custom_components/pawcontrol/select.py†L70-L200】【F:custom_components/pawcontrol/sensor.py†L184-L252】【F:custom_components/pawcontrol/switch.py†L219-L320】【F:custom_components/pawcontrol/text.py†L720-L765】
- Typed the number, date, and datetime platforms to route runtime dog payloads through `DogConfigData`/literal module aliases,
  guard coordinator writes with monitored closures, and normalise feeding ratios so strict typing accepts the entity setup while
  daily food comparisons handle missing values gracefully.【F:custom_components/pawcontrol/number.py†L122-L170】【F:custom_compon
ents/pawcontrol/number.py†L515-L704】【F:custom_components/pawcontrol/date.py†L135-L208】【F:custom_components/pawcontrol/date.py†
L349-L422】【F:custom_components/pawcontrol/datetime.py†L49-L116】
- Hardened the discovery manager by cloning requested categories into mutable
  lists for typed scans, filtering gather exceptions before extending results,
  annotating scheduled scan callbacks, and deduplicating devices by identifier
  so registry discovery stays type-safe under mypy while emitting the highest
  confidence snapshot per device.【F:custom_components/pawcontrol/discovery.py†L114-L177】【F:custom_components/pawcontrol/discovery.py†L337-L353】【F:custom_components/pawcontrol/discovery.py†L466-L477】
- Normalised the GPS device tracker by re-validating runtime dog payloads via
  `ensure_dog_config_data`, reusing module projections to gate entity creation,
  and guarding coordinator telemetry updates so route recordings persist as
  typed dictionaries without mutating unknown mappings.【F:custom_components/pawcontrol/device_tracker.py†L84-L159】【F:custom_components/pawcontrol/device_tracker.py†L352-L592】
- Normalised button and binary sensor setup to cast runtime dog payloads through
  `ensure_dog_config_data` and reuse literal field aliases for walk-state and
  visitor metrics so entity creation no longer trips TypedDict key checks while
  maintaining availability guards.【F:custom_components/pawcontrol/button.py†L606-L680】【F:custom_components/pawcontrol/button.py†L1243-L1334】【F:custom_components/pawcontrol/binary_sensor.py†L220-L295】【F:custom_components/pawcontrol/binary_sensor.py†L760-L799】【F:custom_components/pawcontrol/binary_sensor.py†L951-L993】
- Hardened the storage manager and performance monitor by annotating cached store
  loads with concrete mapping types, normalising hydrated history collections with
  dedicated walk and health buffers, and replacing the mutable metrics dictionary
  with a dataclass so diagnostics snapshots emit ISO-formatted timestamps while
  remaining type-safe for future telemetry expansion.【F:custom_components/pawcontrol/helpers.py†L441-L474】【F:custom_components/pawcontrol/helpers.py†L874-L925】【F:custom_components/pawcontrol/helpers.py†L1595-L1742】
- Extended dog literal aliases to cover walk and visitor state plus updated the
  dashboard generator to respect those literals and provide a renderer init
  shim before scheduling tasks, keeping background work typed while we wire in
  `types-aiofiles` stubs for mypy coverage.【F:custom_components/pawcontrol/types.py†L2158-L2175】【F:custom_components/pawcontrol/dashboard_generator.py†L29-L49】【F:custom_components/pawcontrol/dashboard_generator.py†L176-L236】【F:custom_components/pawcontrol/dashboard_generator.py†L668-L752】【F:requirements_test.txt†L1-L7】
- Normalised coordinator diagnostics fallbacks so legacy statistics payloads are
  translated into typed `CoordinatorStatisticsPayload` structures, rejection
  metrics are re-derived for performance summaries, and raw telemetry (including
  API tokens) remains available for redaction, keeping Platinum dashboards and
  docs aligned with the rejection metrics schema.【F:custom_components/pawcontrol/diagnostics.py†L107-L220】【F:custom_components/pawcontrol/diagnostics.py†L845-L920】
- Hardened integration setup by casting service registry checks away from
  unittest mocks, transforming typed dog payloads into manager-friendly
  dictionaries, guarding optional coordinator callables, and refining integer
  coercion for fractional `Real` inputs so strict typing no longer flags the
  setup path—reducing the mypy backlog to 190 errors.【F:custom_components/pawcontrol/__init__.py†L600-L878】【F:custom_components/pawcontrol/validation.py†L132-L195】
- Replaced tuple-based entity caches with typed dataclasses, normalised
  availability/attribute timestamp handling, and widened the sentinel
  coordinator typing so optimized entities reuse strictly typed payloads while
  hass-less registry sentinels continue to satisfy mypy’s requirements.【F:custom_components/pawcontrol/optimized_entity_base.py†L80-L118】【F:custom_components/pawcontrol/optimized_entity_base.py†L567-L908】
- Normalised the platform cache retrieval, coordinator statistics accessors,
  and service execution diagnostics so cached platform tuples stay immutable,
  guard payloads record resilience summaries, and coordinator helpers expose
  structured telemetry, trimming the strict-typing backlog to 200 errors.【F:custom_components/pawcontrol/__init__.py†L320-L386】【F:custom_components/pawcontrol/coordinator.py†L452-L516】【F:custom_components/pawcontrol/services.py†L406-L520】【F:custom_components/pawcontrol/types.py†L1798-L1804】
- Adopted literal field aliases across the base and external config flows plus
  the dashboard step mixin, introducing canonical constants for dog, dashboard,
  and external-entity payloads so TypedDict access stays type-safe while
  reducing config flow mypy violations.【F:custom_components/pawcontrol/config_flow_base.py†L1-L604】【F:custom_components/pawcontrol/config_flow_external.py†L1-L212】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L1-L220】【F:custom_components/pawcontrol/types.py†L2110-L2176】
- Extended those literal aliases to the options flow by introducing dedicated
  constants for GPS settings, dog overrides, and reconfigure telemetry, updating
  `_normalise_options_snapshot` to operate on mutable clones, and routing GPS
  persistence through the new fields so mypy accepts the TypedDict assignments
  while keeping runtime coercion intact.【F:custom_components/pawcontrol/const.py†L129-L199】【F:custom_components/pawcontrol/options_flow.py†L168-L333】【F:custom_components/pawcontrol/options_flow.py†L3088-L3135】
- Tightened the weather module adapter fallback, helper guard diagnostics, and
  coordinator task typing so weather payload caching, guard telemetry exports,
  and module fetch loops operate on literal module names without duplicate
  annotations.【F:custom_components/pawcontrol/module_adapters.py†L560-L625】【F:custom_components/pawcontrol/helper_manager.py†L160-L276】【F:custom_components/pawcontrol/coordinator_runtime.py†L1-L94】【F:custom_components/pawcontrol/types.py†L1438-L1472】
- Normalised walk route telemetry with the new `WalkRoutePoint` typed dict,
  updated cache monitor registration to expose typed snapshot providers without
  reusing configuration buffers for entry IDs, extended repairs metadata with
  timestamp anomaly tracking, and populated coordinator performance metrics via
  explicit guard-field assignments so strict typing accepts the rejection
  telemetry surface.【F:custom_components/pawcontrol/types.py†L1588-L1604】【F:custom_components/pawcontrol/types.py†L2736-L2780】【F:custom_components/pawcontrol/data_manager.py†L904-L935】【F:custom_components/pawcontrol/data_manager.py†L2330-L2349】【F:custom_components/pawcontrol/coordinator_tasks.py†L724-L765】
- Guarded dog configuration merges to only treat stored mappings as mutable
  dictionaries, exported rejection metrics through typed payloads before
  snapshot serialisation, widened module adapter bindings to accept optional
  managers, and provided a writable runtime manager property plus typed module
  access overloads so coordinator consumers stay aligned with the
  `CoordinatorRuntimeManagers` container.【F:custom_components/pawcontrol/data_manager.py†L2424-L2428】【F:custom_components/pawcontrol/coordinator_observability.py†L11-L13】【F:custom_components/pawcontrol/coordinator_observability.py†L122-L131】【F:custom_components/pawcontrol/module_adapters.py†L742-L763】【F:custom_components/pawcontrol/coordinator.py†L69-L75】【F:custom_components/pawcontrol/coordinator.py†L282-L292】【F:custom_components/pawcontrol/coordinator.py†L435-L448】
- Validated the Lovelace statistics view’s resilience metrics markdown with
  integration coverage and refreshed README plus quickstart guidance so the
  packaged Platinum dashboard exposes the rejection counters without manual
  tweaks.【F:tests/components/pawcontrol/test_dashboard_renderer.py†L56-L140】【F:README.md†L753-L780】【F:docs/resilience-quickstart.md†L181-L186】
- Hardened script automation caching, person state tracking, and geofencing/
  weather module payload builders so the mypy backlog drops to 242 errors while
  keeping diagnostics snapshots fully typed.【F:custom_components/pawcontrol/script_manager.py†L86-L220】【F:custom_components/pawcontrol/person_entity_manager.py†L326-L404】【F:custom_components/pawcontrol/module_adapters.py†L348-L654】
- Normalised advanced options, dog configuration door sensor fields, and coordinator empty payload scaffolding to rely on string-literal TypedDict keys, while aligning the circuit breaker error hierarchy with the Home Assistant exception type so strict typing no longer flags the coordinator defaults.【F:custom_components/pawcontrol/types.py†L514-L576】【F:custom_components/pawcontrol/types.py†L2235-L2265】【F:custom_components/pawcontrol/coordinator_support.py†L302-L349】【F:custom_components/pawcontrol/resilience.py†L60-L118】
- Routed coordinator statistics snapshots through the dashboard generator and renderer so the statistics summary now surfaces rejection metrics alongside module counts, with updated diagnostics documentation and targeted regression coverage for the new resilience block.【F:custom_components/pawcontrol/dashboard_generator.py†L120-L226】【F:custom_components/pawcontrol/dashboard_renderer.py†L148-L222】【F:custom_components/pawcontrol/dashboard_templates.py†L1330-L1399】【F:docs/diagnostik.md†L30-L39】【F:tests/unit/test_dashboard_generator.py†L210-L272】【F:tests/unit/test_dashboard_templates.py†L390-L436】
- Captured garden service validation payloads and enforced non-empty validation messages so telemetry records failed confirmations and activities, with regression tests covering the new diagnostics surfaces.【F:custom_components/pawcontrol/services.py†L139-L180】【F:custom_components/pawcontrol/services.py†L3835-L4089】【F:tests/components/pawcontrol/test_services.py†L238-L318】【F:tests/unit/test_services.py†L38-L90】
- Updated the compliance gap analysis and README Platinum callouts to flag strict typing, resilience UI validation, and documentation blockers so reviewers can track outstanding Platinum work alongside the new resilience telemetry.【F:docs/compliance_gap_analysis.md†L16-L43】【F:README.md†L1139-L1150】
- Hardened device removal gating by merging runtime data and options-sourced dogs before allowing cleanup and expanded regression coverage for runtime, options, and foreign-device scenarios.【F:custom_components/pawcontrol/__init__.py†L1485-L1532】【F:tests/components/pawcontrol/test_init.py†L1001-L1118】
- Shared `CONF_DOOR_SENSOR_SETTINGS` across helpers so stored overrides no longer rely on bespoke keys.【F:custom_components/pawcontrol/const.py†L129-L142】
- Normalised door sensor overrides through `_coerce_bool` and companion helpers before persisting them, ensuring reloads retain clamped values without restarting monitors unnecessarily.【F:custom_components/pawcontrol/door_sensor_manager.py†L40-L347】【F:custom_components/pawcontrol/types.py†L1921-L1995】
- Expanded regression coverage to assert alias handling, numeric toggle coercion, persistence, removals, and no-op updates for the door sensor manager workflow.【F:tests/unit/test_door_sensor_manager.py†L23-L310】
- Hardened door sensor initialisation so non-string entity IDs and unsupported override payloads are ignored before normalisation, keeping runtime persistence typed and backed by regression coverage.【F:custom_components/pawcontrol/door_sensor_manager.py†L721-L808】【F:tests/unit/test_door_sensor_manager.py†L292-L339】
- Added a door sensor configuration step to the options flow that normalises overrides via `ensure_door_sensor_settings_config`, persists changes through `PawControlDataManager.async_update_dog_data`, and verifies normal/removal paths with targeted unit tests.【F:custom_components/pawcontrol/options_flow.py†L2105-L2255】【F:tests/unit/test_options_flow.py†L162-L276】
- Re-exported `DEFAULT_CONFIDENCE_THRESHOLD` from the door sensor manager so downstream helpers and tests can import the canonical threshold and dataclass defaults stay aligned with the typed settings model.【F:custom_components/pawcontrol/door_sensor_manager.py†L44-L60】【F:custom_components/pawcontrol/door_sensor_manager.py†L474-L488】
- Captured door sensor persistence failures by logging runtime telemetry, raising repair issues, and surfacing diagnostics plus localized guidance, with regression coverage for the error path and snapshot exports.【F:custom_components/pawcontrol/options_flow.py†L2183-L2259】【F:custom_components/pawcontrol/telemetry.py†L164-L233】【F:custom_components/pawcontrol/repairs.py†L50-L419】【F:custom_components/pawcontrol/diagnostics.py†L137-L150】【F:custom_components/pawcontrol/diagnostics.py†L695-L748】【F:custom_components/pawcontrol/strings.json†L1317-L1320】【F:tests/unit/test_options_flow.py†L1327-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L142-L214】
- Tightened discovery orchestration to coerce requested categories into typed lists, guard `asyncio.gather` results against `BaseException`, and collapse duplicate registry results by confidence so asynchronous scans stay deterministic under mypy.【F:custom_components/pawcontrol/discovery.py†L1-L182】【F:custom_components/pawcontrol/discovery.py†L437-L454】
- Normalised coordinator diagnostics by coercing raw statistics into `CoordinatorStatisticsPayload`, backfilling rejection metrics, and merging legacy keys so telemetry stays typed while redaction tests retain their expectations.【F:custom_components/pawcontrol/diagnostics.py†L688-L840】
- Converted module adapter caches to Python 3.13 type-parameter syntax and now accept typed module flag mappings so coordinator tasks no longer funnel through `dict[str, Any]` payload stubs before scheduling adapter fetches.【F:custom_components/pawcontrol/module_adapters.py†L63-L174】【F:custom_components/pawcontrol/module_adapters.py†L794-L814】
- Typed the coordinator payload pipeline end-to-end by introducing `CoordinatorDogData`, defaulting module states to `"unknown"`, and updating runtime helpers to return structured telemetry snapshots instead of loose dictionaries.【F:custom_components/pawcontrol/types.py†L1855-L1902】【F:custom_components/pawcontrol/coordinator_support.py†L46-L330】【F:custom_components/pawcontrol/coordinator_runtime.py†L324-L465】【F:custom_components/pawcontrol/coordinator.py†L150-L357】【F:custom_components/pawcontrol/coordinator_accessors.py†L1-L47】
- Typed the module adapter protocol end-to-end by introducing `ModuleCacheMetrics`, `CoordinatorModuleTask`, and `CoordinatorRuntimeManagers`, updating adapters, runtime fetchers, and diagnostics monitors to operate on structured tasks and cache metrics instead of dictionary shims.【F:custom_components/pawcontrol/types.py†L1296-L1351】【F:custom_components/pawcontrol/module_adapters.py†L777-L876】【F:custom_components/pawcontrol/coordinator_runtime.py†L428-L466】【F:custom_components/pawcontrol/coordinator_support.py†L196-L625】【F:custom_components/pawcontrol/data_manager.py†L376-L450】
- Normalised coordinator data access to return typed module payloads by extending `CoordinatorDataAccessMixin`/`PawControlCoordinator`, wiring runtime manager containers through dedicated accessors, and adding regression coverage for typed versus untyped module fallbacks.【F:custom_components/pawcontrol/coordinator_accessors.py†L1-L83】【F:custom_components/pawcontrol/coordinator.py†L1-L335】【F:tests/unit/test_coordinator_accessors.py†L1-L57】
- Routed entity caches, select/button platforms, and service validators through the shared `CoordinatorRuntimeManagers` container so typed module payloads and persistence helpers no longer depend on direct attribute shims, with regression coverage exercising the new pathways.【F:custom_components/pawcontrol/optimized_entity_base.py†L741-L855】【F:custom_components/pawcontrol/select.py†L433-L504】【F:custom_components/pawcontrol/button.py†L933-L949】【F:custom_components/pawcontrol/services.py†L1149-L1660】【F:custom_components/pawcontrol/types.py†L2292-L2345】【F:tests/components/pawcontrol/test_select_entities.py†L24-L133】【F:tests/unit/test_coordinator.py†L205-L225】
- Extended runtime manager container usage to sensors, numbers, switches, and diagnostics so entity helpers resolve managers through shared accessors without legacy attribute fallbacks, and select helpers/tests reuse the containerised lookup path.【F:custom_components/pawcontrol/entity.py†L1-L160】【F:custom_components/pawcontrol/sensor.py†L904-L925】【F:custom_components/pawcontrol/number.py†L600-L618】【F:custom_components/pawcontrol/switch.py†L500-L553】【F:custom_components/pawcontrol/diagnostics.py†L40-L450】【F:custom_components/pawcontrol/select.py†L424-L446】【F:tests/components/pawcontrol/test_all_platforms.py†L207-L230】【F:tests/unit/test_services.py†L494-L522】
- Routed garden binary sensors, birthdate telemetry, emergency datetime notifications, and custom message text entities through the shared runtime manager container so fallbacks resolve managers even when coordinator attributes are absent, with targeted regression coverage for garden, date/datetime, and notification workflows.【F:custom_components/pawcontrol/binary_sensor.py†L537-L576】【F:custom_components/pawcontrol/date.py†L573-L731】【F:custom_components/pawcontrol/datetime.py†L327-L675】【F:custom_components/pawcontrol/text.py†L287-L724】【F:tests/unit/test_runtime_manager_container_usage.py†L85-L327】
- Added `_async_call_hass_service` to the entity base and wired date, datetime, and text helpers through it so hass-less entities skip service calls cleanly, with new regression coverage exercising the guard behaviour.【F:custom_components/pawcontrol/entity.py†L5-L198】【F:custom_components/pawcontrol/date.py†L573-L731】【F:custom_components/pawcontrol/datetime.py†L327-L675】【F:custom_components/pawcontrol/text.py†L287-L724】【F:tests/unit/test_runtime_manager_container_usage.py†L260-L327】
- Routed visitor mode switches, module feature toggles, and garden confirmation buttons through `_async_call_hass_service` so hass-less contexts short-circuit safely, and expanded runtime manager container tests to assert the new guard paths.【F:custom_components/pawcontrol/switch.py†L578-L806】【F:custom_components/pawcontrol/button.py†L1871-L1908】【F:tests/unit/test_runtime_manager_container_usage.py†L332-L374】
- Centralised Home Assistant service guards via `async_call_hass_service_if_available`, wiring helper creation/removal, notification delivery, entity helpers, and the legacy notification queue through the shared guard so hass-less contexts short-circuit with regression coverage for helper creation and persistent notification acknowledgement.【F:custom_components/pawcontrol/utils.py†L169-L263】【F:custom_components/pawcontrol/entity.py†L170-L194】【F:custom_components/pawcontrol/helper_manager.py†L563-L944】【F:custom_components/pawcontrol/notifications.py†L1460-L1806】【F:custom_components/pawcontrol/helpers.py†L1406-L1477】【F:tests/unit/test_data_manager.py†L333-L365】【F:tests/unit/test_notifications.py†L737-L756】
- Captured guard telemetry for Home Assistant service calls by introducing `ServiceGuardResult`/`ServiceGuardSummary`, a context manager for aggregating guard outcomes, and persistence in `_record_service_result`, with notification and grooming/GPS services recording whether calls executed or skipped and regression coverage validating guard skip metrics.【F:custom_components/pawcontrol/service_guard.py†L1-L46】【F:custom_components/pawcontrol/utils.py†L187-L264】【F:custom_components/pawcontrol/services.py†L384-L473】【F:tests/unit/test_services.py†L741-L780】
- Aggregated helper manager guard metrics into cache diagnostics by tracking every guarded helper service call, exporting `service_guard_metrics`, and covering hass-less creation/removal flows with new regression tests.【F:custom_components/pawcontrol/helper_manager.py†L166-L283】【F:custom_components/pawcontrol/helper_manager.py†L628-L1016】【F:custom_components/pawcontrol/types.py†L1252-L1273】【F:custom_components/pawcontrol/types.py†L1473-L1506】【F:tests/unit/test_data_manager.py†L304-L426】
- Normalised advanced options snapshots through `ensure_advanced_options`, wiring `_normalise_options_snapshot`, `_current_advanced_options`, and `_build_advanced_settings` to reuse the typed helper while regression tests assert legacy payloads coerce correctly.【F:custom_components/pawcontrol/types.py†L455-L551】【F:custom_components/pawcontrol/options_flow.py†L248-L295】【F:custom_components/pawcontrol/options_flow.py†L676-L683】【F:custom_components/pawcontrol/options_flow.py†L1080-L1109】【F:tests/unit/test_options_flow.py†L923-L1061】
- Exported guarded service telemetry through the new `service_execution` diagnostics block, updated the README and diagnostics guide with guard metric locations, and expanded diagnostics regression coverage to assert guard summaries and metadata stay serialisable for support tooling.【F:custom_components/pawcontrol/diagnostics.py†L780-L867】【F:README.md†L722-L741】【F:docs/diagnostik.md†L31-L38】【F:tests/components/pawcontrol/test_diagnostics.py†L129-L203】
- Canonicalised performance mode constants so the select platform, advanced options, and helpers share the `balanced` default while preserving the legacy `standard` alias, with regression tests covering alias normalisation and option alignment.【F:custom_components/pawcontrol/types.py†L456-L509】【F:custom_components/pawcontrol/const.py†L341-L347】【F:custom_components/pawcontrol/select.py†L23-L43】【F:custom_components/pawcontrol/select.py†L763-L779】【F:tests/unit/test_types_performance_mode.py†L1-L35】
- Synced documentation and configuration copy with the balanced performance default by documenting the alias handling in the README, diagnostics guide, and advanced option translations so users see the canonical mode and backwards-compatible `standard` mapping during setup.【F:README.md†L292-L296】【F:docs/diagnostik.md†L43-L48】【F:custom_components/pawcontrol/strings.json†L293-L297】【F:custom_components/pawcontrol/translations/en.json†L296-L303】【F:custom_components/pawcontrol/translations/de.json†L296-L303】

## Error backlog
1. *Keine offenen Fehler – Stand 2025-02-14*

## Improvement opportunities
- Beobachte die erweiterten `bool_coercion`-Gründe (`native_*`, `numeric_*`, `truthy_string`, `falsy_string`, `unknown_string`), die neuen Reset-Metriken (`reset_count`, `last_reset`), das ergänzte `last_reason` sowie die zuletzt aufgezeichneten Wert-Details (`last_value_type`/`last_value_repr`), und erweitere bei Bedarf Regressionen, falls zusätzliche Typen oder Resets außerhalb der Tests auftreten.【F:custom_components/pawcontrol/telemetry.py†L29-L198】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1054】【F:tests/unit/test_bool_coercion_telemetry.py†L61-L312】
- Track resilience UI updates so diagnostics, docs, and coordinator observability stay aligned with the latest rejection metrics schema.【F:custom_components/pawcontrol/coordinator_observability.py†L82-L150】【F:docs/diagnostik.md†L24-L48】

## Next sprint priorities
1. **Brand package submission** – Finalise icon assets and upstream the branding PR so README and manifest updates can advertise Platinum status without drift.【F:docs/compliance_gap_analysis.md†L12-L23】
2. **Coverage automation** – Restore automated coverage publication once the Home Assistant harness stabilises so Platinum evidence remains auditable without manual uploads.【F:README.md†L24-L70】【F:docs/compliance_gap_analysis.md†L16-L25】

## Regression coverage highlights
- `tests/unit/test_door_sensor_manager.py` protects alias handling, numeric toggle coercion, persistence through the data manager, removals, and monitoring restarts for the door sensor manager helpers.【F:tests/unit/test_door_sensor_manager.py†L23-L310】
- Config flow and compat tests safeguard the exception rebinding harness so reloads keep using the active Home Assistant exceptions.【F:tests/components/pawcontrol/test_config_flow.py†L40-L120】【F:tests/unit/test_exception_alias_rebinds.py†L1-L184】
- Door sensor persistence failure and diagnostics telemetry are exercised through targeted unit tests to ensure repair issues fire and telemetry surfaces in snapshots.【F:tests/unit/test_options_flow.py†L1327-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L142-L214】
- Runtime manager container regression tests cover garden binary sensors, birthdate persistence, emergency notifications, custom message routing, and hass-guarded visitor buttons/switches to prevent regressions when hass-free stubs exercise manager fallbacks.【F:tests/unit/test_runtime_manager_container_usage.py†L82-L374】
- Garden service regression tests now assert confirmation and activity failures capture payload telemetry for diagnostics and service statistics.【F:tests/components/pawcontrol/test_services.py†L238-L318】【F:tests/unit/test_services.py†L38-L90】
- Reworked the dashboard statistics markdown card to pull rejection metrics
  through `derive_rejection_metrics`, ensuring Platinum dashboards reuse the
  canonical coordinator schema instead of mutating ad-hoc dictionaries.【F:custom_components/pawcontrol/dashboard_templates.py†L35-L43】【F:custom_components/pawcontrol/dashboard_templates.py†L1364-L1428】
- Standardised text, switch, sensor, and select platforms to hydrate
  `DogConfigData` via literal aliases and typed module coercers, eliminating
  `TypedDict` literal violations while keeping module-aware entity creation and
  option lists aligned with Home Assistant expectations.【F:custom_components/pawcontrol/text.py†L27-L35】【F:custom_components/pawcontrol/text.py†L167-L212】【F:custom_components/pawcontrol/switch.py†L41-L50】【F:custom_components/pawcontrol/switch.py†L218-L312】【F:custom_components/pawcontrol/sensor.py†L185-L233】【F:custom_components/pawcontrol/sensor.py†L720-L817】【F:custom_components/pawcontrol/select.py†L16-L54】【F:custom_components/pawcontrol/select.py†L209-L312】
## Workflow overview
- Verwende eine lokale virtuelle Umgebung (`python -m venv .venv`), installiere
  danach `requirements_test.txt` und `requirements.txt`, und exportiere
  `PYTHONPATH=$(pwd)`, damit die Home-Assistant-Shims unter `pytest_asyncio/`,
  `pytest_cov/` sowie die Hilfsskripte unter `script/` gefunden werden.【F:requirements_test.txt†L1-L25】【F:sitecustomize.py†L1-L175】
- Führe vor jedem Commit `ruff format`, `ruff check`, `pytest -q`,
  `mypy custom_components/pawcontrol` und
  `python -m script.hassfest --integration-path custom_components/pawcontrol`
  aus, damit die Platinum-Gates aus `pyproject.toml` eingehalten werden.【F:pyproject.toml†L7-L72】【F:.github/copilot-instructions.md†L27-L46】
- Aktualisiere nach Änderungen an Beitragsrichtlinien oder Übersetzungen die
  Spiegeldateien über `python -m script.sync_contributor_guides` bzw.
  `python -m script.sync_localization_flags` und führe die Wächter unter
  `scripts/` aus, wenn Diagnostik oder Guard-Metriken betroffen sind.【F:script/sync_contributor_guides.py†L1-L121】【F:script/sync_localization_flags.py†L1-L129】

## Validated tool snapshot (2025-02-15)
- ✅ `ruff check`
- ✅ `pytest -q`
- ✅ `mypy custom_components/pawcontrol`
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol`

Die Läufe spiegeln den aktuellen Stand ohne neue Warnungen wider und halten die
Branch-Coverage-Anforderungen aus `pyproject.toml` ein.【F:pyproject.toml†L7-L62】

## Fehlerliste
1. *Keine bekannten Fehlerstände* – Laufende Checks und Tests passierten zuletzt
   ohne Abweichungen.

## Verbesserungsmöglichkeiten
- Performance der Coverage-Läufe weiter optimieren; Ziel bleibt eine Laufzeit
  unter 20 Minuten trotz aktiviertem Branch-Tracing für das komplette Paket.
- Beobachte Übersetzungs- und Dokumentations-Syncs nach Schemaänderungen in den
  Diagnostics, damit `setup_flags_panel_*`-Schlüssel konsistent bleiben.【F:custom_components/pawcontrol/diagnostics.py†L688-L867】【F:custom_components/pawcontrol/strings.json†L1396-L1405】
- Evaluiere zusätzliche Plattform-spezifische Regressionstests für neue Entity-
  Typen, sobald weitere Home-Assistant-Plattformen integriert werden sollen, um
  die Coordinator-Schnittstellen weiterhin abzudecken.【F:tests/components/pawcontrol/test_all_platforms.py†L1451-L1494】【F:tests/unit/test_runtime_manager_container_usage.py†L82-L374】
