# Development plan

## Quality gate expectations
- Run `ruff check`, `pytest -q`, `mypy custom_components/pawcontrol`, and `python -m script.hassfest --integration-path custom_components/pawcontrol` before opening a pull request so Platinum-level guardrails stay enforced.【F:.github/copilot-instructions.md†L10-L28】
- Target Python 3.13+ features and reuse PawControl helpers (coordinators, managers, and typed constants) to keep runtime data on the typed surface.【F:.github/copilot-instructions.md†L29-L94】

## Latest tooling snapshot
- ✅ `ruff check` – passes without lint findings.【adf020†L1-L1】
- ✅ `pytest -q` – full suite passes (976 passed, 1 skipped).【647ab9†L1-L5】
- ✅ `mypy custom_components/pawcontrol` – strict typing passes with zero issues across 74 source files.【db647f†L1-L2】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – manifest und Übersetzungen validiert ohne Befunde.【8ac83d†L1-L2】

## Recent improvements
- Blocked redundant reconfigure submissions by surfacing a `profile_unchanged` validation error when the requested profile matches the active selection, preventing unnecessary reloads and ensuring regression coverage verifies the guard stays in place.【F:custom_components/pawcontrol/config_flow.py†L1989-L2067】【F:tests/components/pawcontrol/test_config_flow.py†L320-L352】
- Hardened Zeroconf, DHCP, USB, and Bluetooth discovery updates by normalising metadata, recording `last_seen`, matching unique IDs case-insensitively, and persisting refreshed discovery info only when changes occur, with regression coverage confirming rediscovery avoids redundant reloads while storing new host/IP details.【F:custom_components/pawcontrol/config_flow.py†L292-L464】【F:custom_components/pawcontrol/types.py†L1018-L1037】【F:tests/components/pawcontrol/test_config_flow.py†L470-L558】
- Ergänzte die Resilience-Telemetrie um `unknown_breaker_count` und `unknown_breaker_ids`, sodass Koordinator-Snapshots, Diagnostics und Dashboard-Markdown jetzt alle Breaker-Listen der Schema-Version 3 exportieren und Regressionstests die neuen Felder absichern.【F:custom_components/pawcontrol/coordinator_tasks.py†L366-L418】【F:custom_components/pawcontrol/diagnostics.py†L133-L160】【F:custom_components/pawcontrol/types.py†L2108-L2122】【F:tests/unit/test_coordinator_tasks.py†L228-L309】【F:tests/unit/test_coordinator_observability.py†L120-L172】【F:tests/components/pawcontrol/test_diagnostics.py†L260-L288】
- Normalised the reconfigure form to surface compatibility summaries, valid versus invalid dog counts, and historical telemetry even for legacy mapping payloads, ensuring multi-dog migrations remain supported and covered by regression tests.【F:custom_components/pawcontrol/config_flow.py†L1972-L2144】【F:custom_components/pawcontrol/translations/en.json†L248-L255】【F:tests/components/pawcontrol/test_config_flow.py†L353-L425】
- Added reconfigure merge notes that capture how config-entry dogs, options, and `dog_options` snapshots were normalised; the telemetry, form placeholders, translation guards, and options flow all expose the same list so operators can audit legacy merges during support investigations.【F:custom_components/pawcontrol/config_flow.py†L2321-L2684】【F:custom_components/pawcontrol/telemetry.py†L46-L83】【F:tests/components/pawcontrol/test_config_flow.py†L471-L640】【F:tests/unit/test_options_flow.py†L389-L430】【F:tests/unit/test_translation_placeholders.py†L1-L70】
- Bool-Coercion-Telemetrie zeichnet jetzt `none`-, `blank_string`- und `fallback`-Konvertierungen in `_coerce_bool` auf, persistiert Typ- und Grundzähler via `record_bool_coercion_event`, exportiert die Daten unter `diagnostics["bool_coercion"]` und ist mit neuen Regressionstests abgesichert, die den Nullzustand und Legacy-Sequenzen validieren.【F:custom_components/pawcontrol/types.py†L409-L466】【F:custom_components/pawcontrol/telemetry.py†L29-L134】【F:custom_components/pawcontrol/diagnostics.py†L343-L363】【F:tests/unit/test_bool_coercion_telemetry.py†L1-L60】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L314】
- Bool-Coercion-Überwachung erweitert die Telemetrie um numerische (`numeric_nonzero`/`numeric_zero`) sowie stringbasierte Gründe (`truthy_string`, `falsy_string`, `unknown_string`), damit Diagnostics erkannte versus unbekannte Eingaben differenziert anzeigen und Regressionstests die neuen Zähler abdecken.【F:custom_components/pawcontrol/types.py†L409-L466】【F:custom_components/pawcontrol/telemetry.py†L29-L134】【F:tests/unit/test_bool_coercion_telemetry.py†L65-L118】
- Native Wahrheitswerte werden jetzt ebenfalls als dedizierte Gründe (`native_true`/`native_false`) erfasst, sodass Diagnostics die Anzahl direkter boolescher Eingaben ausweisen können; Unit- und Integrations-Tests sichern die neuen Buckets ab.【F:custom_components/pawcontrol/types.py†L409-L466】【F:tests/unit/test_bool_coercion_telemetry.py†L85-L118】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L314】
- Bool-Coercion-Metriken zeichnen zusätzlich `first_seen`- und `last_seen`-Zeitstempel auf, damit Diagnostics nachvollziehen können, wann Normalisierungen zuletzt stattfanden; die neuen Felder werden serialisiert, dokumentiert und in Unit- sowie Integrations-Tests validiert.【F:custom_components/pawcontrol/telemetry.py†L29-L144】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1051】【F:docs/diagnostik.md†L33-L34】【F:tests/unit/test_bool_coercion_telemetry.py†L123-L145】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L314】
- Bool-Coercion-Überwachung berechnet jetzt zusätzlich `active_window_seconds`, um das Zeitfenster zwischen der ersten und letzten Normalisierung sichtbar zu machen; Diagnostik-Snapshots übernehmen das Feld direkt aus `get_bool_coercion_metrics`, während neue Regressionstests das berechnete Intervall und den Reset-Zustand absichern.【F:custom_components/pawcontrol/telemetry.py†L29-L117】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1043】【F:docs/diagnostik.md†L33-L38】【F:tests/unit/test_bool_coercion_telemetry.py†L1-L181】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L316】
- Bool-Coercion-Telemetrie verfolgt jetzt zusätzlich einen `reset_count` und veröffentlicht die Kennzahl auch dann in Diagnostics, wenn lediglich Zurücksetzungen stattgefunden haben; neue Regressionstests prüfen das Hochzählen der Resets und die Dokumentation beschreibt die Kennzahl für Support-Teams.【F:custom_components/pawcontrol/telemetry.py†L29-L181】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1046】【F:docs/diagnostik.md†L33-L38】【F:tests/unit/test_bool_coercion_telemetry.py†L186-L204】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L318】
- Bool-Coercion-Telemetrie speichert jetzt zusätzlich `last_reset`, sodass Diagnostics zeigen, wann Zähler zuletzt geleert wurden; die Telemetrie setzt den Zeitstempel beim Reset, und neue Regressionstests sowie Dokumentation validieren ISO-Ausgaben und den Export in die Diagnostics-Payload.【F:custom_components/pawcontrol/telemetry.py†L29-L187】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1050】【F:docs/diagnostik.md†L33-L38】【F:tests/unit/test_bool_coercion_telemetry.py†L186-L229】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L320】
- Bool-Coercion-Telemetrie meldet jetzt auch das Feld `last_reason`, damit Support-Snapshots den zuletzt beobachteten Normalisierungsgrund sofort erkennen; Tests und Diagnostics prüfen die neue Kennzahl und dokumentieren sie im bool-coercion-Abschnitt.【F:custom_components/pawcontrol/telemetry.py†L29-L190】【F:tests/unit/test_bool_coercion_telemetry.py†L131-L254】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L328】【F:docs/diagnostik.md†L33-L38】
- Bool-Coercion-Telemetrie zeichnet zusätzlich den zuletzt normalisierten Wert inklusive Typ- und Repräsentationsdetails (`last_value_type`/`last_value_repr`) auf, sodass Diagnostics und Support-Dokumentation den Problemwert ohne Rohdatenzugriff prüfen können; Regressionstests stellen sicher, dass Resets die Felder zurücksetzen und dass Integration-Diagnostics sie als Zeichenketten exportieren.【F:custom_components/pawcontrol/telemetry.py†L29-L211】【F:tests/unit/test_bool_coercion_telemetry.py†L281-L309】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L333】【F:docs/diagnostik.md†L33-L38】
- Bool-Coercion-Telemetrie speichert jetzt zusätzlich das zuletzt berechnete Ergebnis und den verwendeten Default (`last_result`/`last_default`), sodass Support-Snapshots sofort erkennen, ob Normalisierungen fallback- oder defaultbasiert erfolgten; Unit- und Integrations-Tests validieren die neuen Felder samt Reset-Verhalten und die Dokumentation verweist auf die erweiterten Diagnostics.【F:custom_components/pawcontrol/telemetry.py†L29-L211】【F:tests/unit/test_bool_coercion_telemetry.py†L18-L309】【F:tests/components/pawcontrol/test_diagnostics.py†L294-L333】【F:docs/diagnostik.md†L33-L38】
- Skipped the unique ID guard for legacy entries without identifiers during reconfigure, preventing migration flows from failing the mismatch check and covering the guard bypass with dedicated regression tests.【F:custom_components/pawcontrol/config_flow.py†L2272-L2290】【F:tests/components/pawcontrol/test_config_flow.py†L333-L380】
- Merged legacy dog payloads from config entry data, options, and `dog_options` during reconfigure so migrations count active dogs with the latest module overrides, and regression coverage verifies the merged telemetry when profiles change.【F:custom_components/pawcontrol/config_flow.py†L2350-L2607】【F:tests/components/pawcontrol/test_config_flow.py†L562-L641】
- Normalised legacy module list payloads into boolean toggle mappings during reconfigure dog extraction, merging overrides with base module configurations so historical entries remain valid and telemetry reflects accurate dog counts, with regression coverage asserting the conversion.【F:custom_components/pawcontrol/config_flow.py†L2510-L2631】【F:tests/components/pawcontrol/test_config_flow.py†L644-L715】
- Accepted legacy dog identifier aliases and module dictionaries during reconfigure, trimming fallback names so historical payloads keep human-friendly labels while coercing mixed toggle formats into typed mappings, with regression coverage capturing the normalised modules.【F:custom_components/pawcontrol/config_flow.py†L2510-L2715】【F:tests/components/pawcontrol/test_config_flow.py†L720-L800】
- Reinforced device removal compliance by scanning persisted `dog_options` payloads before allowing device cleanup and adding regression coverage plus compliance reporting so only stale PawControl devices are eligible for removal.【F:custom_components/pawcontrol/__init__.py†L1515-L1580】【F:tests/components/pawcontrol/test_init.py†L1081-L1148】【F:docs/compliance_gap_analysis.md†L16-L27】
- Extended quiet-hours automation coverage to assert cached suppression within the five-minute TTL, cache expiry recomputation, and quiet-hour cache cleanup so notification automation stays deterministic under UTC-aware helpers.【F:tests/unit/test_notifications.py†L505-L579】【F:tests/unit/test_notifications.py†L920-L937】
- Hardened notification batching by iterating over snapshot copies and added regression coverage for background batch flushing alongside static person-targeting fallbacks so diagnostics capture both delivery pathways under strict typing.【F:custom_components/pawcontrol/notifications.py†L1119-L1154】【F:tests/unit/test_notifications.py†L716-L813】【F:tests/unit/test_notifications.py†L996-L1040】
- Ergänzte Person-Targeting-Regressionen für Away-Person-Einbindung, Template-Kontext und Mobile-Retry-Telemetrie; die Notifications exportieren nun `retry_reschedules`/`retry_successes`, und die Dokumentation verweist auf die neuen Leistungskennzahlen.【F:custom_components/pawcontrol/notifications.py†L489-L514】【F:custom_components/pawcontrol/notifications.py†L1938-L1977】【F:tests/unit/test_notifications.py†L1098-L1333】【F:docs/diagnostik.md†L36-L48】
- Expanded the dashboard pipeline with visitor module cards, typed template imports, and renderer/module guards so Lovelace exports share canonical constants while weather layouts reuse the normalized generator lookups.【F:custom_components/pawcontrol/dashboard_cards.py†L1603-L1655】【F:custom_components/pawcontrol/dashboard_templates.py†L27-L43】【F:custom_components/pawcontrol/dashboard_renderer.py†L22-L116】【F:custom_components/pawcontrol/dashboard_generator.py†L29-L176】
- Bumped the rejection metrics schema to version 3, capturing open/half-open breaker counts and ID lists so coordinator statistics, diagnostics exports, and dashboard markdown stay aligned with the Platinum resilience dashboard expectations.【F:custom_components/pawcontrol/coordinator_tasks.py†L401-L492】【F:custom_components/pawcontrol/diagnostics.py†L120-L144】【F:custom_components/pawcontrol/coordinator_observability.py†L92-L135】【F:tests/unit/test_coordinator_observability.py†L88-L128】【F:tests/components/pawcontrol/test_diagnostics.py†L249-L287】【F:docs/diagnostik.md†L31-L55】
- Documented the visitor dashboard controls and insights in the public README and production handbook so operators understand the autogenerated entities and Markdown summary surfaced by the new card generator.【F:README.md†L417-L440】【F:docs/production_integration_documentation.md†L314-L332】【F:custom_components/pawcontrol/dashboard_cards.py†L1603-L1655】
- Added visitor dashboard regression coverage to assert the module card generator emits the entities card, markdown summary, and graceful markdown fallback when entity validation fails, keeping Lovelace exports stable under refactors.【F:tests/unit/test_dashboard_templates.py†L628-L718】
- Audited notification and shared helper fixtures to replace naive `datetime.now()` usage with timezone-aware UTC timestamps so the quiet-hours patch remains Python 3.13 compliant and automation coverage can rely on consistent payloads.【F:tests/conftest.py†L17-L23】【F:tests/conftest.py†L261-L505】【F:tests/unit/test_notifications.py†L828-L842】【F:tests/unit/test_walk_manager.py†L347-L656】【F:tests/unit/test_feeding_manager.py†L260-L339】【F:tests/unit/test_gps_manager.py†L224-L239】【F:tests/unit/test_data_manager.py†L150-L188】
- Standardised select, sensor, switch, and text platforms on typed module projections, batched entity helpers, and GPS-aware availability checks so runtime dog payloads stay within the `DogConfigData` contract while exposing the new visitor workflows.【F:custom_components/pawcontrol/select.py†L70-L200】【F:custom_components/pawcontrol/sensor.py†L184-L252】【F:custom_components/pawcontrol/switch.py†L219-L320】【F:custom_components/pawcontrol/text.py†L720-L765】
- Typed the number, date, and datetime platforms to route runtime dog payloads through `DogConfigData`/literal module aliases,
  guard coordinator writes with monitored closures, and normalise feeding ratios so strict typing accepts the entity setup while
  daily food comparisons handle missing values gracefully.【F:custom_components/pawcontrol/number.py†L122-L170】【F:custom_compon
ents/pawcontrol/number.py†L515-L704】【F:custom_components/pawcontrol/date.py†L135-L208】【F:custom_components/pawcontrol/date.py†
L349-L422】【F:custom_components/pawcontrol/datetime.py†L49-L116】
- Hardened the discovery manager by cloning requested categories into mutable
  lists for typed scans, filtering gather exceptions before extending results,
  annotating scheduled scan callbacks, and deduplicating devices by identifier
  so registry discovery stays type-safe under mypy while emitting the highest
  confidence snapshot per device.【F:custom_components/pawcontrol/discovery.py†L114-L177】【F:custom_components/pawcontrol/discovery.py†L337-L353】【F:custom_components/pawcontrol/discovery.py†L466-L477】
- Normalised the GPS device tracker by re-validating runtime dog payloads via
  `ensure_dog_config_data`, reusing module projections to gate entity creation,
  and guarding coordinator telemetry updates so route recordings persist as
  typed dictionaries without mutating unknown mappings.【F:custom_components/pawcontrol/device_tracker.py†L84-L159】【F:custom_components/pawcontrol/device_tracker.py†L352-L592】
- Normalised button and binary sensor setup to cast runtime dog payloads through
  `ensure_dog_config_data` and reuse literal field aliases for walk-state and
  visitor metrics so entity creation no longer trips TypedDict key checks while
  maintaining availability guards.【F:custom_components/pawcontrol/button.py†L606-L680】【F:custom_components/pawcontrol/button.py†L1243-L1334】【F:custom_components/pawcontrol/binary_sensor.py†L220-L295】【F:custom_components/pawcontrol/binary_sensor.py†L760-L799】【F:custom_components/pawcontrol/binary_sensor.py†L951-L993】
- Hardened the storage manager and performance monitor by annotating cached store
  loads with concrete mapping types, normalising hydrated history collections with
  dedicated walk and health buffers, and replacing the mutable metrics dictionary
  with a dataclass so diagnostics snapshots emit ISO-formatted timestamps while
  remaining type-safe for future telemetry expansion.【F:custom_components/pawcontrol/helpers.py†L441-L474】【F:custom_components/pawcontrol/helpers.py†L874-L925】【F:custom_components/pawcontrol/helpers.py†L1595-L1742】
- Extended dog literal aliases to cover walk and visitor state plus updated the
  dashboard generator to respect those literals and provide a renderer init
  shim before scheduling tasks, keeping background work typed while we wire in
  `types-aiofiles` stubs for mypy coverage.【F:custom_components/pawcontrol/types.py†L2158-L2175】【F:custom_components/pawcontrol/dashboard_generator.py†L29-L49】【F:custom_components/pawcontrol/dashboard_generator.py†L176-L236】【F:custom_components/pawcontrol/dashboard_generator.py†L668-L752】【F:requirements_test.txt†L1-L7】
- Normalised coordinator diagnostics fallbacks so legacy statistics payloads are
  translated into typed `CoordinatorStatisticsPayload` structures, rejection
  metrics are re-derived for performance summaries, and raw telemetry (including
  API tokens) remains available for redaction, keeping Platinum dashboards and
  docs aligned with the rejection metrics schema.【F:custom_components/pawcontrol/diagnostics.py†L107-L220】【F:custom_components/pawcontrol/diagnostics.py†L845-L920】
- Hardened integration setup by casting service registry checks away from
  unittest mocks, transforming typed dog payloads into manager-friendly
  dictionaries, guarding optional coordinator callables, and refining integer
  coercion for fractional `Real` inputs so strict typing no longer flags the
  setup path—reducing the mypy backlog to 190 errors.【F:custom_components/pawcontrol/__init__.py†L600-L878】【F:custom_components/pawcontrol/validation.py†L132-L195】
- Replaced tuple-based entity caches with typed dataclasses, normalised
  availability/attribute timestamp handling, and widened the sentinel
  coordinator typing so optimized entities reuse strictly typed payloads while
  hass-less registry sentinels continue to satisfy mypy’s requirements.【F:custom_components/pawcontrol/optimized_entity_base.py†L80-L118】【F:custom_components/pawcontrol/optimized_entity_base.py†L567-L908】
- Normalised the platform cache retrieval, coordinator statistics accessors,
  and service execution diagnostics so cached platform tuples stay immutable,
  guard payloads record resilience summaries, and coordinator helpers expose
  structured telemetry, trimming the strict-typing backlog to 200 errors.【F:custom_components/pawcontrol/__init__.py†L320-L386】【F:custom_components/pawcontrol/coordinator.py†L452-L516】【F:custom_components/pawcontrol/services.py†L406-L520】【F:custom_components/pawcontrol/types.py†L1798-L1804】
- Adopted literal field aliases across the base and external config flows plus
  the dashboard step mixin, introducing canonical constants for dog, dashboard,
  and external-entity payloads so TypedDict access stays type-safe while
  reducing config flow mypy violations.【F:custom_components/pawcontrol/config_flow_base.py†L1-L604】【F:custom_components/pawcontrol/config_flow_external.py†L1-L212】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L1-L220】【F:custom_components/pawcontrol/types.py†L2110-L2176】
- Extended those literal aliases to the options flow by introducing dedicated
  constants for GPS settings, dog overrides, and reconfigure telemetry, updating
  `_normalise_options_snapshot` to operate on mutable clones, and routing GPS
  persistence through the new fields so mypy accepts the TypedDict assignments
  while keeping runtime coercion intact.【F:custom_components/pawcontrol/const.py†L129-L199】【F:custom_components/pawcontrol/options_flow.py†L168-L333】【F:custom_components/pawcontrol/options_flow.py†L3088-L3135】
- Tightened the weather module adapter fallback, helper guard diagnostics, and
  coordinator task typing so weather payload caching, guard telemetry exports,
  and module fetch loops operate on literal module names without duplicate
  annotations.【F:custom_components/pawcontrol/module_adapters.py†L560-L625】【F:custom_components/pawcontrol/helper_manager.py†L160-L276】【F:custom_components/pawcontrol/coordinator_runtime.py†L1-L94】【F:custom_components/pawcontrol/types.py†L1438-L1472】
- Normalised walk route telemetry with the new `WalkRoutePoint` typed dict,
  updated cache monitor registration to expose typed snapshot providers without
  reusing configuration buffers for entry IDs, extended repairs metadata with
  timestamp anomaly tracking, and populated coordinator performance metrics via
  explicit guard-field assignments so strict typing accepts the rejection
  telemetry surface.【F:custom_components/pawcontrol/types.py†L1588-L1604】【F:custom_components/pawcontrol/types.py†L2736-L2780】【F:custom_components/pawcontrol/data_manager.py†L904-L935】【F:custom_components/pawcontrol/data_manager.py†L2330-L2349】【F:custom_components/pawcontrol/coordinator_tasks.py†L724-L765】
- Guarded dog configuration merges to only treat stored mappings as mutable
  dictionaries, exported rejection metrics through typed payloads before
  snapshot serialisation, widened module adapter bindings to accept optional
  managers, and provided a writable runtime manager property plus typed module
  access overloads so coordinator consumers stay aligned with the
  `CoordinatorRuntimeManagers` container.【F:custom_components/pawcontrol/data_manager.py†L2424-L2428】【F:custom_components/pawcontrol/coordinator_observability.py†L11-L13】【F:custom_components/pawcontrol/coordinator_observability.py†L122-L131】【F:custom_components/pawcontrol/module_adapters.py†L742-L763】【F:custom_components/pawcontrol/coordinator.py†L69-L75】【F:custom_components/pawcontrol/coordinator.py†L282-L292】【F:custom_components/pawcontrol/coordinator.py†L435-L448】
- Validated the Lovelace statistics view’s resilience metrics markdown with
  integration coverage and refreshed README plus quickstart guidance so the
  packaged Platinum dashboard exposes the rejection counters without manual
  tweaks.【F:tests/components/pawcontrol/test_dashboard_renderer.py†L56-L140】【F:README.md†L753-L780】【F:docs/resilience-quickstart.md†L181-L186】
- Hardened script automation caching, person state tracking, and geofencing/
  weather module payload builders so the mypy backlog drops to 242 errors while
  keeping diagnostics snapshots fully typed.【F:custom_components/pawcontrol/script_manager.py†L86-L220】【F:custom_components/pawcontrol/person_entity_manager.py†L326-L404】【F:custom_components/pawcontrol/module_adapters.py†L348-L654】
- Normalised advanced options, dog configuration door sensor fields, and coordinator empty payload scaffolding to rely on string-literal TypedDict keys, while aligning the circuit breaker error hierarchy with the Home Assistant exception type so strict typing no longer flags the coordinator defaults.【F:custom_components/pawcontrol/types.py†L514-L576】【F:custom_components/pawcontrol/types.py†L2235-L2265】【F:custom_components/pawcontrol/coordinator_support.py†L302-L349】【F:custom_components/pawcontrol/resilience.py†L60-L118】
- Routed coordinator statistics snapshots through the dashboard generator and renderer so the statistics summary now surfaces rejection metrics alongside module counts, with updated diagnostics documentation and targeted regression coverage for the new resilience block.【F:custom_components/pawcontrol/dashboard_generator.py†L120-L226】【F:custom_components/pawcontrol/dashboard_renderer.py†L148-L222】【F:custom_components/pawcontrol/dashboard_templates.py†L1330-L1399】【F:docs/diagnostik.md†L30-L39】【F:tests/unit/test_dashboard_generator.py†L210-L272】【F:tests/unit/test_dashboard_templates.py†L390-L436】
- Captured garden service validation payloads and enforced non-empty validation messages so telemetry records failed confirmations and activities, with regression tests covering the new diagnostics surfaces.【F:custom_components/pawcontrol/services.py†L139-L180】【F:custom_components/pawcontrol/services.py†L3835-L4089】【F:tests/components/pawcontrol/test_services.py†L238-L318】【F:tests/unit/test_services.py†L38-L90】
- Updated the compliance gap analysis and README Platinum callouts to flag strict typing, resilience UI validation, and documentation blockers so reviewers can track outstanding Platinum work alongside the new resilience telemetry.【F:docs/compliance_gap_analysis.md†L16-L43】【F:README.md†L1139-L1150】
- Hardened device removal gating by merging runtime data and options-sourced dogs before allowing cleanup and expanded regression coverage for runtime, options, and foreign-device scenarios.【F:custom_components/pawcontrol/__init__.py†L1485-L1532】【F:tests/components/pawcontrol/test_init.py†L1001-L1118】
- Shared `CONF_DOOR_SENSOR_SETTINGS` across helpers so stored overrides no longer rely on bespoke keys.【F:custom_components/pawcontrol/const.py†L129-L142】
- Normalised door sensor overrides through `_coerce_bool` and companion helpers before persisting them, ensuring reloads retain clamped values without restarting monitors unnecessarily.【F:custom_components/pawcontrol/door_sensor_manager.py†L40-L347】【F:custom_components/pawcontrol/types.py†L1921-L1995】
- Expanded regression coverage to assert alias handling, numeric toggle coercion, persistence, removals, and no-op updates for the door sensor manager workflow.【F:tests/unit/test_door_sensor_manager.py†L23-L310】
- Hardened door sensor initialisation so non-string entity IDs and unsupported override payloads are ignored before normalisation, keeping runtime persistence typed and backed by regression coverage.【F:custom_components/pawcontrol/door_sensor_manager.py†L721-L808】【F:tests/unit/test_door_sensor_manager.py†L292-L339】
- Added a door sensor configuration step to the options flow that normalises overrides via `ensure_door_sensor_settings_config`, persists changes through `PawControlDataManager.async_update_dog_data`, and verifies normal/removal paths with targeted unit tests.【F:custom_components/pawcontrol/options_flow.py†L2105-L2255】【F:tests/unit/test_options_flow.py†L162-L276】
- Re-exported `DEFAULT_CONFIDENCE_THRESHOLD` from the door sensor manager so downstream helpers and tests can import the canonical threshold and dataclass defaults stay aligned with the typed settings model.【F:custom_components/pawcontrol/door_sensor_manager.py†L44-L60】【F:custom_components/pawcontrol/door_sensor_manager.py†L474-L488】
- Captured door sensor persistence failures by logging runtime telemetry, raising repair issues, and surfacing diagnostics plus localized guidance, with regression coverage for the error path and snapshot exports.【F:custom_components/pawcontrol/options_flow.py†L2183-L2259】【F:custom_components/pawcontrol/telemetry.py†L164-L233】【F:custom_components/pawcontrol/repairs.py†L50-L419】【F:custom_components/pawcontrol/diagnostics.py†L137-L150】【F:custom_components/pawcontrol/diagnostics.py†L695-L748】【F:custom_components/pawcontrol/strings.json†L1317-L1320】【F:tests/unit/test_options_flow.py†L1327-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L142-L214】
- Converted module adapter caches to Python 3.13 type-parameter syntax and now accept typed module flag mappings so coordinator tasks no longer funnel through `dict[str, Any]` payload stubs before scheduling adapter fetches.【F:custom_components/pawcontrol/module_adapters.py†L63-L174】【F:custom_components/pawcontrol/module_adapters.py†L794-L814】
- Typed the coordinator payload pipeline end-to-end by introducing `CoordinatorDogData`, defaulting module states to `"unknown"`, and updating runtime helpers to return structured telemetry snapshots instead of loose dictionaries.【F:custom_components/pawcontrol/types.py†L1855-L1902】【F:custom_components/pawcontrol/coordinator_support.py†L46-L330】【F:custom_components/pawcontrol/coordinator_runtime.py†L324-L465】【F:custom_components/pawcontrol/coordinator.py†L150-L357】【F:custom_components/pawcontrol/coordinator_accessors.py†L1-L47】
- Typed the module adapter protocol end-to-end by introducing `ModuleCacheMetrics`, `CoordinatorModuleTask`, and `CoordinatorRuntimeManagers`, updating adapters, runtime fetchers, and diagnostics monitors to operate on structured tasks and cache metrics instead of dictionary shims.【F:custom_components/pawcontrol/types.py†L1296-L1351】【F:custom_components/pawcontrol/module_adapters.py†L777-L876】【F:custom_components/pawcontrol/coordinator_runtime.py†L428-L466】【F:custom_components/pawcontrol/coordinator_support.py†L196-L625】【F:custom_components/pawcontrol/data_manager.py†L376-L450】
- Normalised coordinator data access to return typed module payloads by extending `CoordinatorDataAccessMixin`/`PawControlCoordinator`, wiring runtime manager containers through dedicated accessors, and adding regression coverage for typed versus untyped module fallbacks.【F:custom_components/pawcontrol/coordinator_accessors.py†L1-L83】【F:custom_components/pawcontrol/coordinator.py†L1-L335】【F:tests/unit/test_coordinator_accessors.py†L1-L57】
- Routed entity caches, select/button platforms, and service validators through the shared `CoordinatorRuntimeManagers` container so typed module payloads and persistence helpers no longer depend on direct attribute shims, with regression coverage exercising the new pathways.【F:custom_components/pawcontrol/optimized_entity_base.py†L741-L855】【F:custom_components/pawcontrol/select.py†L433-L504】【F:custom_components/pawcontrol/button.py†L933-L949】【F:custom_components/pawcontrol/services.py†L1149-L1660】【F:custom_components/pawcontrol/types.py†L2292-L2345】【F:tests/components/pawcontrol/test_select_entities.py†L24-L133】【F:tests/unit/test_coordinator.py†L205-L225】
- Extended runtime manager container usage to sensors, numbers, switches, and diagnostics so entity helpers resolve managers through shared accessors without legacy attribute fallbacks, and select helpers/tests reuse the containerised lookup path.【F:custom_components/pawcontrol/entity.py†L1-L160】【F:custom_components/pawcontrol/sensor.py†L904-L925】【F:custom_components/pawcontrol/number.py†L600-L618】【F:custom_components/pawcontrol/switch.py†L500-L553】【F:custom_components/pawcontrol/diagnostics.py†L40-L450】【F:custom_components/pawcontrol/select.py†L424-L446】【F:tests/components/pawcontrol/test_all_platforms.py†L207-L230】【F:tests/unit/test_services.py†L494-L522】
- Routed garden binary sensors, birthdate telemetry, emergency datetime notifications, and custom message text entities through the shared runtime manager container so fallbacks resolve managers even when coordinator attributes are absent, with targeted regression coverage for garden, date/datetime, and notification workflows.【F:custom_components/pawcontrol/binary_sensor.py†L537-L576】【F:custom_components/pawcontrol/date.py†L573-L731】【F:custom_components/pawcontrol/datetime.py†L327-L675】【F:custom_components/pawcontrol/text.py†L287-L724】【F:tests/unit/test_runtime_manager_container_usage.py†L85-L327】
- Added `_async_call_hass_service` to the entity base and wired date, datetime, and text helpers through it so hass-less entities skip service calls cleanly, with new regression coverage exercising the guard behaviour.【F:custom_components/pawcontrol/entity.py†L5-L198】【F:custom_components/pawcontrol/date.py†L573-L731】【F:custom_components/pawcontrol/datetime.py†L327-L675】【F:custom_components/pawcontrol/text.py†L287-L724】【F:tests/unit/test_runtime_manager_container_usage.py†L260-L327】
- Routed visitor mode switches, module feature toggles, and garden confirmation buttons through `_async_call_hass_service` so hass-less contexts short-circuit safely, and expanded runtime manager container tests to assert the new guard paths.【F:custom_components/pawcontrol/switch.py†L578-L806】【F:custom_components/pawcontrol/button.py†L1871-L1908】【F:tests/unit/test_runtime_manager_container_usage.py†L332-L374】
- Centralised Home Assistant service guards via `async_call_hass_service_if_available`, wiring helper creation/removal, notification delivery, entity helpers, and the legacy notification queue through the shared guard so hass-less contexts short-circuit with regression coverage for helper creation and persistent notification acknowledgement.【F:custom_components/pawcontrol/utils.py†L169-L263】【F:custom_components/pawcontrol/entity.py†L170-L194】【F:custom_components/pawcontrol/helper_manager.py†L563-L944】【F:custom_components/pawcontrol/notifications.py†L1460-L1806】【F:custom_components/pawcontrol/helpers.py†L1406-L1477】【F:tests/unit/test_data_manager.py†L333-L365】【F:tests/unit/test_notifications.py†L737-L756】
- Captured guard telemetry for Home Assistant service calls by introducing `ServiceGuardResult`/`ServiceGuardSummary`, a context manager for aggregating guard outcomes, and persistence in `_record_service_result`, with notification and grooming/GPS services recording whether calls executed or skipped and regression coverage validating guard skip metrics.【F:custom_components/pawcontrol/service_guard.py†L1-L46】【F:custom_components/pawcontrol/utils.py†L187-L264】【F:custom_components/pawcontrol/services.py†L384-L473】【F:tests/unit/test_services.py†L741-L780】
- Aggregated helper manager guard metrics into cache diagnostics by tracking every guarded helper service call, exporting `service_guard_metrics`, and covering hass-less creation/removal flows with new regression tests.【F:custom_components/pawcontrol/helper_manager.py†L166-L283】【F:custom_components/pawcontrol/helper_manager.py†L628-L1016】【F:custom_components/pawcontrol/types.py†L1252-L1273】【F:custom_components/pawcontrol/types.py†L1473-L1506】【F:tests/unit/test_data_manager.py†L304-L426】
- Normalised advanced options snapshots through `ensure_advanced_options`, wiring `_normalise_options_snapshot`, `_current_advanced_options`, and `_build_advanced_settings` to reuse the typed helper while regression tests assert legacy payloads coerce correctly.【F:custom_components/pawcontrol/types.py†L455-L551】【F:custom_components/pawcontrol/options_flow.py†L248-L295】【F:custom_components/pawcontrol/options_flow.py†L676-L683】【F:custom_components/pawcontrol/options_flow.py†L1080-L1109】【F:tests/unit/test_options_flow.py†L923-L1061】
- Exported guarded service telemetry through the new `service_execution` diagnostics block, updated the README and diagnostics guide with guard metric locations, and expanded diagnostics regression coverage to assert guard summaries and metadata stay serialisable for support tooling.【F:custom_components/pawcontrol/diagnostics.py†L780-L867】【F:README.md†L722-L741】【F:docs/diagnostik.md†L31-L38】【F:tests/components/pawcontrol/test_diagnostics.py†L129-L203】
- Canonicalised performance mode constants so the select platform, advanced options, and helpers share the `balanced` default while preserving the legacy `standard` alias, with regression tests covering alias normalisation and option alignment.【F:custom_components/pawcontrol/types.py†L456-L509】【F:custom_components/pawcontrol/const.py†L341-L347】【F:custom_components/pawcontrol/select.py†L23-L43】【F:custom_components/pawcontrol/select.py†L763-L779】【F:tests/unit/test_types_performance_mode.py†L1-L35】
- Synced documentation and configuration copy with the balanced performance default by documenting the alias handling in the README, diagnostics guide, and advanced option translations so users see the canonical mode and backwards-compatible `standard` mapping during setup.【F:README.md†L292-L296】【F:docs/diagnostik.md†L43-L48】【F:custom_components/pawcontrol/strings.json†L293-L297】【F:custom_components/pawcontrol/translations/en.json†L296-L303】【F:custom_components/pawcontrol/translations/de.json†L296-L303】

## Error backlog
1. **Diagnostics schema monitoring** – coordinator and diagnostics payloads must keep the version 3 rejection metrics schema (einschließlich `unknown_breaker_ids`) aligned with the evolving Platinum dashboard expectations; continue validating telemetry and docs whenever payloads or UI consumers evolve.【F:custom_components/pawcontrol/coordinator_observability.py†L82-L150】【F:custom_components/pawcontrol/diagnostics.py†L845-L920】【F:docs/diagnostik.md†L24-L55】
2. **Config-flow harness stability** – compat shims and tests ensure exception aliases stay rebound after reloads; with discovery update flows now persisting refreshed metadata, legacy entries without stored unique IDs skipping mismatch guards, redundant reloads guarded, reconfigure merging options/dog_options into the dog list, and identifier alias normalisation preserving legacy names, the remaining focus is hardening migration helpers for complex scenarios.【F:custom_components/pawcontrol/config_flow.py†L292-L464】【F:custom_components/pawcontrol/config_flow.py†L2272-L2290】【F:custom_components/pawcontrol/config_flow.py†L2350-L2715】【F:tests/components/pawcontrol/test_config_flow.py†L333-L800】【F:custom_components/pawcontrol/compat.py†L93-L218】【F:tests/helpers/homeassistant_test_stubs.py†L1852-L1875】
3. **Resilience telemetry follow-up** – continue validating circuit breaker metrics across diagnostics and documentation as dashboard UX evolves, keeping resilience payloads aligned with Platinum reviewer expectations.【F:custom_components/pawcontrol/resilience.py†L200-L312】【F:custom_components/pawcontrol/coordinator_tasks.py†L672-L829】【F:docs/diagnostik.md†L24-L48】

## Improvement opportunities
- Keep Copilot, Claude, and Gemini contributor instructions synchronised whenever workflows (such as door sensor overrides) change so community PRs follow the same Platinum guardrails.【F:.github/copilot-instructions.md†L1-L110】【F:.claude/agents/copilot-instructions.md†L1-L120】【F:.gemini/styleguide.md†L1-L40】
- Beobachte die erweiterten `bool_coercion`-Gründe (`native_*`, `numeric_*`, `truthy_string`, `falsy_string`, `unknown_string`), die neuen Reset-Metriken (`reset_count`, `last_reset`), das ergänzte `last_reason` sowie die zuletzt aufgezeichneten Wert-Details (`last_value_type`/`last_value_repr`), und erweitere bei Bedarf Regressionen, falls zusätzliche Typen oder Resets außerhalb der Tests auftreten.【F:custom_components/pawcontrol/telemetry.py†L29-L198】【F:custom_components/pawcontrol/diagnostics.py†L1033-L1054】【F:tests/unit/test_bool_coercion_telemetry.py†L61-L312】
- Track resilience UI updates so diagnostics, docs, and coordinator observability stay aligned with the latest rejection metrics schema.【F:custom_components/pawcontrol/coordinator_observability.py†L82-L150】【F:docs/diagnostik.md†L24-L48】

## Next sprint priorities
1. **Brand package submission** – Finalise icon assets and upstream the branding PR so README and manifest updates can advertise Platinum status without drift.【F:docs/compliance_gap_analysis.md†L12-L23】
2. **Visitor experience documentation** – Sync README and docs with the new visitor dashboard cards so support teams can reference the updated workflows.【F:custom_components/pawcontrol/dashboard_cards.py†L1603-L1655】
3. **Coverage automation** – Restore automated coverage publication once the Home Assistant harness stabilises so Platinum evidence remains auditable without manual uploads.【F:README.md†L24-L70】【F:docs/compliance_gap_analysis.md†L16-L25】

## Regression coverage highlights
- `tests/unit/test_door_sensor_manager.py` protects alias handling, numeric toggle coercion, persistence through the data manager, removals, and monitoring restarts for the door sensor manager helpers.【F:tests/unit/test_door_sensor_manager.py†L23-L310】
- Config flow and compat tests safeguard the exception rebinding harness so reloads keep using the active Home Assistant exceptions.【F:tests/components/pawcontrol/test_config_flow.py†L40-L120】【F:tests/unit/test_exception_alias_rebinds.py†L1-L184】
- Door sensor persistence failure and diagnostics telemetry are exercised through targeted unit tests to ensure repair issues fire and telemetry surfaces in snapshots.【F:tests/unit/test_options_flow.py†L1327-L1405】【F:tests/components/pawcontrol/test_diagnostics.py†L142-L214】
- Runtime manager container regression tests cover garden binary sensors, birthdate persistence, emergency notifications, custom message routing, and hass-guarded visitor buttons/switches to prevent regressions when hass-free stubs exercise manager fallbacks.【F:tests/unit/test_runtime_manager_container_usage.py†L82-L374】
- Garden service regression tests now assert confirmation and activity failures capture payload telemetry for diagnostics and service statistics.【F:tests/components/pawcontrol/test_services.py†L238-L318】【F:tests/unit/test_services.py†L38-L90】
- Reworked the dashboard statistics markdown card to pull rejection metrics
  through `derive_rejection_metrics`, ensuring Platinum dashboards reuse the
  canonical coordinator schema instead of mutating ad-hoc dictionaries.【F:custom_components/pawcontrol/dashboard_templates.py†L35-L43】【F:custom_components/pawcontrol/dashboard_templates.py†L1364-L1428】
- Standardised text, switch, sensor, and select platforms to hydrate
  `DogConfigData` via literal aliases and typed module coercers, eliminating
  `TypedDict` literal violations while keeping module-aware entity creation and
  option lists aligned with Home Assistant expectations.【F:custom_components/pawcontrol/text.py†L27-L35】【F:custom_components/pawcontrol/text.py†L167-L212】【F:custom_components/pawcontrol/switch.py†L41-L50】【F:custom_components/pawcontrol/switch.py†L218-L312】【F:custom_components/pawcontrol/sensor.py†L185-L233】【F:custom_components/pawcontrol/sensor.py†L720-L817】【F:custom_components/pawcontrol/select.py†L16-L54】【F:custom_components/pawcontrol/select.py†L209-L312】
