# Development plan

## Scribe-Rotation & Wochenprotokolle

### Aktueller Sprint

| Zeitraum | Hauptscribe | Schattenscribe | Monitoring-Fokus | Sync-Nachweis |
| --- | --- | --- | --- | --- |
| <!-- Aktualisieren: KW & Datumsspanne eintragen --> | <!-- Name --> | <!-- Name --> | `scheduled-pytest`, `vendor-pyyaml-monitor`, `typed-dict-audit` | <!-- Link zu `python -m script.sync_contributor_guides` Lauf --> |

### Einsatzhistorie

| Kalenderwoche | Hauptscribe | Schattenscribe | Monitoring-Protokoll | Offene Eskalationen | Contributor-Guide-Sync |
| --- | --- | --- | --- | --- | --- |
| <!-- Beispiel: 2024-KW41 --> | <!-- Name --> | <!-- Name --> | <!-- Link zu Step-Summaries / Notion --> | <!-- Kurzbeschreibung + Issue/PR --> | <!-- Link zum Commit/PR mit Sync-Protokoll --> |

### Scribe-Notizen

- **Dokumentenabgleich:** README, `info.md`, Produktions- und Compliance-Dokumentation sowie Lokalisierungen gegen `docs/markdown_compliance_review.md` spiegeln und Abweichungen mit Fundstelle notieren.
- **Monitoring-Review:** Ergebnisse von `scheduled-pytest`, `vendor-pyyaml-monitor` und dem TypedDict-Audit im CI-Log prüfen; Auffälligkeiten als Eskalation im obigen Protokoll verlinken.
- **Sync-Nachweis:** Nach Text- oder Prozessänderungen `python -m script.sync_contributor_guides` ausführen, Ausgabe im Wochenprotokoll verlinken und bestätigen, dass `docs/production_integration_documentation.md`, `info.md`, README und `INSTALLATION.md` synchronisiert wurden.
- **Runtime-Store-Historie prüfen:** In Update-/Runtime-Statistiken sowie System-Health kontrollieren, dass `runtime_store.history` Statuszähler, Divergenzen und Zeitstempel mitschreibt und mit den Diagnostics-Snapshots übereinstimmt (`tests/unit/test_coordinator_tasks.py`, `tests/components/pawcontrol/test_diagnostics.py`).
- **Runtime-Store-Bewertung verfolgen:** In Diagnostics, System-Health und Koordinator-Statistiken bestätigen, dass `runtime_store_assessment` zwischen `ok`, `watch` und `action_required` wechselt, wenn Divergenzraten, Migrationen oder Future-Versionen auftreten, und dabei das vorherige Level, Streak-Zähler, Level-Dauern (`level_durations`), letzte Level-Änderung, Eskalations-/Deeskalationszahlen sowie `current_level_duration_seconds` korrekt pflegt (`tests/unit/test_runtime_store_telemetry.py`, `tests/components/pawcontrol/test_system_health.py`, `tests/components/pawcontrol/test_diagnostics.py`).
- **Artefakt-Log:** Wöchentliche Links zu CI-Läufen, Sync-Skripten und Monitoring-Notizen im Artefakt-Log des Scribe-Playbooks hinterlegen, damit Übergaben sämtliche Referenzen enthalten.
- **Vorbereitung Übergabe:** Für den folgenden Sprint offene Eskalationen, Monitoring-Erkenntnisse sowie ausstehende Dokumentationsaufgaben im Abschnitt „Monitoring & nächste Schritte“ aktualisieren und die Schattenrolle schriftlich einweisen.

Weitere Checklisten, Eskalationspfade und Vorlagen pflegt das Team im [Scribe-Playbook](docs/scribe_playbook.md).

## Aktueller Baustellenüberblick

### Priorisierte Maßnahmen (0–3 Monate)

| Priorität | Thema | Status | Auswirkungen | Nächste Schritte | Referenzen |
| --- | --- | --- | --- | --- | --- |
| Blocker | Vendortes PyYAML 6.0.3 & Dependency-Sync entkoppeln `script.hassfest` vom globalen Interpreter | **Monitoring:** `vendor-pyyaml-monitor.yml` protokolliert wöchentlich PyPI-/OSV-Daten, `script.sync_homeassistant_dependencies` zieht manifestierte Anforderungen sowie das Vendoring automatisch auf den Stand des Home-Assistant-Repos | Qualitäts-Gate kann wieder lokal laufen, weil der Fallback-Loader automatisch auf die bundelte Bibliothek zurückfällt, `sitecustomize.py` den Vendor-Pfad vor dem ersten Import ins `sys.path` aufnimmt und Requirements/Testanforderungen jetzt exakt den Home-Assistant-Constraints folgen | Vendor-Verzeichnis (`annotatedyaml/_vendor/yaml`) nach jedem Sync-Lauf prüfen, Lizenzdatei pflegen, `python -m script.sync_homeassistant_dependencies --home-assistant-root /path/zum/core` regelmäßig ausführen und anschließend `python -m script.hassfest --integration-path custom_components/pawcontrol --skip-logo-check` validieren; Entfernung vorbereiten, sobald Home Assistant den offiziellen Build liefert | `annotatedyaml/_vendor/yaml/__init__.py`, `annotatedyaml/loader.py`, `sitecustomize.py`, `script/sync_homeassistant_dependencies.py`, `script/hassfest/__main__.py`, `.github/workflows/reusable-marketplace-validation.yml`, `tests/tooling/test_sync_homeassistant_dependencies.py`, `tests/unit/test_annotatedyaml_fallback.py` |
| Hoch | Feeding-Manager-Tests blockieren strenge mypy-Läufe | **Grün:** Async-Tests tragen vollständige TypedDict-Annotationen, `mypy`-Guard wieder grün | `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/feeding_manager.py tests/unit/test_feeding_manager.py` läuft nun ohne Beanstandungen und bestätigt die getypten Fixtures | Neue Tests sofort mit `FeedingManagerDogSetupPayload` & Co. typisieren, Casts auf `FeedingComplianceCompleted` bei zusätzlichen Statusvarianten prüfen, `typed_deepcopy` für Setup-Payloads nutzen | `tests/unit/test_feeding_manager.py†L36-L421`, `tests/unit/test_feeding_manager.py†L428-L640`, `tests/unit/test_feeding_manager.py†L642-L785`, `tests/helpers/payloads.py†L1-L12`, `tests/helpers/__init__.py†L1-L11`, `tests/unit/test_helpers_payloads.py†L1-L33` |
| Hoch | Legacy-GPS- & Service-Tests blockierten strenge mypy-Läufe | **Grün:** GPS- und Service-Suites nutzen getypte Fixtures, Rückgaben und Event-Casts | `mypy --config-file pyproject.toml --follow-imports=skip tests/unit/test_gps_manager.py tests/unit/test_services.py` läuft nun ohne Beanstandungen und bestätigt die neuen TypedDict-Stubs sowie `FeedingComplianceEventPayload`-Casts | Fixtures konsequent mit `GPSTrackingConfigInput`, `_HealthSnackCall` und `_ComplianceNotificationCall` weiterführen; neue Telemetrie-Events direkt auf `FeedingComplianceEventPayload` casten und Notification-Stubs bei zusätzlichen Feldern ergänzen | `tests/unit/test_gps_manager.py†L35-L132`, `tests/unit/test_services.py†L370-L412`, `tests/unit/test_services.py†L606-L673`, `tests/unit/test_services.py†L1912-L2173` |
| Mittel | TypedDict-Audit wieder sauber | **Grün:** Audit-Skript läuft ohne Beanstandung | `python script/check_typed_dicts.py` läuft aktuell ohne Beanstandungen; Audit als Monitoring-Task behalten | Skript weiterhin vor größeren Refactors laufen lassen, neue `TypedDict`-Aliase direkt im Modul dokumentieren, Tests erweitern und den CI-Job „TypedDict audit“ aus `ci.yml` im Blick behalten. Der Guard installiert jetzt die Projektanforderungen aus dem Pip-Cache und schreibt bei Erfolg eine Zusammenfassung ins Step-Summary, damit lokale und CI-Läufe konsistent bleiben und fehlgeschlagene Pipelines sofort nachgezogen werden. | `script/check_typed_dicts.py†L1-L187`, `custom_components/pawcontrol/types.py†L1-L6332`, `.github/workflows/ci.yml†L1-L120` |
| Mittel | Text-Entity-Regression absichern | **Grün:** Text-Snapshots persistieren über Runtime- und Coordinator-Caches, Setup registriert sämtliche `DogTextSnapshot`-Felder inklusive GPS-Ortsbeschreibung und `DOG_TEXT_METADATA_FIELD` hält nun `last_updated`-Zeitstempel samt Context-IDs für jede Text-Entity fest | `_build_metadata_entry` stempelt Kontextinformationen, `async_set_value` synchronisiert Werte und `last_updated_*`-Attribute in Datenmanager, RuntimeStore und Koordinator und `async_added_to_hass` importiert fehlende Metadaten inklusive Context-IDs aus Restore-States, bevor diese in allen Caches persistiert werden; die Suite deckt Persistenz, Kontext-Propagation, Löschpfade und GPS-Registrierungen ab | Neue Texttypen sofort in `DogTextSnapshot` & `DogTextMetadataEntry` aufnehmen, UI-/E2E-Flows bei erweiterten Dialogen nachziehen (`custom_components/pawcontrol/config_flow_modules.py`, `tests/components/pawcontrol/test_data_manager.py`); zusätzliche GPS-/Health-Texte in zukünftigen Modulerweiterungen direkt hinterlegen | `custom_components/pawcontrol/types.py†L158-L223`, `custom_components/pawcontrol/types.py†L5444-L5508`, `custom_components/pawcontrol/text.py†L302-L720`, `tests/components/pawcontrol/test_text_entities.py†L320-L705` |
| Mittel | Fixture-/Wrapper-Watcher decken neue Companion-/Voice-Fixtures nicht ab | **Grün:** Prefix-basierte Guards melden neue Companion-/Voice-Familien automatisch und die Session-Doubles emulieren HTTP- sowie Websocket-Helfer | Neue Companion-/Voice-Funktionen werden sofort durch Guardrails und Tests erfasst; direkte ClientSession-Bypässe landen nicht mehr unentdeckt | Prefix-Watchlist bei neuen Fixture-Familien prüfen, Tests für weitere Loader-/Resolver-Ketten ergänzen | `scripts/shared_session_guard_roots.toml`, `tests/conftest.py`, `tests/unit/test_fixture_usage_guard.py` |
| Mittel | Contributor-Guides & Dokumentationsspiegel lückenlos synchronisieren | **Offen:** Artefakt-Logs enthalten noch Lücken bei Sync-Nachweisen; Scribe-Tabellen verweisen auf ausstehende Spiegelungen | Divergierende README/Info-Daten riskieren Platinum-Abnahmen und lassen Claude/Gemini-Anleitungen auseinanderlaufen | Nach jedem inhaltlichen Update `python -m script.sync_contributor_guides` ausführen, Markdown-Checkliste (`docs/markdown_compliance_review.md`) abarbeiten und Links zum Sync-Lauf im Scribe-Board hinterlegen | `.github/copilot-instructions.md†L29-L53`, `script/sync_contributor_guides.py†L1-L92`, `docs/markdown_compliance_review.md†L1-L60`, `README.md†L31-L53`, `info.md†L101-L114` |
| Mittel | DomainRuntimeStore mit Versionskennzeichnung und Legacy-Kompatibilität | **Grün:** UI-/E2E-Regressionen sichern Cache-Löschungen, Versions-Upgrades und die neue `runtime_store`-Diagnose ab | Der Domain-Store stempelt nun Erstell- und Laufzeitversionen, hebt Altversionen auf das Minimal-Schema an, markiert Future-Snapshots sofort als inkompatibel und stellt in Diagnostics/System-Health einen Kompatibilitäts-Snapshot bereit, der Migrationen und Divergenzen sichtbar macht | Neue Integrationsszenarien validieren, dass Options- und Repair-Flows gelöschte Runtime-Caches sofort rekonstruieren, Legacy-Einträge auf die aktuelle `CURRENT_VERSION` heben und die `runtime_store`-Snapshots nach Flow-Änderungen aktuell bleiben; zusätzlich `build_update_statistics`/`build_runtime_statistics` und System-Health darauf prüfen, dass `runtime_store.history` Statuszähler, Divergenzen, Zeitstempel **und** Trendmetriken (`previous_level`, Level-Streak, Eskalations-/Deeskalationszähler, letzte Level-Änderung) sowie Level-Dauerfelder (`level_durations`, `current_level_duration_seconds`) mitschreibt, mit Diagnostics übereinstimmt und dass `runtime_store_assessment` Divergenzen, Migrationen und Future-Versionen korrekt auf `ok`/`watch`/`action_required` eskaliert | `custom_components/pawcontrol/runtime_data.py`, `custom_components/pawcontrol/telemetry.py`, `custom_components/pawcontrol/coordinator_tasks.py`, `custom_components/pawcontrol/diagnostics.py`, `custom_components/pawcontrol/system_health.py`, `custom_components/pawcontrol/options_flow.py`, `custom_components/pawcontrol/repairs.py`, `tests/test_runtime_data.py`, `tests/unit/test_runtime_store_telemetry.py`, `tests/unit/test_coordinator_tasks.py`, `tests/components/pawcontrol/test_diagnostics.py`, `tests/components/pawcontrol/test_system_health.py`, `tests/unit/test_options_flow.py`, `tests/test_repairs.py`, `tests/integration/test_runtime_store_ui.py†L1-L276` |
| Mittel | EntityFactory-Laufzeitwächter glättet Scheduler-Jitter automatisch | **Grün:** Adaptiver Guard hebt die Mindestlaufzeit bei Preemption an, reduziert sie bei stabilen Messungen und protokolliert Bodenzeit-Delta, Peak-/Minimal-Floor, letzte Bodenzeitänderung (absolut & relativ), Durchschnitts-/Min-/Max-Laufzeiten sowie Stabilitäts-, Volatilitäts- und Jitter-Kennzahlen für Trendanalysen | `_recalibrate_runtime_floor` berechnet eine dynamische Baseline aus den beobachteten Latenzen, begrenzt den Guard nach oben und persistiert jede Kalibrierung im Runtime-Store inklusive aggregierter Stichprobendauern, Guard-Event-Historie, Streak-Zählern und Fünf-Sample-Recency-Werten samt Stabilitätstrend | Weiterhin `PAWCONTROL_ENABLE_ENTITY_FACTORY_BENCHMARKS=1` für Stressläufe nutzen, Guard-Metriken (Delta, Peak/Min-Floor, Änderungsratio, Stabilitäts-/Volatilitätsquote, Jitter) in den Performance-Protokollen dokumentieren und Regressionen mit `tests/components/pawcontrol/test_entity_performance_scaling.py` nachstellen | `custom_components/pawcontrol/entity_factory.py†L35-L115`, `custom_components/pawcontrol/entity_factory.py†L1009-L1136`, `custom_components/pawcontrol/telemetry.py†L101-L244`, `tests/test_entity_factory_guardrails.py†L520-L640`, `tests/components/pawcontrol/test_diagnostics.py†L540-L612`, `tests/components/pawcontrol/test_system_health.py†L18-L663` |

### Fehler-Backlog

- [ ] **Dokumentationsspiegel komplettieren:** Fehlende Sync-Nachweise in der Einsatzhistorie und divergierende README-/Info-Abschnitte verhindern eine lückenlose Platinum-Dokumentation; nach jedem Content-Update den Contributor-Guide-Sync fahren, die Markdown-Review-Checkliste abhaken und Links zu den Läufen im Wochenprotokoll nachtragen.【F:.github/copilot-instructions.md†L29-L53】【F:script/sync_contributor_guides.py†L1-L92】【F:docs/markdown_compliance_review.md†L1-L60】
  - Verantwortliche Scribes protokollieren jeden Sync-Lauf inklusive Commit-Hash und Step-Summary, damit die Einsatzhistorie rekonstruierbar bleibt (`python -m script.sync_contributor_guides`).
  - README, `info.md`, Produktions- und Compliance-Dokumentation direkt nach dem Sync mit der Markdown-Checkliste spiegeln und Abweichungen mit Fundstellen im Artefakt-Log dokumentieren.【F:README.md†L31-L53】【F:info.md†L101-L114】【F:docs/production_integration_documentation.md†L636-L669】
  - Fehlende Belege werden als Eskalation im Wochenprotokoll verlinkt, bis sowohl die Markdown-Checkliste als auch der Sync-Lauf mit Evidenz hinterlegt sind.
- [ ] **Quality-Gate-Vollsuiten terminieren:** Die reservierten `scheduled-pytest`-Slots und der CI-`TypedDict audit` benötigen eine verantwortliche Rotation, die Laufprotokolle sammelt, Findings dokumentiert und Regressionen sofort mit `pytest -q`, `mypy` und `ruff check` adressiert.【F:.github/workflows/scheduled-pytest.yml†L1-L55】【F:.github/workflows/ci.yml†L1-L67】【F:.github/copilot-instructions.md†L31-L53】
  - Vor jedem Slot Ownership bestätigen, Step-Summaries sichern und Regressionen mit lokalen Gegenläufen (`pytest -q`, `mypy`, `ruff check`) inklusive Artefakt-Links schließen.
  - TypedDict-Funde direkt im Audit-Issue katalogisieren, erforderliche Type-Aliasse in `custom_components/pawcontrol/types.py` ergänzen und `python script/check_typed_dicts.py` erneut ausführen, bis der Guard sauber ist.【F:script/check_typed_dicts.py†L1-L187】【F:custom_components/pawcontrol/types.py†L1-L6332】
  - Ergebnisse und Eskalationen im Wochenprotokoll referenzieren, damit Rotation und Nachverfolgung transparent bleiben.
- [x] **Fixture-/Guard-Watchlist erweitern:** Prefix-basierte Regeln decken nun alle Companion-/Voice-Fixtures automatisch ab, und die Session-Doubles simulieren HTTP- wie Websocket-Helfer inklusive Body-Zugriff, sodass neue Funktionen nicht mehr am Guard vorbeikommen.【F:scripts/shared_session_guard_roots.toml†L1-L11】【F:tests/conftest.py†L182-L236】【F:tests/unit/test_fixture_usage_guard.py†L1-L120】【F:tests/unit/test_fixture_usage_guard.py†L243-L278】【F:tests/unit/test_fixture_usage_guard.py†L349-L374】
  - Neue Fixtures unmittelbar in `tests/conftest.py` dokumentieren und die Guard-Liste (`BLOCKED_CONTEXT_MANAGERS`, `ALLOWED_FIXTURE_PREFIXES`) aktualisieren, damit der CI-Checker den Pfad überwacht.
  - `PYTHONPATH=. pytest tests/unit/test_fixture_usage_guard.py -q` lokal laufen lassen und bei Fehlermeldungen die betroffenen Fixtures mit Telemetrie versehen, bevor sie gemergt werden.
  - Step-Summaries der Guard-Skripte im Artefakt-Log sichern, damit Companion-/Voice-Erweiterungen historisiert bleiben.
- [x] **PyTest-Gesamtlauf reaktivieren:** Der Workflow [`scheduled-pytest.yml`](.github/workflows/scheduled-pytest.yml) reserviert dienstags und freitags um 03:00 UTC einen exklusiven Slot für `pytest -q`, lädt Coverage-/JUnit-Artefakte hoch, verhindert Codecov-Uploads und verlangt bei manuellen Dispatches `override_ci_window=true` samt dokumentiertem Grund. README, `info.md` und die Produktionsdoku erläutern das koordinierte Zeitfenster und die erforderliche Abstimmung für Sonderläufe.【F:.github/workflows/scheduled-pytest.yml†L1-L52】【F:README.md†L40-L90】【F:info.md†L69-L101】【F:docs/production_integration_documentation.md†L636-L668】
- [x] **Vendor-PyYAML überwachen:** Der Workflow [`vendor-pyyaml-monitor.yml`](.github/workflows/vendor-pyyaml-monitor.yml)
      ruft wöchentlich `python -m script.check_vendor_pyyaml` auf, vergleicht die
      gebündelte Version mit PyPI- und OSV-Daten und meldet neue Releases oder
      Advisories direkt im Step-Summary. README, `info.md` und die
      Produktionsdoku dokumentieren den Guard samt lokalem Aufruf, der nun
      automatisch `cp313`-`manylinux`- sowie `cp313`-`musllinux`-Wheels (PEP 656)
      trackt und `generated/vendor_pyyaml_status.json` mit Download-Links
      aktualisiert, sodass das Team das Vendor-Verzeichnis aktualisieren oder
      entfernen kann, sobald passende Wheels verfügbar sind.【F:.github/workflows/vendor-pyyaml-monitor.yml†L1-L44】【F:script/check_vendor_pyyaml.py†L1-L360】【F:generated/vendor_pyyaml_status.json†L1-L20】【F:README.md†L46-L88】【F:info.md†L97-L108】【F:docs/production_integration_documentation.md†L644-L659】
- [x] **Home-Assistant-Abhängigkeiten synchronisieren:** `python -m script.sync_homeassistant_dependencies` liest Requirements,
      Package-Constraints und PyPI-Metadaten aus dem Core-Repo, aktualisiert
      `requirements*.txt`, Manifest-Anforderungen sowie das vendorte PyYAML auf
      Version 6.0.3 und regeneriert die Status-JSON mitsamt Wheel-Links. Die
      begleitende Testsuite deckt Manifest-/Requirements-Updates, Lizenzkopien
      und die JSON-Ausgabe ab.【F:script/sync_homeassistant_dependencies.py†L1-L478】【F:requirements.txt†L1-L4】【F:requirements_test.txt†L1-L10】【F:custom_components/pawcontrol/manifest.json†L1-L64】【F:generated/vendor_pyyaml_status.json†L1-L20】【F:tests/tooling/test_sync_homeassistant_dependencies.py†L1-L132】
- [x] **Config-Flow-Module-Flags normalisieren:** Der Hundemodul-Schritt akzeptiert wieder sowohl Flow-Flags (`enable_*`) als auch gespeicherte Modulzuweisungen, indem die Eingaben mit `dog_modules_from_flow_input` und `coerce_dog_modules_config` normalisiert werden. Die Suite `tests/components/pawcontrol/test_config_flow.py` bestätigt die Regression und bleibt dank `MODULE_TOGGLE_FLAG_BY_KEY` kompatibel zu zukünftigen Modulerweiterungen.【F:custom_components/pawcontrol/config_flow.py†L1406-L1449】【F:tests/components/pawcontrol/test_config_flow.py†L95-L172】
- [x] **Feeding-Manager-mypy reparieren:** `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/feeding_manager.py tests/unit/test_feeding_manager.py` läuft wieder fehlerfrei; sämtliche Async-Tests besitzen nun `-> None`-Signaturen, Fixture-Parameter nutzen die passenden TypedDict-Aliase und Compliance-Prüfungen casten explizit auf `FeedingComplianceCompleted`.【F:tests/unit/test_feeding_manager.py†L36-L421】【F:tests/unit/test_feeding_manager.py†L428-L640】【38df09†L1-L1】
- [x] **Runtime-Store-E2E ergänzen:** Neue Integrationsszenarien für Options- und Repair-Flows belegen, dass gelöschte `hass.data`-Caches sofort über `DomainRuntimeStoreEntry.ensure_current()` wiederhergestellt werden.【F:custom_components/pawcontrol/runtime_data.py†L1-L412】【F:custom_components/pawcontrol/options_flow.py†L248-L1109】【F:custom_components/pawcontrol/repairs.py†L1-L210】【F:tests/integration/test_runtime_store_ui.py†L1-L276】
- [x] **Ruff-Konfiguration korrigieren:** `pyproject.toml` definiert jetzt ein vollständiges `[project]`-Kapitel inklusive `name`, `dynamic` und `requires-python` und erzwingt Ausschlüsse, sodass `ruff check custom_components/pawcontrol tests --force-exclude` ohne Parse-Fehler läuft und die Home-Assistant-Python-Vorgaben eingehalten werden.【F:pyproject.toml†L1-L76】
- [x] **Config-Flow-Testharness & Helper-Services typisieren:** Der Modul-Flow-Harness persistiert Formularzustände jetzt als `ConfigFlowResult` samt `FlowResultType`, und der Helper-Manager protokolliert Service-Aufrufe über `ServiceData` und ein getyptes Target-Payload, wodurch beide Suites ohne `dict[str, Any]`-Fallbacks laufen.【F:tests/unit/test_config_flow_modules.py†L198-L251】【F:tests/integration/test_config_flow.py†L12-L44】【F:tests/unit/test_helper_manager_services.py†L5-L83】

### Verbesserungs-Backlog (detailliert)

#### Tooling & Infrastruktur
 - **CI-Workflows modularisieren:** `ci.yml` ruft `reusable-pre-commit.yml` sowie `reusable-python-tests.yml` auf, extrahiert die Coverage-Ergebnisse als Job-Outputs und stellt sie nachgelagerten Kommentaren sowie GitHub-Pages-Veröffentlichungen zur Verfügung. Die Jobs ziehen Python-, Home-Assistant- und Coverage-Schwellenwerte aus Repository-Variablen (`vars.PYTHON_VERSION`, `vars.HA_VERSION`, `vars.CI_COVERAGE_MIN`) und nutzen konsistente Pip-Caches über `cache-dependency-path`. `pre-commit.yaml` läuft wöchentlich sowie bei manuellen Dispatches, während `release.yml` denselben Reusable-Testlauf für tagbasierte Veröffentlichungen anstößt.【F:.github/workflows/ci.yml†L1-L118】【F:.github/workflows/pre-commit.yaml†L1-L16】【F:.github/workflows/release.yml†L1-L154】【F:.github/workflows/reusable-pre-commit.yml†L1-L37】【F:.github/workflows/reusable-python-tests.yml†L1-L176】
 - **Marketplace-Validierung zentralisieren:** `reusable-marketplace-validation.yml` kapselt Hassfest- und HACS-Läufe inklusive optionalem Checkout-Ref, sodass `ci.yml`, `hassfest.yml` und `release.yml` denselben Baustein wiederverwenden und nur noch Kategorie/Ignorier-Liste übergeben müssen. Dadurch entfällt der redundante Setup-Code in allen Pipelines und Versionstag-Builds warten automatisch auf Marketplace-Ergebnisse, bevor Artefakte gepackt werden.【F:.github/workflows/reusable-marketplace-validation.yml†L1-L40】【F:.github/workflows/ci.yml†L118-L134】【F:.github/workflows/hassfest.yml†L1-L24】【F:.github/workflows/release.yml†L88-L123】
 - **Coverage-Feedback automatisieren:** `reusable-python-tests.yml` schreibt `coverage.xml` in das Artefakt, setzt den Prozentwert als Workflow-Output und lädt HTML plus XML gebündelt hoch. `coverage-comment` veröffentlicht den Wert automatisiert auf Pull Requests, und `coverage-pages` deployt nach Pushes auf `main` den HTML-Bericht via `script.publish_coverage` inklusive Aufräumen veralteter Läufe.【F:.github/workflows/reusable-python-tests.yml†L94-L162】【F:.github/workflows/ci.yml†L60-L155】
 - **Docs-Drift sichtbar machen:** Der Job `docs-diff-comment` fasst Änderungen an `docs/`, `dev.md`, `info.md`, `README.md`, `INSTALLATION.md` und den Lokalisierungen zusammen und aktualisiert einen PR-Kommentar mit dem Hinweis auf `python -m script.sync_contributor_guides`, damit Reviewer Text- und Übersetzungsarbeit sofort erkennen.【F:.github/workflows/ci.yml†L156-L215】
 - **Aggregator vereinfacht:** Der Sammel-Job `all-checks` wertet jetzt ausschließlich `needs.*.result` aus, protokolliert die Ergebnisse komprimiert und bricht automatisch ab, sobald ein abhängiger Job fehlschlägt, abgebrochen oder übersprungen wurde. Damit entfällt das frühere Shell-Skript mit manueller Fehlerliste.【F:.github/workflows/ci.yml†L216-L238】
 - **HA-Smoketest erweitern:** `ha-smoke-install.yaml` installiert Home Assistant in der per Repository-Variable definierten Version, setzt die Integration via `pip install -e .` auf und führt anschließend `hass --script check_config` gegen eine minimale Konfiguration aus, um Paketierungsfehler frühzeitig aufzudecken.【F:.github/workflows/ha-smoke-install.yaml†L1-L54】
 - **Ruff-Baseline absichern:** Der manuelle Ruff-Baseline-Workflow akzeptiert nur noch Accounts aus `vars.RUFF_BASELINE_ALLOWLIST` oder den Repository-Owner und respektiert ebenfalls die Python-Vorgabe aus `vars.PYTHON_VERSION`, sodass unbeaufsichtigte Fix-PRs vermieden werden.【F:.github/workflows/ruff-baseline.yml†L1-L24】
- [x] **Fixture-, Helper- und Text-Pfade vollständig typisiert:** End-to-End- und Plattform-Regressionen nutzen jetzt `ConfigEntryDataPayload`, `DogConfigData` und koordinatorspezifische JSON-Mappings, während gemeinsame Fixtures und das asyncio-Plugin konsequent die Integrationstypen exponieren; Text-Entities persistieren Werte über `JSONMutableMapping`, `DogTextSnapshot` und `DogTextMetadataSnapshot`. Damit laufen sämtliche Tests ohne `dict[str, Any]`-Fallbacks und der TypedDict-Audit bleibt dauerhaft leer.【F:tests/e2e/test_nightly_full_integration.py†L101-L133】【F:tests/components/pawcontrol/test_all_platforms.py†L55-L83】【F:tests/conftest.py†L63-L123】【F:tests/plugins/asyncio_stub.py†L1-L118】【F:custom_components/pawcontrol/text.py†L302-L418】
- **Vendor-Kette aktualisieren:** Das Repository bundelt jetzt PyYAML 6.0 unter `annotatedyaml/_vendor/yaml`. Paket auf Sicherheitsmeldungen und Upstream-Releases beobachten, `python -m script.hassfest --integration-path custom_components/pawcontrol` regelmäßig laufen lassen und den Vendor-Pfad entfernen, sobald Home Assistant wieder ein offizielles Wheel bereitstellt.
- **Test-Abhängigkeitsprüfer aktualisieren:** Die Allowlist von `python -m script.enforce_test_requirements` erkennt `annotatedyaml` jetzt als lokale Vendor-Bibliothek, sodass Regressionstests für die Loader-Einträge nicht länger fälschlich zusätzliche PyPI-Abhängigkeiten verlangen. Beim Hinzufügen weiterer Vendor-Module die Allowlist entsprechend erweitern.【F:script/enforce_test_requirements.py†L77-L108】
- **Wächter ausbauen:** `FixtureGuard` und Wrapper-Watcher für Companion-, Voice- und Supervisor-Fixtures regelmäßig pflegen, damit neue Pfade automatisch erkannt werden (`script/enforce_shared_session_guard.py`, `tests/hassfest/`). Die aktuellen Guards prüfen bereits `contextlib.aclosing` und `AsyncExitStack.push_async_exit`, sodass asynchrone Kontextmanager verbotene Fixtures nicht mehr weiterreichen.【F:tests/unit/test_fixture_usage_guard.py†L3683-L3764】
 - **Regelmäßige Vollsuiten:** Quartalsweise Komplettläufe (`pytest -q`, `mypy`, `python script/check_typed_dicts.py`) einplanen und Ergebnisse im Repository dokumentieren.

#### Dokumentation & Scribes
 - [x] **Aufgabenportfolio definieren:** Das rotierende Scribe-Team übernimmt drei Pflichtpfade pro Woche – (1) Monitoring-Protokolle für `scheduled-pytest`, `vendor-pyyaml-monitor` und den TypedDict-Audit prüfen, (2) Änderungen an README, `info.md`, Compliance-/Produktionsdokumentation sowie Lokalisierungen zusammenfassen und gegen die Leitlinien aus `docs/markdown_compliance_review.md` spiegeln und (3) Abweichungen sofort in `CHANGELOG.md` bzw. `docs/compliance_gap_analysis.md` notieren. Der Abschnitt „Scribe-Notizen“ oben dokumentiert die Ergebnisse strukturiert.【F:.github/workflows/scheduled-pytest.yml†L1-L52】【F:.github/workflows/vendor-pyyaml-monitor.yml†L1-L44】【F:.github/workflows/ci.yml†L156-L238】【F:docs/markdown_compliance_review.md†L1-L66】【F:docs/compliance_gap_analysis.md†L1-L80】
 - [x] **Scribe-Rotation etablieren:** Der neue Kopfbereich von `dev.md` enthält das Sprint-Board, die Einsatzhistorie sowie die Pflichtfelder für Monitoring und Eskalationen. Haupt- und Schattenscribe aktualisieren die Tabelle pro Kalenderwoche und verlinken relevante Logs oder Tickets direkt neben den Aufgaben.【F:dev.md†L1-L60】
 - [x] **Abnahme-Checkliste pflegen:** Die Scribe-Notizen fordern den dokumentierten Lauf von `python -m script.sync_contributor_guides`, prüfen `docs/production_integration_documentation.md`, `info.md`, README und `INSTALLATION.md` und verlangen Links zu Pull Requests beziehungsweise Commits innerhalb des Wochenprotokolls.【F:dev.md†L23-L44】【F:script/sync_contributor_guides.py†L1-L121】【F:docs/production_integration_documentation.md†L605-L669】【F:info.md†L69-L140】【F:README.md†L24-L140】【F:INSTALLATION.md†L1-L214】
- [x] **Onboarding-Playbook erweitern:** Das neue Living-Document [`docs/scribe_playbook.md`](docs/scribe_playbook.md) bündelt Rollenbeschreibung, Übergabe-Checklisten, Monitoring-Vorlagen und Kommunikationspfade, sodass das Team keine separaten Notizzettel mehr pflegen muss.【F:docs/scribe_playbook.md†L1-L212】
- [x] **Artefakt-Archiv etablieren:** Das Playbook bietet jetzt ein Sprint-Artefakt-Log, in dem Haupt- und Schattenscribe Links zu Monitoring-Läufen, Sync-Skripten und Wochenzusammenfassungen bündeln.【F:docs/scribe_playbook.md†L74-L90】
- [ ] **Anleitungsspiegel aktuell halten:** Nach jeder Änderung an `.github/copilot-instructions.md` konsequent `python -m script.sync_contributor_guides` laufen lassen und den Sync-Status im PR verlinken, damit die Claude- und Gemini-Handbücher automatisch auf demselben Stand bleiben.【F:.github/copilot-instructions.md†L1-L160】【F:script/sync_contributor_guides.py†L1-L92】

#### Typisierung & Tests
- **mypy-Guard pflegen:** GPS-, Service- und Feeding-Manager-Suites laufen inzwischen strikt typisiert; neue Tests sofort mit `FeedingManagerDogSetupPayload`, `GPSTrackingConfigInput`, `_HealthSnackCall` und `_ComplianceNotificationCall` annotieren und Casts auf `FeedingComplianceEventPayload` beziehungsweise `FeedingComplianceCompleted` ergänzen, sobald weitere Statusvarianten auftauchen.【F:tests/unit/test_feeding_manager.py†L36-L421】【F:tests/unit/test_feeding_manager.py†L428-L640】【F:tests/unit/test_feeding_manager.py†L642-L785】【F:tests/unit/test_gps_manager.py†L35-L132】【F:tests/unit/test_services.py†L370-L412】【F:tests/unit/test_services.py†L606-L673】【F:tests/unit/test_services.py†L1912-L2173】
- **Text-Entity-Regressionen:** `DogTextSnapshot` und `DogTextMetadataEntry` halten Werte, `last_updated`-Zeitstempel und Context-IDs im RuntimeStore, `async_set_value` synchronisiert Datenmanager, Koordinator und RestoreCache inklusive der neuen `last_updated_*`-Attribute und entfernt bereinigte Leerwerte aus allen Caches; `async_added_to_hass` registriert Microchip-, Versicherungs-, Trainings- sowie GPS-Ortsbeschreibungstexte, importiert Context-IDs aus Restore-States und migriert fehlende Metadaten mit Zeitstempeln konsistent in alle Caches. Die Suite `tests/components/pawcontrol/test_text_entities.py` prüft Persistenz, Kontext-Propagation, Restore-Rehydration, Deduplizierung, Snapshot-Löschpfade sowie GPS-spezifische Registrierungen; UI-Flows bei Bedarf erweitern.【F:custom_components/pawcontrol/types.py†L158-L223】【F:custom_components/pawcontrol/types.py†L5444-L5508】【F:custom_components/pawcontrol/text.py†L302-L720】【F:tests/components/pawcontrol/test_text_entities.py†L320-L705】
- **Feeding-Suiten typisieren:** Async-Tests des Feeding-Managers tragen jetzt vollständige Rückgabe- und Parameter-Typisierungen; `mypy` bestätigt die Kompatibilität der TypedDict-Casts. Bei neuen Szenarien direkt `FeedingComplianceCompleted` casten und Medication-Payloads auf `FeedingMedicationData` abstützen.【F:tests/unit/test_feeding_manager.py†L36-L421】【F:tests/unit/test_feeding_manager.py†L428-L640】【F:tests/unit/test_feeding_manager.py†L642-L785】
- **Service-Compliance- & Health-Snack-Stubs typisieren:** Die Services-Suite nutzt für Notification-Stubs und veröffentlichte Repair-Payloads jetzt `FeedingComplianceResult`, `_HealthSnackCall` und `FeedingComplianceEventPayload`, sodass Health-Snack-Submissions sowie Compliance-Events ohne generische `dict[str, object]`-Casts verbleiben.【F:tests/unit/test_services.py†L370-L412】【F:tests/unit/test_services.py†L606-L673】【F:tests/unit/test_services.py†L1912-L2173】
- **Event-Queue-Regressionen:** `tests/unit/test_helpers_event_processing.py` prüft `_process_feeding_batch`, `_process_health_batch` sowie den priorisierten Benachrichtigungsprozessor und bestätigt JSON-kompatible Payloads, Reihenfolgensteuerung und Speicherlimitierung der Historien.【F:custom_components/pawcontrol/helpers.py†L1186-L1708】【F:tests/unit/test_helpers_event_processing.py†L32-L169】【F:tests/unit/test_helpers_event_processing.py†L172-L243】
- **Walk-Historien-Reihenfolge:** `_process_walk_batch` sortiert Walk-Historien jetzt konsequent nach Zeitstempeln, kappt sie auf `MAX_HISTORY_ITEMS` und die neue Regression `tests/unit/test_helpers_event_processing.py::test_process_walk_batch_sorts_history_descending` überprüft sowohl Laufzeit- als auch Serialisierungspfad.【F:custom_components/pawcontrol/helpers.py†L1072-L1189】【F:tests/unit/test_helpers_event_processing.py†L245-L351】
- **External-Entity-UI absichern:** Nach der Profilwahl verzweigt der Config-Flow bei aktivem GPS-Modul auf das modulare Setup, persistiert `external_entities` im Entry und der Integrationstest bestätigt Dashboard-, GPS- und Notify-Auswahl mit echten States sowie Diensten.【F:custom_components/pawcontrol/config_flow.py†L1592-L1701】【F:custom_components/pawcontrol/config_flow.py†L1729-L1771】【F:tests/integration/test_config_flow.py†L200-L257】
- **Sensor-Modulzugriffe typisieren:** `_get_module_data` in `PawControlSensorBase` greift jetzt direkt auf den Koordinator-Accessor zu, validiert das Mapping über `_is_typed_sensor_module` und liefert für untypisierte Module sowie fehlerhafte Payloads leere Mappings zurück; die neue Regression `tests/unit/test_sensor_module_access.py` prüft getypte GPS-Snapshots, unbekannte Module und ungültige Rückgaben.【F:custom_components/pawcontrol/sensor.py†L75-L94】【F:custom_components/pawcontrol/sensor.py†L890-L916】【F:tests/unit/test_sensor_module_access.py†L1-L101】
- **Geofencing-Speicher e2e validiert:** `tests/integration/test_geofencing_storage.py` lädt vorinitialisierte Zonendaten inklusive Metadata-Snapshots über `async_initialize`, triggert einen betretenen Bereich per `async_update_location` und bestätigt sowohl Event-Bus-Payload als auch Benachrichtigungsdaten auf den `GeofenceZone`-TypedDicts.【F:custom_components/pawcontrol/geofencing.py†L320-L420】【F:custom_components/pawcontrol/geofencing.py†L512-L867】【F:tests/integration/test_geofencing_storage.py†L1-L104】
- **TypedDict-Klonen absichern:** `tests/unit/test_helpers_payloads.py` verifiziert, dass `typed_deepcopy` vollständig getrennte Kopien für Setup-Payloads erstellt und über `tests.helpers` exportiert wird; bei neuen Fixtures den Helper via `from tests.helpers import typed_deepcopy` statt `deepcopy` direkt nutzen.【F:tests/unit/test_helpers_payloads.py†L1-L33】【F:tests/helpers/payloads.py†L1-L12】【F:tests/helpers/__init__.py†L1-L11】

#### Domain-Runtime & UI-Flows
- **Runtime-UI-Flüsse absichern:** Neue Integrations-Regressionen demonstrieren, dass Options- und Repair-Flows gelöschte `hass.data`-Caches automatisch rekonstruieren und Legacy-Store-Einträge auf die aktuelle `CURRENT_VERSION` anheben; weitere UI-Szenarien dokumentieren, sobald zusätzliche Runtime-Abhängigkeiten entstehen.【F:custom_components/pawcontrol/runtime_data.py†L1-L412】【F:custom_components/pawcontrol/options_flow.py†L248-L1109】【F:custom_components/pawcontrol/repairs.py†L1-L210】【F:tests/integration/test_runtime_store_ui.py†L1-L276】

#### Funktionale Abdeckung
- **Walk- und Geofencing-Regressionen:** `tests/unit/test_walk_manager.py::TestRouteExport` prüft GPX/JSON/CSV-Exporte inklusive Bounds, MIME-Typen, Pfadbereinigung und zusammengefassten Metriken; die Geofencing-Suite ergänzt nun Metadaten-Sanitisierung und Legacy-Listen-Speicherpfade, sodass `GeofenceZone` persistente Payloads automatisch normalisiert (`custom_components/pawcontrol/geofencing.py`, `tests/unit/test_geofencing.py`). Die Wetter-Fallback-Regressionen `tests/unit/test_weather_manager_data.py` decken zusätzlich fehlende Übersetzungs-Schlüssel sowie defekte Platzhalter ab, damit `WeatherHealthManager.async_update_weather_data` sauber auf englische Fallbacks zurückfällt und Alerts trotzdem erzeugt.【F:tests/unit/test_weather_manager_data.py†L1-L317】【F:custom_components/pawcontrol/weather_manager.py†L511-L542】
- **Button-Edge-Cases:** Walk-Start/-End-Buttons normalisieren nun boolesche Flags ("false", "0", `None`) bevor Services ausgelöst werden. Die neue Suite `tests/components/pawcontrol/test_button_edge_cases.py` prüft Start-/End-Verfügbarkeit, Service-Payloads sowie die speziellen `WalkAlreadyInProgressError`-/`WalkNotInProgressError`-Fälle.【F:custom_components/pawcontrol/button.py†L65-L118】【F:custom_components/pawcontrol/button.py†L1291-L1424】【F:tests/components/pawcontrol/test_button_edge_cases.py†L1-L193】
- **Button-Snapshots:** `tests/components/pawcontrol/test_button_snapshots.py` validiert `ButtonExtraAttributes`, Modul-Casts und Cache-Erneuerung, damit Buttons konsistente Metadaten und Koordinator-Snapshots liefern.【F:custom_components/pawcontrol/button.py†L780-L868】【F:custom_components/pawcontrol/button.py†L1312-L1964】【F:tests/components/pawcontrol/test_button_snapshots.py†L1-L133】
- **Config-Flow-E2E-Pfade:** Sämtliche Reconfigure-/Options-Flows mit End-to-End-Tests absichern, inklusive External-Entities-Flow, Runtime-Store, Personen-Manager und Event-Queue.

#### Datenmodell & Schema-Härtung
- **Discovery-Klassifikation erweitert:** `PawControlDiscovery` erkennt jetzt zusätzlich `smart_collar`-, `treat_dispenser`-, `water_fountain`-, `camera`- und `door_sensor`-Geräte, versieht sie mit dedizierten Capability-Listen und priorisiert Spezialisierungen vor generischen Kategorien; die Regression `tests/unit/test_discovery.py::test_classify_device_covers_extended_categories` prüft sämtliche neuen Heuristiken.【F:custom_components/pawcontrol/discovery.py†L32-L135】【F:custom_components/pawcontrol/discovery.py†L329-L402】【F:tests/unit/test_discovery.py†L107-L190】
- **Lokalisierung & Guards:** Übersetzungsflaggen mit `python -m script.sync_localization_flags` synchron halten und Guard-Metriken auf neue Plattformanforderungen anpassen (`custom_components/pawcontrol/diagnostics.py`, `docs/diagnostik.md`).
- **DomainRuntimeStore überwachen:** Persistente `DomainRuntimeStoreEntry`-Caches halten jetzt Laufzeitdaten mit automatischem Versionsabgleich; `get_runtime_data` befüllt fehlende `hass.data`-Einträge automatisch und ersetzt defekte Legacy-Container. `require_runtime_data` blockt Options- und Repair-Flows ohne Runtime-Cache, die neuen UI-/E2E-Tests decken sowohl manuelle Cache-Löschungen als auch Legacy-Versionen ab; weitere Szenarien bei neuen Runtime-Abhängigkeiten ergänzen (`custom_components/pawcontrol/runtime_data.py`, `custom_components/pawcontrol/options_flow.py`, `custom_components/pawcontrol/repairs.py`, `tests/test_runtime_data.py`, `tests/unit/test_options_flow.py`, `tests/test_repairs.py`, `tests/integration/test_runtime_store_ui.py†L1-L276`).
- **TypedDict-Audit halten:** Nach der Bereinigung aller `dict[str, Any]`-/`Mapping[str, Any]`-Fundstellen muss `python script/check_typed_dicts.py` weiterhin vor größeren Refactors laufen, damit neue Payload-Aliase sofort auffallen und dokumentiert werden.【F:script/check_typed_dicts.py†L1-L187】【F:custom_components/pawcontrol/types.py†L1-L6332】

### Monitoring & nächste Schritte
- Wöchentlichen Vendor-Lauf und ad-hoc Checks mit `python -m script.check_vendor_pyyaml` einplanen, damit das gebündelte Paket sofort aktualisiert oder entfernt wird, sobald Home Assistant wieder passende `cp313`-`manylinux`- oder `cp313`-`musllinux`-Wheels (PEP 656) bereitstellt und `generated/vendor_pyyaml_status.json` aktualisiert ist.【F:.github/workflows/vendor-pyyaml-monitor.yml†L1-L47】【F:script/check_vendor_pyyaml.py†L1-L360】【F:generated/vendor_pyyaml_status.json†L1-L20】
- **`pyproject.toml`-Referenz pflegen:** Die Datei enthielt bislang nur minimale Metadaten. Ab sofort beschreibt `[project]` Beschreibung, Lizenz, URLs und optionale `tests`-Extras, und `docs/pyproject_reference.md` erklärt, wie wir die Empfehlungen aus dem Python Developer Tooling Handbook umsetzen. Bei neuen Runtime- oder Testabhängigkeiten müssen `requirements*.txt` und `[project]` synchron bleiben, damit `pip install .[tests]` identische Gates lädt.【F:pyproject.toml†L78-L146】【F:docs/pyproject_reference.md†L1-L52】
- **Scanner-Lint bereinigen:** Die bisherigen Sternimporte im Vendor-Scanner verhinderten eine saubere `ruff`-Auswertung der Token-Hilfsmethoden; ab sofort liegen explizite Token-Imports und kleingeschriebene Klassenargumente vor. Bei weiteren Vendor-Syncs prüfen, ob neue Token-Klassen ergänzt werden müssen und dass kombinierte Bedingungszweige (`SIM102`) erhalten bleiben.【F:annotatedyaml/_vendor/yaml/scanner.py†L25-L59】【F:annotatedyaml/_vendor/yaml/scanner.py†L401-L470】【F:annotatedyaml/_vendor/yaml/scanner.py†L520-L600】
- Die reservierten Vollsuite-Slots (`scheduled-pytest.yml`) und den CI-`TypedDict audit` im Blick behalten; bei Findings komplette lokale Läufe (`pytest -q`, `mypy`, `ruff check`) anstoßen und Korrekturen dokumentieren.【F:.github/workflows/scheduled-pytest.yml†L1-L55】【F:.github/workflows/ci.yml†L1-L67】【F:.github/copilot-instructions.md†L31-L53】
- Neue Fixtures oder Loader-Pfade sofort in den Session-/Fixture-Wächtern registrieren, damit `scripts/enforce_shared_session_guard.py` und die pytest-Watcher weiterhin alle Companion-/Voice-Erweiterungen blockieren.【F:scripts/enforce_shared_session_guard.py†L1-L200】【F:tests/conftest.py†L195-L242】
- Laufzeit-Guards der Entity Factory nach jeder Performance-Anpassung prüfen: Die Telemetrie persistiert Kalibrierungsereignisse unter `entity_factory_guard_metrics` inklusive Bodenzeit-Delta, Durchschnitt/Min/Max, Stabilitätsquoten, Streak-Zählern sowie Lifetime- und Fünf-Sample-Jitter; Diagnostics/System-Health spiegeln sie unter `service_execution.entity_factory_guard`. Bei unerwarteten Schwellenwerten oder Ausreißer-Dauern sofort `tests/test_entity_factory_guardrails.py`, `tests/components/pawcontrol/test_system_health.py` und `tests/components/pawcontrol/test_diagnostics.py` nachziehen.【F:custom_components/pawcontrol/entity_factory.py†L1017-L1136】【F:custom_components/pawcontrol/telemetry.py†L101-L244】【F:custom_components/pawcontrol/diagnostics.py†L1387-L1477】【F:custom_components/pawcontrol/system_health.py†L394-L612】【F:tests/test_entity_factory_guardrails.py†L520-L640】【F:tests/components/pawcontrol/test_system_health.py†L18-L663】【F:tests/components/pawcontrol/test_diagnostics.py†L540-L612】
- Runtime-Store-Bewertungen beobachten: Nach Reparatur- oder Telemetrie-Anpassungen verifizieren, dass `runtime_store_assessment` Divergenzraten und Migrationen korrekt einstuft und dass Level-Dauern (`level_durations`, `current_level_duration_seconds`) realistische Werte liefern. Zusätzlich prüfen, ob die `runtime_store_timeline_summary` Beobachtungsfenster, Event-Dichte, häufigste Gründe/Status, Divergenz-Durchschnitt/Peak sowie Level-Dauer-Peaks/-Letzte korrekt widerspiegelt (`tests/unit/test_runtime_store_telemetry.py`, `tests/components/pawcontrol/test_system_health.py`, `tests/components/pawcontrol/test_diagnostics.py`). Bei unerwarteten Eskalationen Laufzeit-Snapshots sichern und die Repair-Suite erneut ausführen.
- Nach jedem Dokumentations- oder Prozessupdate `python -m script.sync_contributor_guides` laufen lassen, Markdown-Guides über `docs/markdown_compliance_review.md` spiegeln und die Sync-Belege im Scribe-Board verlinken.【F:script/sync_contributor_guides.py†L1-L92】【F:docs/markdown_compliance_review.md†L1-L60】【F:dev.md†L1-L40】
- Telemetrie-, Diagnostics- und README/Info-Anpassungen konsequent mitsamt Referenzen dokumentieren, damit Platinum-Nachweise in README, `info.md` und Produktionsdokumentation synchron bleiben.【F:README.md†L31-L53】【F:info.md†L101-L114】【F:docs/production_integration_documentation.md†L636-L669】

#### Fehler- und Verbesserungsjournal

- **`pytest -q` hängt nach 686 Tests (~25 min).** Die Vollsuite bleibt im aktuellen Sprint blockiert, weil sie vor dem Abschluss keine weiteren Ergebnisse liefert. Nächste Schritte: Suite lokal mit `-k`-Filtern halbieren, die Prozessliste via `pytest -vv`/`--maxfail=1` dokumentieren, anschließend die hängenden Tests isolieren und – falls Drittanbieter-Fixtures beteiligt sind – den zugehörigen Manager über `tests/helpers/` mit Zeitouts absichern. Fortschritt zusammen mit dem `scheduled-pytest`-Workflow im Wochenboard verlinken.
- **`mypy custom_components/pawcontrol` meldet hunderte Fremd-Fehler.** Momentan laufen sämtliche Domains, obwohl lediglich das Integrationspaket Teil des Delta ist. Bis zur Bereinigung scope-reduzierte Aufrufe (`mypy custom_components/pawcontrol/...`) dokumentieren, parallel `mypy.ini`/`pyproject` auf fehlende per-file ignores prüfen und Tickets für die jeweiligen Plattform-Teams öffnen, falls externe Stubs veraltet sind.
- **`python -m script.hassfest --integration-path custom_components/pawcontrol` schlägt mit identischen Typmeldungen fehl.** Die TypeError-Welle aus `mypy` blockiert hier denselben Guard, weshalb wir zunächst die oben beschriebenen Typfehler adressieren und anschließend `hassfest` erneut protokollieren müssen.
- **Tests für `_select_loader`/`_extract_legacy_loader` fehlen.** `annotatedyaml/_vendor/yaml/__init__.py` deckt sowohl `load` als auch `load_all` über die neuen Helfer ab, aber `tests/unit/test_annotatedyaml_vendor.py` prüft bislang nur `load`, `safe_load` und `dump`. Ergänze Regressionen für `load_all`/`safe_load_all` inklusive Konfliktpfade, damit Loader/Dumper-Aliasse auch bei Mehrdokument-Streams bewiesen sind.【F:annotatedyaml/_vendor/yaml/__init__.py†L25-L147】【F:tests/unit/test_annotatedyaml_vendor.py†L1-L35】

## Qualitäts-Gate-Erwartungen
- ✅ `ruff check custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/diagnostics.py custom_components/pawcontrol/system_health.py tests/unit/test_runtime_store_telemetry.py tests/components/pawcontrol/test_diagnostics.py tests/components/pawcontrol/test_system_health.py` – Die neuen Runtime-Store-Timeline-Segmente und ihre Exporte nach Diagnostics sowie System Health bleiben lint-frei.【F:custom_components/pawcontrol/telemetry.py†L440-L520】【F:custom_components/pawcontrol/diagnostics.py†L629-L650】【F:custom_components/pawcontrol/system_health.py†L77-L108】【83e9e7†L1-L4】
- ✅ `PYTHONPATH=. pytest tests/unit/test_runtime_store_telemetry.py tests/components/pawcontrol/test_diagnostics.py tests/components/pawcontrol/test_system_health.py -q` – Regressionen belegen, dass Telemetrie, Diagnostics und System Health konsistente Segmentlisten für die Timeline bereitstellen.【F:tests/unit/test_runtime_store_telemetry.py†L121-L220】【F:tests/components/pawcontrol/test_diagnostics.py†L529-L599】【F:tests/components/pawcontrol/test_system_health.py†L20-L91】【bdeaee†L1-L9】
- ✅ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Dank des vendorten PyYAML 6.0 läuft das Qualitäts-Gate wieder ohne Systemabhängigkeiten und lädt die Stub-Implementierung automatisch nach.【F:annotatedyaml/loader.py†L6-L26】【F:annotatedyaml/_vendor/yaml/__init__.py†L1-L390】【F:tests/unit/test_annotatedyaml_fallback.py†L88-L118】
- ✅ `PYTHONPATH=. pytest tests/unit/test_annotatedyaml_fallback.py -q` – Die Regression deckt sowohl den regulären Fallback als auch den Vendor-Pfad ab, inklusive Blockierung des System-Moduls und Überprüfung des bundelten `safe_load`-Symbols.【F:annotatedyaml/loader.py†L6-L26】【F:tests/unit/test_annotatedyaml_fallback.py†L52-L118】【4d4e1f†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_annotatedyaml_vendor.py -q` – Die Legacy-Schlüssel `Loader` und `Dumper` bleiben kompatibel, während widersprüchliche Alias-Übergaben gezielt eine `TypeError` auslösen.【F:annotatedyaml/_vendor/yaml/__init__.py†L1-L390】【F:tests/unit/test_annotatedyaml_vendor.py†L1-L30】
- ✅ `ruff check custom_components/pawcontrol/runtime_data.py custom_components/pawcontrol/types.py tests/test_runtime_data.py tests/integration/test_runtime_store_ui.py`
– Die Laufzeit-Schema-Stempelung synchronisiert `schema_version` und `schema_created_version` direkt an den Payloads, verhindert Future-Schemas frühzeitig und hält Options-/Repair-Flows kompatibel.【F:custom_components/pawcontrol/runtime_data.py†L100-L420】【F:custom_components/pawcontrol/types.py†L6052-L6186】【e0d422†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/test_runtime_data.py -q` – Neue Regressionen decken Legacy-Runtimes ohne Schema-Metadaten, Future-Schema-Abweisungen und die Store-Bereinigung nach inkompatiblen Snapshots ab.【F:tests/test_runtime_data.py†L724-L842】【b7b3d1†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/integration/test_runtime_store_ui.py -q` – Die Integration bestätigt, dass Options- und Repair-Flows nach Cache-Löschungen Schema-Stempel und Versionen synchron halten.【F:tests/integration/test_runtime_store_ui.py†L90-L214】【5e9aa7†L1-L9】
- ✅ `ruff check custom_components/pawcontrol/text.py tests/components/pawcontrol/test_text_entities.py` – Text-Setup normalisiert Legacy-Dog-Payloads, fällt bei fehlenden `native_max`-Attributen auf `_attr_native_max` zurück und bleibt lint-frei.【F:custom_components/pawcontrol/text.py†L167-L312】【F:tests/components/pawcontrol/test_text_entities.py†L71-L220】【d4c2cd†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_text_entities.py -q` – Die neue Suite prüft Normalisierung, Extra-Attribute, Character-Clamping und Service-Guards für alle Text-Entities.【F:tests/components/pawcontrol/test_text_entities.py†L71-L220】【c95276†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_walk_manager.py -k TestRouteExport -q` – Die aktualisierten Routenexport-Tests validieren Bounds, MIME-Typen und Pfadbereinigung für GPX/JSON/CSV-Payloads des Walk-Managers.【F:tests/unit/test_walk_manager.py†L760-L848】【a8c0c0†L1-L9】
- ✅ `ruff check system_health.py custom_components/pawcontrol/system_health.py` – Der Root-Einstieg leitet jetzt direkt auf das getypte Integrationsmodul durch, sodass lokale Tools automatisch die erweiterten System-Health-TypedDicts verwenden und beide Dateien lint-frei bleiben.【F:system_health.py†L1-L11】【F:custom_components/pawcontrol/system_health.py†L520-L897】【9a9b37†L1-L2】
- ✅ `python script/check_typed_dicts.py` – Der aktuelle Audit bestätigt erneut, dass nach der Root-System-Health-Weiterleitung keine verbleibenden `dict[str, Any]`-/`Mapping[str, Any]`-Fundstellen mehr im Integrationscode bestehen.【5ce768†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/feeding_manager.py custom_components/pawcontrol/helpers.py custom_components/pawcontrol/geofencing.py custom_components/pawcontrol/module_adapters.py custom_components/pawcontrol/feeding_translations.py` – Lint bestätigt die neuen Scheduling-Flags für Aktivitäts- und Notfall-Ergebnisse sowie die gesundheitsbewusste Typkonvertierung in `async_update_health_data` ohne weitere Verstöße.【F:custom_components/pawcontrol/feeding_manager.py†L231-L283】【F:custom_components/pawcontrol/feeding_manager.py†L2720-L2757】【b85e0a†L1-L4】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_manager.py tests/unit/test_module_adapters.py tests/unit/test_gps_manager.py -q` – Die Feeding-, Adapter- und GPS-Suiten bleiben grün und verifizieren die neuen Optionalfelder für Rücksetz- und Wiederherstellungstimer innerhalb der Feeding-Ergebnisse.【F:custom_components/pawcontrol/feeding_manager.py†L231-L283】【F:custom_components/pawcontrol/feeding_manager.py†L3325-L3473】【80537e†L1-L11】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/feeding_manager.py custom_components/pawcontrol/helpers.py custom_components/pawcontrol/geofencing.py custom_components/pawcontrol/module_adapters.py custom_components/pawcontrol/feeding_translations.py` – Die aktualisierten TypedDicts bestehen die strengen Typprüfungen, nachdem `age_months` und `body_condition_score` auf `int | None` geklammert werden.【F:custom_components/pawcontrol/feeding_manager.py†L231-L283】【F:custom_components/pawcontrol/feeding_manager.py†L2720-L2757】【159043†L1-L1】
- ✅ `python script/check_typed_dicts.py` – Der Audit meldet keine verbliebenen `dict[str, Any]`-/`Mapping[str, Any]`-Fundstellen nach der Feeding- und Helper-Typisierung.【de7b5f†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/options_flow.py custom_components/pawcontrol/repairs.py` – Options-Import/Export, GPS-, und Reparatur-Flows laufen lint-frei, nachdem Benutzer-Eingaben, Cache-Snapshots und Issue-Metadaten auf `ConfigFlowUserInput`/`JSONMutableMapping` umgestellt wurden.【F:custom_components/pawcontrol/options_flow.py†L300-L515】【F:custom_components/pawcontrol/options_flow.py†L1236-L1424】【F:custom_components/pawcontrol/repairs.py†L1-L188】【2843ac†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py tests/test_repairs.py -q` – Config-Flow- und Repair-Regressionen bestätigen die typisierten Import-/Export-Schritte, den Runtime-Cache-Guard über `require_runtime_data` und die aktualisierten Door-Sensor-Migrationen ohne Regressionen.【F:custom_components/pawcontrol/options_flow.py†L2747-L3144】【F:custom_components/pawcontrol/repairs.py†L768-L933】【a3553a†L1-L11】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_dogs.py tests/unit/test_config_flow_dashboard_extension.py tests/unit/test_config_flow_external.py -q` – Die Placeholder-Builder liefern nun unveränderliche `MappingProxyType`-Rückgaben für Add-Dog-, Dashboard- und External-Schritte und sichern stringifizierte Zähler sowie boolesche Flags ab.【F:custom_components/pawcontrol/config_flow_dogs.py†L120-L224】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L66-L104】【F:custom_components/pawcontrol/config_flow_external.py†L34-L90】【229366†L1-L11】
- ✅ `ruff check custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/config_flow_dashboard_extension.py custom_components/pawcontrol/config_flow_external.py custom_components/pawcontrol/types.py tests/unit/test_config_flow_dogs.py tests/unit/test_config_flow_dashboard_extension.py tests/unit/test_config_flow_external.py` – Alle Config-Flow-Mixin-Platzhalter nutzen MappingProxyType-Builder mit dedizierten TypedDicts und bestehen das Lint-Gate ohne Restimporte.【F:custom_components/pawcontrol/config_flow_dogs.py†L120-L224】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L66-L104】【F:custom_components/pawcontrol/config_flow_external.py†L34-L90】【F:custom_components/pawcontrol/types.py†L2268-L2344】【81054f†L1-L4】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/options_flow.py custom_components/pawcontrol/repairs.py` – Die neuen TypedDict-/JSON-Mapping-Anpassungen bestehen die strenge Typprüfung ohne Zusatz-Casts.【F:custom_components/pawcontrol/options_flow.py†L300-L515】【F:custom_components/pawcontrol/options_flow.py†L1236-L1424】【F:custom_components/pawcontrol/repairs.py†L1-L188】【db56f3†L1-L2】
- ✅ `python script/check_typed_dicts.py | tail -n 5` – Der Audit meldet nach der Options- und Repairs-Typisierung noch 38 verbleibende Funde; nächster Fokus liegt auf `module_adapters.py` und dem Feeding-Manager.【2947f8†L1-L7】
- ✅ `ruff check custom_components/pawcontrol/entity.py custom_components/pawcontrol/entity_factory.py` – Die Basiseinheiten akzeptieren jetzt `JSONMappingLike`-Servicepayloads und das Profil-Gating nutzt generische `Mapping[str, object]`-Signaturen ohne `Any`-Fallbacks.【F:custom_components/pawcontrol/entity.py†L15-L196】【F:custom_components/pawcontrol/entity_factory.py†L1460-L1489】【ef5790†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_profiles.py -q` – Die Profil-Regression bestätigt, dass die typisierten Modulprüfungen weiterhin alle Szenarien abdecken.【F:custom_components/pawcontrol/entity_factory.py†L1460-L1489】【19a493†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/entity.py custom_components/pawcontrol/entity_factory.py` – Die neuen Service- und Modul-Signaturen bestehen die strengen Typprüfungen ohne Zusatz-Casts.【F:custom_components/pawcontrol/entity.py†L15-L196】【F:custom_components/pawcontrol/entity_factory.py†L1460-L1489】【27c94e†L1-L2】
- ✅ `python script/check_typed_dicts.py | tail -n 5` – Der Audit zählt nach der Entity-/Factory-Bereinigung noch 143 Stellen; Hauptfokus bleibt auf Feeding-, Options- und Repair-Flows.【0ff896†L1-L6】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/types.py` – Der Reconfigure-Flow und die Options-TypedDicts laufen lint-frei, nachdem `async_step_reconfigure` jetzt `ConfigFlowUserInput` akzeptiert und die Options-Historie auf `ConfigEntryOptionsPayload` gecastet wird.【F:custom_components/pawcontrol/config_flow.py†L2390-L2649】【F:custom_components/pawcontrol/types.py†L2070-L2086】【079d0c†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Config-Flow-Regressionen bestätigen, dass die typisierte Reconfigure-Schritt-Validierung und die neuen Modul-Merge-Casts alle Szenarien weiterhin abdecken.【F:custom_components/pawcontrol/config_flow.py†L2874-L3086】【019bd3†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/types.py` – Die neuen Eingabe-/Options-Aliasse bestehen die strenge Typprüfung ohne Zusatz-Casts.【F:custom_components/pawcontrol/config_flow.py†L2390-L3086】【F:custom_components/pawcontrol/types.py†L2070-L2086】【4f54ae†L1-L2】
- ✅ `python script/check_typed_dicts.py | tail -n 5` – Der Audit zählt nach der Reconfigure-Typisierung 233 verbleibende Fundstellen; Fokus liegt nun auf den Diagnostik- und Repair-Flows.【F:custom_components/pawcontrol/config_flow.py†L2390-L3086】【8c7a5a†L1-L6】
- ✅ `ruff check custom_components/pawcontrol/diagnostics.py` – Die Diagnostik-Helfer serialisieren jetzt sämtliche Snapshots und Rückgaben über `JSONMutableMapping`/`JSONLikeMapping`, wodurch die Config-, Entitäten-, Geräte- und Servicepfade ohne `dict[str, Any]`-Fallbacks auskommen.【F:custom_components/pawcontrol/diagnostics.py†L605-L937】【F:custom_components/pawcontrol/diagnostics.py†L990-L1327】【8df661†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_diagnostics_cache.py -q` – Die Cache- und Snapshot-Regression bestätigt, dass die neue JSON-Serialisierung weiter alle vier Diagnostikfälle abdeckt.【F:custom_components/pawcontrol/diagnostics.py†L823-L868】【114ac9†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/diagnostics.py` – Die erweiterten JSON-Aliasse und Casts für Integrationsstatus, Geräte- und Service-Telemetrie bestehen die Typprüfung ohne Zusatz-Suppressions.【F:custom_components/pawcontrol/diagnostics.py†L894-L1327】【d155b0†L1-L2】
- ✅ `python script/check_typed_dicts.py | tail -n 5` – Der Audit fällt nach der Diagnostik-Umstellung auf 146 offene Stellen; Hauptschwerpunkte sind nun Feeding-Manager-, Options- und Repair-Flows.【354bbe†L1-L6】
- ✅ `ruff check custom_components/pawcontrol/sensor.py custom_components/pawcontrol/service_guard.py custom_components/pawcontrol/services.py` – Sensor- und Guard-Module nutzen jetzt TypedDict- und JSONLikeMapping-Aliasse ohne `dict[str, Any]`-Rückfälle; die Lint-Prüfung bleibt sauber.【F:custom_components/pawcontrol/sensor.py†L772-L905】【F:custom_components/pawcontrol/service_guard.py†L1-L233】【F:custom_components/pawcontrol/services.py†L618-L734】【27f2d3†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_all_platforms.py -k sensor -q` – Die Plattform-Regression bestätigt, dass die typisierten Sensor-Attribute und Modul-Fallbacks weiterhin alle 15 Sensor-Szenarien abdecken.【F:custom_components/pawcontrol/sensor.py†L772-L905】【a9a4db†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_services.py -q` – Die Service-Suite deckt die getypten Kontext- und Guard-Metriken ohne Fehler ab.【F:custom_components/pawcontrol/service_guard.py†L1-L233】【F:custom_components/pawcontrol/services.py†L618-L734】【948957†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/sensor.py custom_components/pawcontrol/service_guard.py custom_components/pawcontrol/services.py` – Die neuen TypedDict-Rückgaben und JSONLikeMapping-Signaturen bestehen die Typprüfung ohne Cast-Ausnahmen.【F:custom_components/pawcontrol/sensor.py†L772-L905】【F:custom_components/pawcontrol/service_guard.py†L1-L233】【F:custom_components/pawcontrol/services.py†L618-L734】【39b8ce†L1-L2】
- ✅ `python script/check_typed_dicts.py | tail -n 20` – Der Audit listet 237 verbleibende Funde (−21); Sensor-, Guard- und Service-Pfade sind jetzt frei von `dict[str, Any]`-Signaturen.【F:custom_components/pawcontrol/sensor.py†L772-L905】【F:custom_components/pawcontrol/service_guard.py†L1-L233】【F:custom_components/pawcontrol/services.py†L618-L734】【e710f7†L1-L20】
- ✅ `ruff check custom_components/pawcontrol/system_health.py custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/text.py custom_components/pawcontrol/types.py` – System Health nutzt jetzt typed Options-/Threshold-Aliasse, Telemetrie normalisiert Reconfigure- und Door-Sensor-Payloads und die Text-Helfer prüfen Modul-Quellen bevor sie TypedDicts erzeugen, alles lint-frei.【F:custom_components/pawcontrol/system_health.py†L520-L897】【F:custom_components/pawcontrol/telemetry.py†L331-L505】【F:custom_components/pawcontrol/text.py†L55-L104】【F:custom_components/pawcontrol/types.py†L76-L133】【F:custom_components/pawcontrol/types.py†L1168-L1332】【6ea39a†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py tests/unit/test_services.py tests/unit/test_options_flow.py -q` – Die Config-Flow-, Service- und Options-Suiten bestätigen die neuen TypedDict-Eingaben für Module, Door-Sensor-Telemetrie und Reconfigure-Zusammenfassungen ohne Regressionen.【F:custom_components/pawcontrol/system_health.py†L520-L897】【F:custom_components/pawcontrol/telemetry.py†L331-L505】【F:custom_components/pawcontrol/types.py†L1168-L1332】【adb89f†L1-L11】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/system_health.py custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/text.py custom_components/pawcontrol/types.py` – Die erweiterten TypedDicts für System-Health-Snapshots, Reconfigure-Telemetrie und Text-Module bestehen die strenge Typprüfung ohne Cast-Ausnahmen.【F:custom_components/pawcontrol/system_health.py†L520-L897】【F:custom_components/pawcontrol/telemetry.py†L331-L505】【F:custom_components/pawcontrol/text.py†L55-L104】【F:custom_components/pawcontrol/types.py†L76-L133】【F:custom_components/pawcontrol/types.py†L1168-L1332】【57006e†L1-L1】
- ✅ `python script/check_typed_dicts.py | tail -n 20` – Der TypedDict-Audit listet weiterhin 258 offene `dict[str, Any]`/`Mapping[str, Any]`-Fundstellen; nach der System-Health- und Telemetrie-Härtung verschiebt sich der Fokus auf Sensor- und Service-Helper.【77ee27†L1-L23】
- ✅ `ruff check custom_components/pawcontrol/data_manager.py custom_components/pawcontrol/device_api.py custom_components/pawcontrol/types.py tests/unit/test_data_manager.py` – Die neuen JSONMutableMapping-Fallbacks für Entity-Budget-Diagnosen und Device-API-Responses bleiben lint-frei.【F:custom_components/pawcontrol/data_manager.py†L341-L420】【F:custom_components/pawcontrol/device_api.py†L5-L121】【329a6d†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py -q` – Eine neue Regression deckt den Fehlerpfad des Entity-Budget-Monitors ab und bestätigt die Mutable-Mapping-Rückgaben.【F:tests/unit/test_data_manager.py†L215-L299】【9c7d14†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/data_manager.py custom_components/pawcontrol/device_api.py custom_components/pawcontrol/types.py` – Die aktualisierten TypedDicts und JSON-Koerzierung bestehen die strenge Typprüfung ohne Zusatz-Casts.【F:custom_components/pawcontrol/data_manager.py†L341-L420】【F:custom_components/pawcontrol/device_api.py†L5-L121】【F:custom_components/pawcontrol/types.py†L5523-L5534】【768131†L1-L1】
- ✅ `python script/check_typed_dicts.py | tail -n 5` – Der Audit zählt nach den neuen JSONMutableMapping-Fallbacks noch 299 offene Fundstellen (−7), Fokus bleibt auf den verbleibenden Storage-/Options-Payloads.【815b5e†L1-L7】
- ✅ `ruff check` – Die getypten Rejection-Helfer und Dashboard-Konvertierungen laufen lint-frei, nachdem `JSONMapping`/`JSONMutableMapping` die alten `Mapping[str, Any]`-Casts ersetzt haben.【F:custom_components/pawcontrol/coordinator_tasks.py†L460-L506】【F:custom_components/pawcontrol/dashboard_generator.py†L460-L521】【F:custom_components/pawcontrol/dashboard_cards.py†L2833-L3040】【8f50b2†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_generator.py tests/unit/test_coordinator_observability.py tests/unit/test_services.py -q` – Die Dashboard-, Observability- und Service-Suiten bestätigen die neuen TypedDict-Zusammenführungen ohne Regressionen.【F:custom_components/pawcontrol/dashboard_generator.py†L1583-L1636】【F:custom_components/pawcontrol/coordinator_tasks.py†L460-L520】【F:custom_components/pawcontrol/services.py†L452-L579】【8cf743†L1-L11】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/coordinator_tasks.py custom_components/pawcontrol/dashboard_generator.py custom_components/pawcontrol/dashboard_renderer.py custom_components/pawcontrol/dashboard_cards.py custom_components/pawcontrol/types.py` – Die aktualisierten JSON-Helfer und TypedDict-Aliasse bestehen die strenge Typprüfung ohne Zusatz-Casts.【F:custom_components/pawcontrol/coordinator_tasks.py†L460-L520】【F:custom_components/pawcontrol/dashboard_generator.py†L460-L521】【F:custom_components/pawcontrol/dashboard_renderer.py†L720-L780】【F:custom_components/pawcontrol/dashboard_cards.py†L2833-L3040】【82a622†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/coordinator_observability.py` – Die JSON-basierten Merge-Helfer, Modul-Normalisierungen und Scorecards kommen jetzt ohne `dict[str, Any]`-Signaturen aus, da `JSONValue`-, `JSONMapping`- und `DogModulesProjection`-Casts alle Zwischenschritte typisieren.【F:custom_components/pawcontrol/config_flow.py†L2749-L2905】【F:custom_components/pawcontrol/config_flow_dogs.py†L330-L387】【F:custom_components/pawcontrol/coordinator_observability.py†L269-L311】【571316†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py tests/unit/test_coordinator_observability.py -q` – Die Config-Flow- und Observability-Suiten bestätigen, dass die typisierten Merge-Helfer und JSON-Snapshots weiterhin alle 55 Szenarien ohne Regressionen abdecken.【F:custom_components/pawcontrol/config_flow.py†L2749-L2905】【F:custom_components/pawcontrol/coordinator_observability.py†L269-L311】【dbb978†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/coordinator_observability.py` – Die neuen JSONValue-Signaturen und Guard-Checks bestehen die strengen Typregeln ohne zusätzliche Casts.【F:custom_components/pawcontrol/config_flow.py†L2749-L2905】【F:custom_components/pawcontrol/config_flow_dogs.py†L330-L387】【F:custom_components/pawcontrol/coordinator_observability.py†L269-L311】【75394a†L1-L2】
- ✅ `python script/check_typed_dicts.py` – Der Audit meldet nach der JSON-Umstellung noch 325 verbleibende Fundstellen (−11), womit die nächsten Schritte bei Options- und Storage-Payloads liegen.【320735†L1-L7】
- ✅ `ruff check custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/types.py` – Die neuen `DogFeedingStepInput`- und `DogHealthStepInput`-TypedDicts ersetzen untypisierte Flow-Payloads, und die Feeding-/Health-Schritte akzeptieren jetzt ausschließlich diese strukturierten Eingaben.【F:custom_components/pawcontrol/types.py†L1387-L1457】【F:custom_components/pawcontrol/config_flow_dogs.py†L599-L807】【59d6db†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Config-Flow-Regressionen bestätigen, dass die streng typisierten Dog-Feeding- und Health-Schritte weiterhin alle 50 Szenarien ohne Regressionspfade durchlaufen.【F:custom_components/pawcontrol/config_flow_dogs.py†L599-L869】【cf9c28†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/types.py` – Die erweiterten TypedDicts bestehen die statische Analyse, sodass keine `Mapping[str, Any]`-Casts mehr für die Feeding- und Health-Formulare nötig sind.【F:custom_components/pawcontrol/types.py†L1387-L1457】【F:custom_components/pawcontrol/config_flow_dogs.py†L599-L807】【9c96fc†L1-L2】
- ✅ `python script/check_typed_dicts.py` – Der Audit zählt jetzt 336 verbleibende Fundstellen (−7), nachdem die Dog-Flows auf TypedDict-Eingaben umgestellt wurden.【00ceec†L167-L173】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/types.py` – Die Reauth-Schritte nutzen jetzt `ConfigEntryDataPayload`, das neue `ReauthConfirmInput` sowie `MutableConfigFlowPlaceholders`, damit Bestätigungs- und Platzhalter-Payloads ohne `dict[str, Any]`-Fallbacks strikt typisiert bleiben.【F:custom_components/pawcontrol/config_flow.py†L1984-L2266】【F:custom_components/pawcontrol/types.py†L2197-L2218】【e8172f†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Reauth-Regression bestätigt, dass die typisierten Eingaben inklusive Platzhaltern weiterhin alle 50 Szenarien für Modul-, Discovery- und Reauth-Flows abdecken.【F:custom_components/pawcontrol/config_flow.py†L1984-L2266】【9d2076†L1-L6】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/types.py` – `ReauthConfirmInput` und die aktualisierten Flow-Signaturen bestehen die strengen Typregeln ohne Zusatz-Casts.【F:custom_components/pawcontrol/types.py†L2197-L2218】【F:custom_components/pawcontrol/config_flow.py†L1984-L2266】【baf63b†L1-L2】
- ✅ `python script/check_typed_dicts.py` – Der Audit meldet noch 343 Fundstellen (−2), womit der Fokus nun auf verbleibenden Storage- und Optionsflow-Payloads liegt.【758ee2†L1-L12】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_dashboard_extension.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/types.py tests/components/pawcontrol/test_config_flow.py tests/helpers/homeassistant_test_stubs.py tests/unit/test_config_flow_modules.py` – Die Config- und Dog-Flow-Schritte akzeptieren jetzt sowohl `DogModuleSelectionInput`-Flags als auch gespeicherte `DogModulesConfig`-Payloads, während die Stubs typisierte Auto-Advance-Daten nutzen.【F:custom_components/pawcontrol/config_flow.py†L1077-L1457】【F:custom_components/pawcontrol/config_flow_dogs.py†L256-L400】【F:tests/helpers/homeassistant_test_stubs.py†L701-L709】【d493de†L1-L4】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Neue Regressionen decken die Normalisierung der Modul-Flags ab und stellen sicher, dass sowohl Flag- als auch Mapping-Payloads den Flow bis zur Entry-Erstellung treiben.【F:tests/unit/test_config_flow_modules.py†L149-L177】【F:tests/components/pawcontrol/test_config_flow.py†L181-L232】【60418a†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/config_flow_dashboard_extension.py custom_components/pawcontrol/types.py` – Die erweiterten TypedDicts (`ModuleConfigurationSnapshot`, `DogGPSStepInput`, `AddAnotherDogInput`) bestehen die Typprüfung ohne zusätzliche Casts.【F:custom_components/pawcontrol/types.py†L795-L2052】【F:custom_components/pawcontrol/config_flow.py†L1077-L1558】【F:custom_components/pawcontrol/config_flow_dogs.py†L256-L400】【1b74a7†L1-L4】
- ✅ `python script/check_typed_dicts.py` – Der TypedDict-Audit meldet weiterhin 345 offene Fundstellen; Schwerpunkt bleibt auf den verbliebenen `dict[str, Any]`-Signaturen in `config_flow*` und `data_manager`.【2038ab†L1-L116】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_dashboard_extension.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/types.py tests/helpers/homeassistant_test_stubs.py` – Die Config-Flow-Schritte akzeptieren jetzt `DogModuleSelectionInput`- und `DogModulesConfig`-Payloads, mappen Module über das neue `ModuleToggleFlowFlag`-Alias und casten Platzhalter auf `Mapping[str, bool | int | float | str]`, sodass die Lint-Prüfung ohne `dict[str, Any]`-Fallbacks bleibt.【F:custom_components/pawcontrol/types.py†L809-L853】【F:custom_components/pawcontrol/config_flow_dogs.py†L347-L388】【F:custom_components/pawcontrol/config_flow.py†L1394-L1458】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L102-L121】【9fdb02†L1-L4】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Module- und Reconfigure-Flows bestätigen die neuen Union-Typen für Schritt-Eingaben und die normalisierten Platzhalter ohne Regressionen.【F:custom_components/pawcontrol/config_flow.py†L1394-L1458】【F:custom_components/pawcontrol/config_flow.py†L2380-L2438】【1c3b36†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/config_flow_dashboard_extension.py custom_components/pawcontrol/types.py` – Die neuen Aliasse (`ModuleToggleFlowFlag`, `ModuleConfigurationSnapshot`) und die typisierten Platzhalter bestehen die Analyse ohne Override-Konflikte.【F:custom_components/pawcontrol/types.py†L809-L853】【F:custom_components/pawcontrol/config_flow_dogs.py†L256-L400】【F:custom_components/pawcontrol/config_flow.py†L1394-L1458】【F:custom_components/pawcontrol/config_flow.py†L2231-L2424】【e775cc†L1-L1】
- ✅ `python script/check_typed_dicts.py` – Der TypedDict-Audit meldet nach der Config-Flow- und Helper-Überarbeitung noch 345 verbliebene `dict[str, Any]`/`Mapping[str, Any]`-Fundstellen (−7 ggü. zuletzt protokolliert).【ab0749†L1-L13】
- ✅ `ruff check custom_components/pawcontrol/compat.py custom_components/pawcontrol/utils.py custom_components/pawcontrol/walk_manager.py custom_components/pawcontrol/types.py` – Die Kompatibilitäts-Shims verwenden jetzt JSON-gestützte Daten-/Options-Payloads, die Utils-Fallbacks vermeiden `Any`-Aliase und `async_fire_event` akzeptiert ausschließlich JSON-Mappings, während der Walk-Manager mit den neuen `WalkDetection*`-Aliassen strukturierte Erkennungsdaten speichert.【F:custom_components/pawcontrol/compat.py†L15-L37】【F:custom_components/pawcontrol/compat.py†L441-L485】【F:custom_components/pawcontrol/compat.py†L644-L670】【F:custom_components/pawcontrol/utils.py†L168-L173】【F:custom_components/pawcontrol/utils.py†L337-L345】【F:custom_components/pawcontrol/walk_manager.py†L28-L50】【F:custom_components/pawcontrol/walk_manager.py†L255-L314】【F:custom_components/pawcontrol/walk_manager.py†L624-L705】【F:custom_components/pawcontrol/types.py†L3499-L3503】
- ✅ `PYTHONPATH=. pytest tests/unit/test_walk_manager.py -q` – Die 42 Walk-Szenarien bleiben grün und bestätigen, dass die typisierten Erkennungsmetadaten keine Regressionspfade öffnen.【9736ee†L1-L4】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/compat.py custom_components/pawcontrol/utils.py custom_components/pawcontrol/walk_manager.py custom_components/pawcontrol/types.py` – Kompatibilitätsdaten, Event-Helper und Walk-Erkennungs-Payloads bestehen die strenge Typprüfung ohne Zusatz-Casts.【950a7c†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/__init__.py custom_components/pawcontrol/data_manager.py` – Die Config-Entry-Initialisierung übergibt jetzt `DogConfigData`-Sequenzen an den Datenmanager und typisiert das manuelle Ereignisarchiv über `ManualResilienceEventRecord`, wodurch keine `dict[str, Any]`-Kopien mehr notwendig sind.【F:custom_components/pawcontrol/__init__.py†L699-L706】【F:custom_components/pawcontrol/__init__.py†L1487-L1551】【F:custom_components/pawcontrol/data_manager.py†L973-L999】【342f79†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py tests/components/pawcontrol/test_data_manager.py -q` – Die Datenmanager-Regression bestätigt, dass die getypten Konfigurationssequenzen und Budget-Snapshots weiterhin alle 58 Szenarien abdecken.【14ac35†L1-L6】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/__init__.py custom_components/pawcontrol/data_manager.py` – Die typisierten Setup- und Speicherpfade bestehen die Analyse ohne Restcasts.【f740b0†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_profile.py custom_components/pawcontrol/options_flow.py custom_components/pawcontrol/types.py` – Discovery-Bestätigungen, Profilformulare und Options-Flows verwenden jetzt `DiscoveryConfirmInput`, `ProfileSelectionInput` sowie `EntityProfileOptionsInput`, wodurch sämtliche neuen TypedDicts ohne Import-Konflikte lint-frei bleiben.【7d8cca†L1-L2】【F:custom_components/pawcontrol/config_flow.py†L429-L552】【F:custom_components/pawcontrol/config_flow_profile.py†L12-L86】【F:custom_components/pawcontrol/options_flow.py†L2207-L2258】【F:custom_components/pawcontrol/types.py†L1783-L1841】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Config-Flow-Regressionen decken die neuen Discovery-Confirm- und Profilpfade ab; alle 47 Szenarien für Modul-, Dashboard- und Discovery-Schritte bleiben grün.【0b2e34†L1-L11】【F:custom_components/pawcontrol/config_flow.py†L429-L552】【F:custom_components/pawcontrol/config_flow_profile.py†L34-L86】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/config_flow_profile.py custom_components/pawcontrol/options_flow.py custom_components/pawcontrol/types.py` – Die frisch eingeführten Discovery- und Profil-TypedDicts bestehen die strenge Typprüfung, inklusive des Options-Flow-Schemas für Vorschau-Schalter.【03e01f†L1-L1】【F:custom_components/pawcontrol/config_flow.py†L429-L552】【F:custom_components/pawcontrol/config_flow_profile.py†L34-L86】【F:custom_components/pawcontrol/options_flow.py†L2207-L2258】【F:custom_components/pawcontrol/types.py†L1783-L1841】
- ✅ `ruff check custom_components/pawcontrol/exceptions.py custom_components/pawcontrol/types.py tests/unit/test_exceptions.py` – Die Fehlerbasis serialisiert Kontextdaten jetzt über `_serialise_json_value` und gibt `ErrorPayload`-TypedDicts zurück, sodass Ausnahmen ohne `dict[str, Any]`-Fallbacks JSON-kompatible Telemetrie exportieren.【73ab88†L1-L2】【F:custom_components/pawcontrol/exceptions.py†L81-L189】【F:custom_components/pawcontrol/types.py†L85-L108】
- ✅ `PYTHONPATH=. pytest tests/unit/test_exceptions.py -q` – Neue Regressionen sichern die JSON-Normalisierung für Fehlerkontexte, GPS-Lokationen und den `handle_exception_gracefully`-Decorator.【b327c4†L1-L10】【F:tests/unit/test_exceptions.py†L18-L90】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/exceptions.py custom_components/pawcontrol/types.py tests/unit/test_exceptions.py` – Die erweiterten Fehler-TypedDicts und Generics bestehen die strenge Typprüfung ohne Zusatz-Casts.【4c1f09†L1-L1】【F:custom_components/pawcontrol/exceptions.py†L81-L213】
- ✅ `ruff check custom_components/pawcontrol/diagnostics.py custom_components/pawcontrol/script_manager.py custom_components/pawcontrol/types.py` – Die Setup-Flag-Diagnostik nutzt jetzt `SetupFlagsPanelPayload` und der Script-Manager liefert `ResilienceEscalationSnapshot`-Payloads, sodass beide Oberflächen ohne `dict[str, Any]`-Fallbacks lint-frei bleiben.【F:custom_components/pawcontrol/diagnostics.py†L296-L358】【F:custom_components/pawcontrol/script_manager.py†L2226-L2448】【F:custom_components/pawcontrol/types.py†L3917-L3936】【F:custom_components/pawcontrol/types.py†L4141-L4179】
- ✅ `PYTHONPATH=. pytest tests/unit/test_diagnostics_cache.py -q` – Die Cache-Diagnostik und das neue Setup-Flag-Panel laufen weiterhin grün, obwohl die Rückgaben jetzt TypedDicts verwenden.【6b0f2d†L1-L9】【F:custom_components/pawcontrol/diagnostics.py†L296-L358】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/diagnostics.py custom_components/pawcontrol/script_manager.py custom_components/pawcontrol/types.py` – Die neuen TypedDicts für Setup-Flags und Resilienz bestehen die strenge Typprüfung mitsamt den aktualisierten Script-Manager-Casts.【ae5b50†L1-L1】【F:custom_components/pawcontrol/script_manager.py†L2226-L2448】【F:custom_components/pawcontrol/types.py†L3917-L3936】【F:custom_components/pawcontrol/types.py†L4141-L4179】
- ✅ `ruff check tests/unit/test_script_manager_resilience.py custom_components/pawcontrol/script_manager.py` – Die neue Resilienz-Snapshot-Suite lintet sauber und bestätigt, dass die Script-Manager-Hilfen weiterhin ohne untypisierte Casts auskommen.【339e95†L1-L1】【F:tests/unit/test_script_manager_resilience.py†L1-L176】【F:custom_components/pawcontrol/script_manager.py†L2226-L2448】
- ✅ `PYTHONPATH=. pytest tests/unit/test_script_manager_resilience.py -q` – Die gezielte Regression deckt Listener-Zusammenführung, Schwellenwertableitung, manuelle Historien und JSON-Serialisierung des Snapshots vollständig ab.【6517c0†L1-L9】【F:tests/unit/test_script_manager_resilience.py†L35-L176】
- ✅ `ruff check custom_components/pawcontrol/optimized_entity_base.py custom_components/pawcontrol/coordinator_accessors.py custom_components/pawcontrol/coordinator.py custom_components/pawcontrol/types.py` – Der Koordinator liefert jetzt `CoordinatorModuleLookupResult`-Signaturen und die optimierten Entitäten normalisieren Modul-Caches über `_coerce_json_mutable`, wodurch getypte Modul- und JSON-Payloads ohne `dict[str, Any]`-Fallbacks verwaltet werden.【F:custom_components/pawcontrol/types.py†L4476-L4483】【F:custom_components/pawcontrol/coordinator_accessors.py†L54-L99】【F:custom_components/pawcontrol/coordinator.py†L447-L482】【F:custom_components/pawcontrol/optimized_entity_base.py†L321-L340】【F:custom_components/pawcontrol/optimized_entity_base.py†L861-L942】【e43a0f†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_coordinator.py -q` – Die Koordinator-Regression bestätigt, dass die neuen getypten Modulzugriffe weiterhin alle sieben Laufzeitfälle für Aktivierung, Lookup und Konfigurationsspiegelung abdecken.【F:custom_components/pawcontrol/coordinator.py†L447-L482】【ab903e†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_coordinator_observability.py -q` – Der Observability-Stack profitiert von den JSON-normalisierten Modul-Caches, ohne dass die bestehenden fünf Snapshot-Checks regressieren.【F:custom_components/pawcontrol/optimized_entity_base.py†L861-L942】【664934†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/coordinator.py custom_components/pawcontrol/coordinator_accessors.py custom_components/pawcontrol/optimized_entity_base.py custom_components/pawcontrol/types.py` – Die Literal-basierten Overloads und JSON-Koerzierung bestehen die Analyse ohne Slot- oder Rückgabefehler.【F:custom_components/pawcontrol/coordinator_accessors.py†L54-L99】【F:custom_components/pawcontrol/coordinator.py†L447-L482】【F:custom_components/pawcontrol/optimized_entity_base.py†L321-L340】【F:custom_components/pawcontrol/optimized_entity_base.py†L861-L942】【F:custom_components/pawcontrol/types.py†L4476-L4483】【6e18ac†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/feeding_manager.py` – Der FeedingManager verwendet jetzt `FeedingInitializationDogInput`, `FeedingDogRecord` und die spezialisierten Ergebnis-TypedDicts statt untypisierter `dict[str, Any]`-Payloads, sodass Diätvalidierung, Portionenneuberechnung und Notfallpfade strikt typisiert bleiben.【F:custom_components/pawcontrol/feeding_manager.py†L217-L403】【F:custom_components/pawcontrol/feeding_manager.py†L1345-L1700】
- ✅ `ruff check custom_components/pawcontrol/feeding_manager.py custom_components/pawcontrol/types.py tests/conftest.py tests/unit/test_feeding_manager.py` – Die neuen Feeding-Setup-Payloads, getypten Fixtures und Snapshot-Prüfungen bleiben lint-frei und dokumentieren die Telemetrie-Erweiterungen.【F:custom_components/pawcontrol/feeding_manager.py†L1153-L1164】【F:custom_components/pawcontrol/types.py†L2860-L2874】【F:tests/conftest.py†L58-L118】【F:tests/conftest.py†L476-L508】【F:tests/unit/test_feeding_manager.py†L653-L721】【4d5217†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_manager.py -q` – Die Feeding-Suite verifiziert die neuen Snapshot- und Event-Strukturprüfungen zusammen mit den getypten Fixtures für Initialisierung, Statistiken und Telemetrie.【F:tests/unit/test_feeding_manager.py†L235-L299】【F:tests/unit/test_feeding_manager.py†L653-L721】【9216e4†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_manager.py -k TestHealthDataUpdates -q` – Die neuen Health-Regressionen belegen die Float-Koerzierung und Null-Rücksetzungen von `async_update_health_data` direkt an den TypedDict-Payloads.【F:custom_components/pawcontrol/feeding_manager.py†L2724-L2764】【F:tests/unit/test_feeding_manager.py†L598-L645】
- ✅ `ruff check tests/unit/test_feeding_manager.py` – Die Suite `TestFeedingModeScheduling` sichert temporäre Aktivitäts- und Notfallpfade samt Timer-Flags, während Task-Patches Endlosschleifen für Reminder vermeiden.【F:tests/unit/test_feeding_manager.py†L1-L590】【2c826b†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_manager.py -k TestFeedingModeScheduling -q` – Die Regression bestätigt, dass `reversion_scheduled` und `restoration_scheduled` gesetzt bleiben und die Wiederherstellungs-Tasks sauber abschließen.【F:tests/unit/test_feeding_manager.py†L485-L590】【887eec†L1-L8】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/feeding_manager.py` – Die neuen Feeding-TypedDicts und Konvertierungen passieren die strenge Analyse ohne zusätzliche Casts.【aef3f3†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/utils.py` – Service- und Event-Helfer nutzen jetzt `ServiceCallKeywordArgs`, `FireEventKeywordArgs` und `_coerce_json_mutable`, sodass `async_call_hass_service_if_available`, `async_fire_event`, `merge_configurations` und `validate_configuration_schema` JSON-typisierte Payloads ohne `dict[str, Any]`-Fallbacks verarbeiten.【F:custom_components/pawcontrol/utils.py†L189-L239】【F:custom_components/pawcontrol/utils.py†L242-L253】【F:custom_components/pawcontrol/utils.py†L1572-L1626】【442404†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/config_flow_dashboard_extension.py custom_components/pawcontrol/config_flow_external.py custom_components/pawcontrol/config_flow_dogs.py custom_components/pawcontrol/types.py` – Die Config-Flow-Schritte verwenden jetzt `MutableConfigFlowPlaceholders`, wodurch sämtliche Beschreibungsplatzhalter typisiert sind und ohne `dict[str, Any]`-Fallbacks an Home Assistant übergeben werden.【F:custom_components/pawcontrol/types.py†L1007-L1009】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L109-L117】【F:custom_components/pawcontrol/config_flow_external.py†L146-L154】【F:custom_components/pawcontrol/config_flow_dogs.py†L320-L333】【c6d5ed†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_external.py tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Config-Flow-Regressionen bestätigen, dass die getypten Platzhalter weiterhin alle 49 Szenarien für Dashboard-, Dog- und External-Entitäten abdecken.【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L320-L333】【F:custom_components/pawcontrol/config_flow_external.py†L146-L154】【F:custom_components/pawcontrol/config_flow_dogs.py†L320-L333】【43b76c†L1-L7】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_utils.py -q` – Die Utility-Suite bestätigt, dass die getypten Service-Aufrufe, Event-Keywords und Schema-Validatoren weiterhin alle acht Szenarien abdecken.【F:tests/components/pawcontrol/test_utils.py†L26-L170】【23a389†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/utils.py tests/components/pawcontrol/test_utils.py` – Die neuen TypedDicts, JSON-Kopierer und Schema-Validierer bestehen die Typprüfung ohne zusätzliche Cast-Ausnahmen.【F:custom_components/pawcontrol/utils.py†L189-L239】【F:custom_components/pawcontrol/utils.py†L1572-L1626】【b39fc1†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/services.py custom_components/pawcontrol/types.py tests/unit/test_services.py` – Die Service-Telemetrie nutzt jetzt `ServiceDetailsPayload` und `_coerce_service_details_value`, um Diagnosen und Metadaten JSON-kompatibel aufzubereiten, während Daily-Reset-Erfolg und -Fehler ohne `dict[str, Any]`-Fallbacks persistieren.【F:custom_components/pawcontrol/types.py†L262-L269】【F:custom_components/pawcontrol/services.py†L409-L520】【F:custom_components/pawcontrol/services.py†L4852-L4920】【d47e02†L1-L3】
- ✅ `ruff check tests/unit/test_services.py` – Die Service-Testmodule bleiben lint-frei und decken jetzt auch komplex verschachtelte Detail-Payloads und Daily-Reset-Metadaten ab.【F:tests/unit/test_services.py†L133-L167】【F:tests/unit/test_services.py†L1099-L1156】【F:tests/unit/test_services.py†L1159-L1197】【7ca293†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_services.py -q` – Die Services-Suite bestätigt neben Notification- und Garden-Pfaden auch die neuen Normalisierungen für komplexe Service-Details und Daily-Reset-Metadaten.【F:tests/unit/test_services.py†L133-L167】【F:tests/unit/test_services.py†L1099-L1156】【F:tests/unit/test_services.py†L1159-L1197】【be3932†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/services.py custom_components/pawcontrol/types.py` – Die neuen JSON-Helfer bestehen die Typprüfung ohne Cast-Ausnahmen und halten Service-Details sowie Daily-Reset-Metadaten streng typisiert.【F:custom_components/pawcontrol/types.py†L262-L269】【F:custom_components/pawcontrol/services.py†L409-L520】【F:custom_components/pawcontrol/services.py†L4852-L4920】【b30a86†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/services.py tests/unit/test_services.py` – Route-Export-Service und GPS-Manager-Stubs bleiben lint-frei, inklusive Guard-Initialisierung für benachrichtigungsfreie Exporte.【F:custom_components/pawcontrol/services.py†L2161-L2228】【F:tests/unit/test_services.py†L1783-L1935】【3e56a8†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_services.py -q` – Die Suite deckt jetzt Mehrfach-Routen- und Leerhistorien für `gps_export_route` ab und bestätigt die Telemetrie-Details.【F:tests/unit/test_services.py†L1783-L1935】【0a9324†L1-L9】
- ✅ `ruff check tests/unit/test_fixture_usage_guard.py` – Die erweiterten Loader-Heuristiken für verschachtelte `parents[index]`-Pfadketten bleiben lint-frei, nachdem `with_segments`- und `resolve().joinpath()`-Varianten registriert werden.【F:tests/unit/test_fixture_usage_guard.py†L640-L644】【F:tests/unit/test_fixture_usage_guard.py†L2227-L2255】
- ✅ `PYTHONPATH=. pytest tests/unit/test_fixture_usage_guard.py -q` – Neue Regressionen decken `parents[index].with_segments(...).open_text()` sowie `parents[index].resolve().joinpath(...).open_text()` ab und schlagen bei verbotenen Fixtures zuverlässig an.【F:tests/unit/test_fixture_usage_guard.py†L3190-L3239】【5a8e7a†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/services.py tests/unit/test_services.py` – Die angepassten Stubs und die Guard-Initialisierung bestehen die Typprüfung ohne Zusatz-Casts.【F:custom_components/pawcontrol/services.py†L2161-L2228】【F:tests/unit/test_services.py†L1783-L1935】【b7cd4a†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/types.py` – Der finale Setup-Schritt verwendet jetzt `FinalSetupValidationResult`, `ConfigEntryDataPayload` und `ConfigEntryOptionsPayload`, wodurch Validierungs- und Persistenzpfade ohne `dict[str, Any]`-Fallbacks lint-frei bleiben.【F:custom_components/pawcontrol/config_flow.py†L1628-L1805】【F:custom_components/pawcontrol/types.py†L1909-L1940】【0026e2†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py tests/components/pawcontrol/test_config_flow.py -q` – Die Config-Flow-Suite bestätigt, dass der typisierte Finalisierungs- und Discovery-Pfad weiterhin alle 47 Szenarien abdeckt.【F:custom_components/pawcontrol/config_flow.py†L1628-L1805】【89effb†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/config_flow.py custom_components/pawcontrol/types.py` – Die neuen TypedDicts für Finalvalidierung und Entry-Payloads bestehen die strenge Analyse ohne zusätzliche Casts.【F:custom_components/pawcontrol/config_flow.py†L1628-L1805】【F:custom_components/pawcontrol/types.py†L1909-L1940】【476337†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/__init__.py custom_components/pawcontrol/binary_sensor.py custom_components/pawcontrol/button.py custom_components/pawcontrol/device_tracker.py custom_components/pawcontrol/types.py` – YAML-Setup, Button- und Binärsensor-Plattformen sowie der GPS-Tracker verwenden jetzt `ConfigType`, `JSONMapping` und das getypte `DoorSensorSettingsPayload`, wodurch die bisherigen `dict[str, Any]`-Casts entfallen.【F:custom_components/pawcontrol/__init__.py†L60-L78】【F:custom_components/pawcontrol/__init__.py†L457-L459】【F:custom_components/pawcontrol/button.py†L96-L105】【F:custom_components/pawcontrol/button.py†L639-L645】【F:custom_components/pawcontrol/binary_sensor.py†L42-L61】【F:custom_components/pawcontrol/binary_sensor.py†L242-L259】【F:custom_components/pawcontrol/device_tracker.py†L45-L113】【F:custom_components/pawcontrol/device_tracker.py†L552-L563】【F:custom_components/pawcontrol/types.py†L4983-L5145】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_binary_sensor.py tests/unit/test_device_tracker.py -q` – Die Plattform-Regressionen bestätigen, dass die getypten Visitor-/Service-Pfade weiterhin alle neun Szenarien abdecken.【c61fb7†L1-L10】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/__init__.py custom_components/pawcontrol/binary_sensor.py custom_components/pawcontrol/button.py custom_components/pawcontrol/device_tracker.py custom_components/pawcontrol/types.py` – Die aktualisierten JSON- und Door-Sensor-Signaturen bestehen die statische Analyse ohne zusätzliche Casts.【fd2cc8†L1-L1】
- ✅ `python script/check_typed_dicts.py --path tests` – Der aktuelle Lauf reduziert die offenen `dict[str, Any]`-/`Mapping[str, Any]`-Fundstellen auf 185 (−8) und bestätigt, dass vor allem Blueprint-Kontexte, Flow-Stubs und Test-Hilfen weiter zu typisieren sind.【0d8bc8†L1-L185】
- ✅ `python script/check_typed_dicts.py --path tests` – Der jüngste Lauf reduziert die offenen `dict[str, Any]`-/`Mapping[str, Any]`-Fundstellen weiter auf 92 (−93 seit der Blueprint-Härtung) und bestätigt, dass nur noch Data-Manager- und Missing-Telemetry-Regressionsstubs untypisiert sind.【b3eef5†L1-L6】
- ✅ `python script/check_typed_dicts.py --path tests` – Der aktuelle Lauf meldet erneut keine Treffer, nachdem die Missing-Sensor-Telemetrie nun `Mapping[str, object]`-Overrides nutzt und die Data-Manager-Regressionen getypte Cache-Registrar- sowie Event-Listener-Schnittstellen ohne `dict[str, Any]`-Fallbacks einsetzen.【F:tests/unit/test_missing_sensor_telemetry.py†L1-L86】【F:tests/unit/test_data_manager.py†L1-L210】【cd5691†L1-L1】
- ✅ `python script/check_typed_dicts.py --path tests` – Der aktuelle Lauf meldet keine untypisierten Dictionary-Aliase mehr; der Audit bleibt als Monitoring-Guard aktiv, um neue Helper- oder Flow-Stubs sofort aufzuspüren.【de3bff†L2-L2】
- ✅ **Runtime-Manager- & Service-Guard-Regressionen typisiert:** Die Container- und Service-Wächter-Tests nutzen jetzt `DogConfigData`, `CoordinatorDogData`, `GardenModulePayload` sowie `JSONMutableMapping`, wodurch alle Laufzeit- und Metrik-Stubs ohne `dict[str, Any]`-Fallbacks auskommen und Notifications-Stubs per Cast den Produktivtyp implementieren.【F:tests/unit/test_runtime_manager_container_usage.py†L1-L208】【F:tests/unit/test_service_guard.py†L1-L80】
- ✅ `ruff check custom_components/pawcontrol/gps_manager.py custom_components/pawcontrol/select.py custom_components/pawcontrol/services.py custom_components/pawcontrol/types.py tests/unit/test_gps_manager.py tests/unit/test_services.py` – GPS-Konfigurations- und Geofence-Benachrichtigungen laufen jetzt vollständig über `GPSTrackingConfigInput`, `GeofenceEventPayload` und `GeofenceNotificationData`, womit die letzten `dict[str, Any]`-Fälle im Manager und den Tests verschwinden.【F:custom_components/pawcontrol/types.py†L2610-L2655】【F:custom_components/pawcontrol/gps_manager.py†L263-L313】【F:custom_components/pawcontrol/gps_manager.py†L424-L437】【F:custom_components/pawcontrol/gps_manager.py†L1160-L1236】【11edd3†L1-L4】
- ✅ `PYTHONPATH=. pytest tests/unit/test_gps_manager.py tests/unit/test_services.py -q` – Die GPS- und Service-Suiten prüfen die neuen TypedDict-Konfigurationen, Stubs und Casts, sodass Geofence-Benachrichtigungen und Automations-Setups weiterhin alle 98 Szenarien bestehen.【F:tests/unit/test_gps_manager.py†L50-L96】【F:tests/unit/test_gps_manager.py†L314-L353】【F:tests/unit/test_gps_manager.py†L739-L858】【F:tests/unit/test_services.py†L597-L665】【21aad5†L1-L6】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/gps_manager.py custom_components/pawcontrol/select.py custom_components/pawcontrol/services.py custom_components/pawcontrol/types.py` – Die neuen GPS-TypedDicts und Casts bestehen die statische Analyse ohne Zusatz-Casts und halten die Manager-Schnittstellen streng typisiert.【F:custom_components/pawcontrol/types.py†L2610-L2655】【F:custom_components/pawcontrol/gps_manager.py†L263-L313】【F:custom_components/pawcontrol/select.py†L742-L776】【F:custom_components/pawcontrol/services.py†L2249-L2263】【d7fc9d†L1-L1】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip tests/unit/test_gps_manager.py tests/unit/test_services.py` – GPS- und Service-Suites tragen nun vollständige Fixture- und Stub-Typannotationen, inklusive strikt getypter Notification-Manager-Vererbung und Casting der Compliance-Payloads, sodass der Guard ohne Beanstandung läuft.【F:tests/unit/test_gps_manager.py†L35-L120】【F:tests/unit/test_services.py†L597-L665】【F:tests/unit/test_services.py†L1889-L1894】【F:tests/unit/test_services.py†L2163-L2165】
- ✅ `ruff check custom_components/pawcontrol/coordinator_observability.py tests/unit/test_coordinator_observability.py` – Die Observability-Helfer normalisieren die Resilienzlisten jetzt über `_normalise_resilience_summary` und `_coerce_string_list`, ziehen Ablehnungsmetriken per `_apply_rejection_metrics_to_performance` in die Snapshot-Payload und vermeiden dadurch `dict[str, Any]`-Casts. 【a2e347†L1-L2】【F:custom_components/pawcontrol/coordinator_observability.py†L33-L274】
- ✅ `PYTHONPATH=. pytest tests/unit/test_coordinator_observability.py -q` – Die Suite bestätigt, dass die neuen Listennormalisierer leere Brecherlisten korrekt liefern und gleichzeitig die Ablehnungszähler ohne Schema-Version in den Leistungsmetriken bleiben. 【d1f42d†L1-L9】【F:tests/unit/test_coordinator_observability.py†L140-L214】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/coordinator_observability.py tests/unit/test_coordinator_observability.py` – Die Literal-gesteuerten Listenfelder und TypedDict-Helfer bestehen die Analyse ohne `dict[str, Any]`-Fallbacks. 【f439c5†L1-L1】【F:custom_components/pawcontrol/coordinator_observability.py†L33-L274】
- ✅ `ruff check custom_components/pawcontrol/text.py custom_components/pawcontrol/types.py` – Die Text-Entities geben ihre Zusatzattribute jetzt über das neue `TextEntityExtraAttributes`-Schema zurück, wodurch sowohl Linting als auch Payload-Typisierung ohne `dict[str, Any]`-Fallbacks auskommen.【ee1683†L1-L2】【F:custom_components/pawcontrol/text.py†L258-L266】【F:custom_components/pawcontrol/types.py†L107-L113】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/text.py custom_components/pawcontrol/types.py` – Das frisch eingeführte TypedDict passiert die strenge Analyse ohne Cast-Ausnahmen oder optionale Schlüsselverletzungen.【22c2bc†L1-L2】【F:custom_components/pawcontrol/text.py†L258-L266】【F:custom_components/pawcontrol/types.py†L107-L113】
- ✅ `ruff check custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/types.py tests/unit/test_options_flow.py` – Die Door-Sensor-Telemetrie nutzt jetzt `DoorSensorSettingsPayload`, `RuntimeErrorHistoryEntry` und das History-Alias, sodass sowohl Fehlerspeicher als auch Runtime-Stats ohne `dict[str, Any]`-Fallbacks arbeiten.【16b500†L1-L3】【F:custom_components/pawcontrol/telemetry.py†L451-L525】【F:custom_components/pawcontrol/types.py†L4868-L4890】【F:custom_components/pawcontrol/types.py†L4970-L4986】
- ✅ `PYTHONPATH=. pytest tests/unit/test_options_flow.py -q` – Die Options-Flow-Regression deckt den getypten Fehlerhistorien-Eintrag ab, bestätigt den neuen `runtime_cache_unavailable`-Pfad und hält die Persistenz-Telemetrie stabil.【F:tests/unit/test_options_flow.py†L1610-L1739】【07a227†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/types.py` – Die neuen TypedDicts und das Fehlerhistorien-Alias passieren die statische Analyse ohne zusätzliche Casts.【9970ea†L1-L2】【F:custom_components/pawcontrol/telemetry.py†L451-L525】【F:custom_components/pawcontrol/types.py†L4868-L4890】
- ✅ `ruff check custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/diagnostics.py tests/unit/test_telemetry_door_sensor.py` – Die Door-Sensor-Telemetrie führt jetzt pro Hund aggregierte Failure-Summaries mit `DoorSensorFailureSummary`, aktualisiert Diagnoseausgaben und sichert durch eine dedizierte Suite die Zähler- und Trimm-Logik.【F:custom_components/pawcontrol/telemetry.py†L451-L538】【F:custom_components/pawcontrol/diagnostics.py†L1269-L1309】【F:tests/unit/test_telemetry_door_sensor.py†L1-L230】【f8ea0d†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_telemetry_door_sensor.py -q` – Die neuen Regressionen prüfen aggregierte Failure-Zähler, Snapshot-Erhalt über Limits hinweg und den Update-Pfad für wiederholte Persistenzfehler.【F:tests/unit/test_telemetry_door_sensor.py†L35-L230】【d34531†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/telemetry.py custom_components/pawcontrol/diagnostics.py tests/unit/test_telemetry_door_sensor.py` – Aggregierte Failure-Summaries integrieren sich ohne Cast-Suppression in Telemetrie und Diagnostik und halten die Tests strikt typisiert.【F:custom_components/pawcontrol/telemetry.py†L451-L538】【F:custom_components/pawcontrol/diagnostics.py†L1269-L1309】【F:tests/unit/test_telemetry_door_sensor.py†L1-L230】【f39733†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/helper_manager.py custom_components/pawcontrol/types.py` – Die Helper-Erzeugung nutzt jetzt `InputBooleanCreateServiceData`, `InputDatetimeCreateServiceData`, `InputNumberCreateServiceData` und `InputSelectCreateServiceData`, sodass sämtliche Service-Aufrufe typisierte Payloads statt `dict[str, Any]` verwenden.【F:custom_components/pawcontrol/helper_manager.py†L684-L866】【F:custom_components/pawcontrol/types.py†L2061-L2097】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py -q` – Die Helper-Manager-Szenarien behalten ihre Guard-Metriken und Entitätsregistrierungen mit den neuen Service-Payloads bei.【4371e5†L1-L5】【F:custom_components/pawcontrol/helper_manager.py†L684-L867】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/helper_manager.py custom_components/pawcontrol/types.py` – Die typisierten Helper-Service-Payloads bestehen die strenge Analyse ohne Casts oder Lockerungen.【a44b7c†L1-L2】【F:custom_components/pawcontrol/types.py†L2061-L2097】
- ✅ `ruff check custom_components/pawcontrol/dashboard_generator.py tests/unit/test_dashboard_generator.py` – Der Generator setzt jetzt Dashboard-Metadaten, Optionskopien und Wetter-Dashboards strikt auf `DashboardRendererOptions`, `DashboardRenderResult` und JSON-Mappings ohne `dict[str, Any]`-Fallbacks, wodurch die Lovelace-Payloads typsicher bleiben.【F:custom_components/pawcontrol/dashboard_generator.py†L133-L207】【F:custom_components/pawcontrol/dashboard_generator.py†L440-L507】【F:custom_components/pawcontrol/dashboard_generator.py†L726-L930】【F:custom_components/pawcontrol/dashboard_generator.py†L1668-L2091】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_generator.py -q` – Die bestehende Suite bestätigt, dass die getypten Options- und JSON-Pfade des Generators weiterhin alle Szenarien abdecken.【fea366†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/dashboard_generator.py` – Die neuen TypedDict-Signaturen für Metadatenkopien, Wetter-Dashboards und JSON-Persistenz bestehen die strenge Typprüfung ohne Cast-Suppressions.【d4d452†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/notifications.py tests/unit/test_notifications.py` – Die Benachrichtigungsverwaltung nutzt jetzt dedizierte TypedDicts für Eingabekonfigurationen, Service-Payloads und Webhook-Ergebnisse, sodass die Lint-Prüfung ohne Lockerungen durchläuft.【F:custom_components/pawcontrol/notifications.py†L113-L220】【F:custom_components/pawcontrol/notifications.py†L241-L327】
- ✅ `PYTHONPATH=. pytest tests/unit/test_notifications.py -q` – Die überarbeiteten Stubs liefern typisierte Personenkontexte und Statistiken, wodurch alle 53 Benachrichtigungstests weiterhin erfolgreich bleiben.【F:tests/unit/test_notifications.py†L83-L205】【d4c413†L1-L3】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/notifications.py` – `NotificationConfigInputMap` und die getypten Default-Fabriken halten die statische Analyse ohne Cast-Warnungen stabil.【F:custom_components/pawcontrol/notifications.py†L170-L180】【F:custom_components/pawcontrol/notifications.py†L835-L912】
- ✅ `ruff check custom_components/pawcontrol/weather_manager.py custom_components/pawcontrol/weather_translations.py tests/unit/test_weather_manager_translations.py` – Der neue `_parse_translation_key` begrenzt Wetter- und Empfehlungspfade auf die Literal-Schlüssel, während `ActivityType` und `PRIMARY_ACTIVITIES` die Planungs- und Fallback-Pfade ohne `str`-Ausreißer typisieren.【F:custom_components/pawcontrol/weather_manager.py†L96-L108】【F:custom_components/pawcontrol/weather_manager.py†L471-L607】【F:custom_components/pawcontrol/weather_translations.py†L315-L330】
- ✅ `ruff check tests/unit/test_weather_manager_data.py custom_components/pawcontrol/module_adapters.py` – Die Fallback-Tests prüfen jetzt fehlende Übersetzungs-Schlüssel, fehlerhafte Platzhalter sowie Temperatur- und State-Fallbacks, sodass Manager und Adapter lint-frei bleiben.【F:tests/unit/test_weather_manager_data.py†L1-L317】【F:custom_components/pawcontrol/weather_manager.py†L511-L542】【F:custom_components/pawcontrol/module_adapters.py†L780-L919】
- ✅ `PYTHONPATH=. pytest tests/unit/test_weather_manager_translations.py -q` – Die Tests prüfen jetzt den getypten Parser, fehlende Alert-Schlüssel sowie die Guard-Rails für ungültige Segmente und behalten die lokalen/englischen Fallbacks bei.【F:tests/unit/test_weather_manager_translations.py†L152-L222】
- ✅ `PYTHONPATH=. pytest tests/unit/test_weather_manager_data.py -q` – Die Suite speist reale Wetter-States ein, deckt Heat-Index-Alerts, Übersetzungs-Fallbacks (fehlende Schlüssel, Formatierungsfehler) sowie Adapter-Snapshots ab und hält alle Pfade grün.【F:tests/unit/test_weather_manager_data.py†L43-L317】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/weather_manager.py custom_components/pawcontrol/weather_translations.py tests/unit/test_weather_manager_translations.py` – TypedDict-Schlüsselkonstanten, ActivityType-Aliase und die streng typisierte Resolver-Schnittstelle bestehen die Analyse ohne Suppressions.【F:custom_components/pawcontrol/weather_manager.py†L96-L607】【F:custom_components/pawcontrol/weather_translations.py†L315-L330】【F:tests/unit/test_weather_manager_translations.py†L152-L222】
- ✅ `ruff check custom_components/pawcontrol/weather_translations.py custom_components/pawcontrol/weather_manager.py tests/unit/test_weather_manager_translations.py` – Die Wetterübersetzungen nutzen jetzt Literal-Schlüssel für Alerts und Empfehlungen, während der Resolver nur noch typisierte Katalogeinträge akzeptiert.【F:custom_components/pawcontrol/weather_translations.py†L1-L119】【F:custom_components/pawcontrol/weather_manager.py†L502-L570】【b5faa1†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_weather_manager_translations.py -q` – Die Suite bleibt grün und bestätigt, dass Literal-Schlüssel weiterhin korrekt aufgelöst und auf englische Fallbacks zurückfallen.【F:tests/unit/test_weather_manager_translations.py†L1-L109】【a388fb†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/weather_manager.py custom_components/pawcontrol/weather_translations.py tests/unit/test_weather_manager_translations.py` – Die Literal-Schlüssel halten die strenge Typprüfung stand und verhindern untypisierte Lookup-Pfade.【F:custom_components/pawcontrol/weather_translations.py†L1-L119】【F:custom_components/pawcontrol/weather_manager.py†L523-L570】【4bad12†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/weather_manager.py tests/unit/test_weather_manager_translations.py` – Der spezialisierte Übersetzungsresolver nutzt jetzt `WeatherAlertTranslations`/`WeatherRecommendationTranslations` statt generischer Mappings, validiert Abschnitts- und Feldpfade strikt und fällt bei nicht-stringigen Blättern auf Englisch zurück.【F:custom_components/pawcontrol/weather_manager.py†L40-L118】【F:custom_components/pawcontrol/weather_manager.py†L452-L547】
- ✅ `PYTHONPATH=. pytest tests/unit/test_weather_manager_translations.py -q` – Die Suite deckt den neuen Abschnitts-Guard (`unknown` → ValueError) neben den bestehenden lokalen, Fallback- und Mapping-Pfaden ab.【F:tests/unit/test_weather_manager_translations.py†L63-L209】
- ✅ `ruff check custom_components/pawcontrol/weather_manager.py tests/unit/test_weather_manager_translations.py` – Die neuen Übersetzungs-Tests prüfen lokalisierte Titel, englische Fallbacks und die Fehlerbehandlung bei unvollständigen Platzhaltern direkt gegen den Manager-Resolver; die Wetterattribute nutzen jetzt Forecast-/Entity-TypedDicts und PEP-695-Severity-Maps statt `Mapping[str, object]`.【F:custom_components/pawcontrol/weather_manager.py†L52-L123】【F:custom_components/pawcontrol/weather_manager.py†L358-L432】【F:tests/unit/test_weather_manager_translations.py†L1-L165】【980ace†L1-L2】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/weather_manager.py tests/unit/test_weather_manager_translations.py` – Die Forecast- und Entity-TypedDicts sowie die generischen Severity-Maps bestehen die statische Analyse ohne Cast-Suppressions und sichern den Übersetzungsresolver weiter ab.【F:custom_components/pawcontrol/weather_manager.py†L52-L167】【F:tests/unit/test_weather_manager_translations.py†L1-L165】
- ✅ `ruff check tests/unit/test_weather_manager_translations.py` – Die Suite importiert `Enum`/`MagicMock` explizit und prüft zusätzlich, dass Mapping-Blätter zurück auf englische Strings fallen, statt ValueErrors auszulösen.【F:tests/unit/test_weather_manager_translations.py†L1-L144】【8c717b†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_weather_manager_translations.py -q` – Mit neun Tests belegen wir die neuen Mapping-Fallbacks neben den bestehenden lokalen und englischen Pfaden.【F:tests/unit/test_weather_manager_translations.py†L63-L180】【fad337†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_weather_manager_translations.py -q` – Die dedizierte Suite deckt lokale und fallback-basierte Auflösungen, Fehlformatierungen sowie Mapping-Validerungen für `_resolve_translation_value` ab.【F:tests/unit/test_weather_manager_translations.py†L63-L165】【0cc826†L1-L8】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip tests/unit/test_weather_manager_translations.py` – Die Test-Fixture und die Stub-Nachrüstungen für Wetter- und Temperaturkonstanten bestehen die Typprüfung ohne zusätzliche Ausnahmen.【F:tests/unit/test_weather_manager_translations.py†L5-L165】【b88c1d†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/feeding_translations.py custom_components/pawcontrol/repairs.py custom_components/pawcontrol/types.py tests/unit/test_feeding_translations.py` – Die Feeding-Übersetzer akzeptieren jetzt das Mapping-Alias `FeedingComplianceDisplayMapping`, normalisieren Sequenzen typisiert und aktualisieren die Repair-Aufrufe ohne `dict[str, Any]`-Fallbacks.【F:custom_components/pawcontrol/feeding_translations.py†L359-L559】【F:custom_components/pawcontrol/types.py†L3724-L3735】【F:custom_components/pawcontrol/repairs.py†L213-L235】【0fba5e†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_translations.py -q` – Die erweiterten Tests sichern, dass optionale Nachrichtentexte auf `None` geprüft werden, bevor Zeichenkettenoperationen laufen, und decken Byte-, Mapping- und Generator-Empfehlungen sowie Issue-Payloads vollständig ab.【F:tests/unit/test_feeding_translations.py†L122-L520】【70bd8b†L1-L8】
- ✅ `python -m script.enforce_test_requirements` – Keine neuen Testabhängigkeiten für die Feeding-Übersetzungsanpassungen erforderlich.【9d799f†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/feeding_translations.py custom_components/pawcontrol/repairs.py tests/unit/test_feeding_translations.py` – Die neuen Mapping-Aliase, Sequenz-Casts und Test-Assertions bestehen die strenge Typprüfung ohne `Any`-Fälle.【F:custom_components/pawcontrol/feeding_translations.py†L359-L559】【F:custom_components/pawcontrol/repairs.py†L213-L235】【F:tests/unit/test_feeding_translations.py†L122-L520】【86e112†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/entity_factory.py custom_components/pawcontrol/sensor.py tests/components/pawcontrol/test_entity_performance.py tests/components/pawcontrol/test_entity_performance_scaling.py` – Die Entity-Factory nutzt jetzt Mapping-basierte Dataklassen für Profile, Leistungsmetriken und Konfigurations-Payloads, während Sensor-Logs direkt auf die typisierte Profilstruktur zugreifen.【F:custom_components/pawcontrol/entity_factory.py†L95-L339】【F:custom_components/pawcontrol/sensor.py†L707-L728】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_profiles.py tests/components/pawcontrol/test_entity_performance.py tests/components/pawcontrol/test_entity_performance_scaling.py tests/test_entity_factory_guardrails.py -q` – Die aktualisierten Performance- und Skalierungstests akzeptieren die neuen Mapping-Rückgaben und sichern, dass Budgeting, Konfigurations- und Metrik-Mappings weiterhin stabil funktionieren.【F:tests/components/pawcontrol/test_entity_performance.py†L232-L334】【F:tests/components/pawcontrol/test_entity_performance_scaling.py†L332-L351】【883e43†L1-L5】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/entity_factory.py custom_components/pawcontrol/sensor.py` – Die neuen PEP-695-Aliase und Mapping-Dataklassen bestehen die strenge Typprüfung ohne `dict[str, Any]`-Fallbacks.【F:custom_components/pawcontrol/entity_factory.py†L95-L339】【64dccd†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/config_flow_external.py tests/unit/test_config_flow_external.py` – Die externe Entitätenkonfiguration nutzt jetzt `ExternalEntitySelectorOption`-TypedDicts und strikt typisierte Flow-Eingaben, sodass Voluptuous-Optionen ohne `dict[str, Any]`-Fallbacks auskommen.【F:custom_components/pawcontrol/config_flow_external.py†L34-L205】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_external.py -q` – Die neuen Flow-Tests prüfen valide sowie fehlerhafte Notify-Auswahlen gegen den TypedDict-basierten Validator und die Schema-Platzhalter.【F:tests/unit/test_config_flow_external.py†L1-L142】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/config_flow_external.py tests/unit/test_config_flow_external.py` – Die streng typisierten Flow- und Test-Stubs passieren die Typprüfung ohne zusätzliche Cast-Ausnahmen.【F:custom_components/pawcontrol/config_flow_external.py†L34-L205】【F:tests/unit/test_config_flow_external.py†L1-L142】
- ✅ `ruff check custom_components/pawcontrol/utils.py tests/components/pawcontrol/test_utils.py` – Die JSON-Helfer nutzen jetzt PEP-695-Generics und JSONMutableMapping-Zweige, sodass Deep-Merge-, Nested-Set-, Flatten- und Merge-Protection-Pfade ohne `Any`-Fallbacks laufen und von den erweiterten Utility-Tests abgedeckt werden.【F:custom_components/pawcontrol/utils.py†L709-L775】【F:custom_components/pawcontrol/utils.py†L1188-L1225】【F:tests/components/pawcontrol/test_utils.py†L26-L218】【8b310b†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_utils.py -q` – Die Utility-Suite prüft asynchrone und synchrone Retry-Wrapper, JSON-Flatten-Roundtrips, die verschärfte Nested-Setter-Validierung sowie den Merge-Konfigurationsschutz erfolgreich.【F:tests/components/pawcontrol/test_utils.py†L26-L218】【cca639†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_utils.py -k test_merge_configurations_nested_mappings_and_protected_keys -q` – Der zielgerichtete Lauf belegt, dass verschachtelte JSON-Merges geschützte Schlüssel bewahren und die Warnung ausgegeben wird.【F:tests/components/pawcontrol/test_utils.py†L176-L218】【28ca19†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Testabhängigkeiten für die erweiterten Utility-Checks erforderlich.【ccc454†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/utils.py tests/components/pawcontrol/test_utils.py` – Die neuen JSON-Generics und Test-Casts bestehen die strengen Typprüfungen ohne Suppressions.【F:custom_components/pawcontrol/utils.py†L709-L775】【F:custom_components/pawcontrol/utils.py†L1188-L1225】【F:tests/components/pawcontrol/test_utils.py†L26-L170】【a03d1d†L1-L2】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Scheitert weiterhin im Container, da das vendorte PyYAML-Modul nicht verfügbar ist.【a71825†L1-L27】
- ✅ `ruff check custom_components/pawcontrol/select.py tests/components/pawcontrol/test_select_entities.py` – Die Select-Plattform nutzt jetzt MappingProxyType-gestützte Detailtabellen, ein JSON-Merge-Hilfswerkzeug und strengeres Attribut-Building, während die Test-Stubs Koordinator-Laufzeitdaten typisiert aufbauen.【F:custom_components/pawcontrol/select.py†L103-L847】【F:tests/components/pawcontrol/test_select_entities.py†L1-L200】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_select_entities.py -q` – Die Select-Entity-Suite prüft persistente GPS- und Benachrichtigungsupdates mit den neuen TypedDict-Kopien und Coordinator-Runtime-Containern.【F:tests/components/pawcontrol/test_select_entities.py†L110-L200】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/select.py tests/components/pawcontrol/test_select_entities.py` – MappingProxyType-Konstanten, JSON-Merges und die Koordinator-Stubs bestehen die Typprüfung ohne Any-Fallbacks.【F:custom_components/pawcontrol/select.py†L103-L847】【F:tests/components/pawcontrol/test_select_entities.py†L1-L200】
- ✅ `ruff check custom_components/pawcontrol/helper_manager.py custom_components/pawcontrol/types.py tests/unit/test_data_manager.py` – Der Helper-Manager nutzt jetzt `_HelperGuardMetricsState`, `HelperEntityMetadata*` und typisierte Snapshot-Builds, sodass Cache- und Dienstmetriken ohne `dict[str, Any]` exportiert werden und die Tests das neue Metadata-Contract casten.【F:custom_components/pawcontrol/helper_manager.py†L77-L299】【F:custom_components/pawcontrol/helper_manager.py†L684-L924】【F:custom_components/pawcontrol/types.py†L2054-L2076】【F:tests/unit/test_data_manager.py†L323-L354】【16edff†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py -q` – Die Datenmanager-Suite bleibt grün und verifiziert die getypten Helper-Diagnosen samt Guard-Metriken.【e373cf†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Testabhängigkeiten für die Helper-Typisierung erforderlich.【6061d5†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/helper_manager.py custom_components/pawcontrol/types.py` – Die neuen Helper-TypedDicts, Guard-Metriken und Cache-Snapshots bestehen die strenge Typprüfung.【fc571c†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/door_sensor_manager.py tests/unit/test_door_sensor_manager.py` – Die Türsensor-Normalisierung nutzt jetzt `DoorSensorSettingsInput`-, `DoorSensorSettingsPayload`- und `DoorSensorConfigUpdate`-Aliase, während `_coerce_*` ohne `Any`-Parameter auskommt und Persistenzpfade klar getypte Payloads erzeugen.【F:custom_components/pawcontrol/types.py†L430-L479】【F:custom_components/pawcontrol/types.py†L4612-L4616】【F:custom_components/pawcontrol/door_sensor_manager.py†L83-L318】【F:custom_components/pawcontrol/door_sensor_manager.py†L684-L733】【b955e0†L1-L3】
- ✅ `ruff check custom_components/pawcontrol/optimized_entity_base.py custom_components/pawcontrol/utils.py custom_components/pawcontrol/types.py tests/components/pawcontrol/test_optimized_entity_base.py` – Die optimierte Entity-Basis arbeitet jetzt mit `OptimizedEntityMemoryConfig`, typisierten Cache-Payloads und `DeviceLinkDetails`, während die Test-Fixtures Mock-Koordinatoren casten und Attributschreibungen explizit absichern.【F:custom_components/pawcontrol/optimized_entity_base.py†L25-L175】【F:custom_components/pawcontrol/types.py†L3818-L3878】【F:custom_components/pawcontrol/types.py†L4165-L4191】【F:custom_components/pawcontrol/utils.py†L587-L611】【F:tests/components/pawcontrol/test_optimized_entity_base.py†L89-L205】【F:tests/components/pawcontrol/test_optimized_entity_base.py†L720-L878】【23103c†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_optimized_entity_base.py -q` – Die umfassende Entity-Basis-Suite läuft mit den neuen Typcasts, wiederholten Cache-Prüfungen und Performance-Metriken vollständig grün.【F:tests/components/pawcontrol/test_optimized_entity_base.py†L693-L878】【d85a17†L1-L3】
- ✅ `python -m script.enforce_test_requirements` – Keine zusätzlichen Testabhängigkeiten für die erweiterten Entity-Basis-Prüfungen erforderlich.【1988dd†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/optimized_entity_base.py custom_components/pawcontrol/types.py custom_components/pawcontrol/utils.py tests/components/pawcontrol/test_optimized_entity_base.py` – Die neuen TypedDicts, Casts und Mock-Fixtures bestehen die strenge Typprüfung ohne Suppressions.【F:custom_components/pawcontrol/optimized_entity_base.py†L25-L907】【F:custom_components/pawcontrol/types.py†L3818-L4191】【F:custom_components/pawcontrol/utils.py†L587-L611】【F:tests/components/pawcontrol/test_optimized_entity_base.py†L89-L878】【12f1b1†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_door_sensor_manager.py -q` – Die Unit-Tests casten gespeicherte Overrides zu `DoorSensorSettingsPayload`, prüfen die neuen Override-Aliase und sichern persistierte Updates gegen Regressionen ab.【F:tests/unit/test_door_sensor_manager.py†L5-L197】【F:tests/unit/test_door_sensor_manager.py†L265-L377】【1655f3†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Abhängigkeiten für die erweiterten Türsensor-Typprüfungen erforderlich.【153093†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/door_sensor_manager.py tests/unit/test_door_sensor_manager.py` – Die getypten Settings-Overrides, Persistenzhelfer und Tests bestehen die strenge Typprüfung ohne `Any`-Fallbacks.【F:custom_components/pawcontrol/door_sensor_manager.py†L83-L733】【F:tests/unit/test_door_sensor_manager.py†L5-L377】【59a013†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/diagnostics_redaction.py custom_components/pawcontrol/diagnostics.py custom_components/pawcontrol/coordinator_support.py custom_components/pawcontrol/types.py tests/test_diagnostics.py` – Die Redaktions-Helfer operieren jetzt vollständig auf `JSONValue`-/`JSONMutable*`-Aliasen, die Koordinator-Protokolle fordern `Mapping[str, object]` statt `Any`, und die Modul-Konverter akzeptieren nur noch objektbasierte Payloads für saubere PEP-695-Generics.【F:custom_components/pawcontrol/diagnostics_redaction.py†L21-L63】【F:custom_components/pawcontrol/coordinator_support.py†L76-L90】【F:custom_components/pawcontrol/coordinator_support.py†L332-L350】【F:custom_components/pawcontrol/types.py†L1120-L1159】【142c33†L1-L4】
- ✅ `PYTHONPATH=. pytest tests/test_diagnostics.py -q` – Der Redaktions-Test lädt die Helfer weiterhin dynamisch, profitiert aber nun von getypten Loader-Rückgaben und bestätigt die neuen JSON-Guardrails.【F:tests/test_diagnostics.py†L13-L46】【c11851†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Testabhängigkeiten für die erweiterten Redaktions- und Koordinator-Typprüfungen erforderlich.【d6b15b†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/diagnostics_redaction.py custom_components/pawcontrol/diagnostics.py custom_components/pawcontrol/coordinator_support.py custom_components/pawcontrol/types.py tests/test_diagnostics.py` – Die JSON-basierten Redaktionspfade, die Mapping-Protokolle und die modulare Koerzierung bestehen die strengen Typkontrollen ohne `Any`-Fallback.【F:custom_components/pawcontrol/diagnostics_redaction.py†L21-L63】【F:custom_components/pawcontrol/diagnostics.py†L611-L618】【F:custom_components/pawcontrol/coordinator_support.py†L76-L90】【F:custom_components/pawcontrol/types.py†L1120-L1159】【24db59†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/diagnostics.py tests/unit/test_diagnostics_setup_flags.py` – Das Setup-Flag-Panel bleibt lint-frei, während die neuen Tests Übersetzungs-Fallbacks und Quellzählungen absichern.【F:custom_components/pawcontrol/diagnostics.py†L296-L358】【F:tests/unit/test_diagnostics_setup_flags.py†L1-L149】【ca15d0†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_diagnostics_setup_flags.py -q` – Die gezielte Regression deckt `_async_build_setup_flags_panel` inklusive Übersetzungs-Fallbacks, Aktivierungszähler und Quell-Breakdown ab.【F:tests/unit/test_diagnostics_setup_flags.py†L1-L149】【997f00†L1-L8】
- ✅ `ruff check custom_components/pawcontrol/missing_sensors.py tests/unit/test_missing_sensor_telemetry.py` – Die Zusatzsensor-Helfer erzwingen jetzt ein Mapping-Protokoll, casten Modul-Payloads gezielt zu ihren TypedDicts und nutzen `DateTimeConvertible`, sodass Health-, Feeding- und Walk-Berechnungen ohne `Any`-Fallbacks laufen.【F:custom_components/pawcontrol/missing_sensors.py†L5-L420】【F:custom_components/pawcontrol/missing_sensors.py†L423-L610】【85022a†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_missing_sensor_telemetry.py -q` – Die Telemetrie-Helper bleiben regressionsfrei und decken weiterhin Aktivitäts-, Kalorien-, Zeit- und Terminberechnungen ab.【F:tests/unit/test_missing_sensor_telemetry.py†L1-L84】【2974b7†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – Für die Mapping- und Casting-Anpassungen sind keine neuen Testabhängigkeiten notwendig.【ac2950†L1-L1】【c4e4fe†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/missing_sensors.py tests/unit/test_missing_sensor_telemetry.py` – Die Mapping-Prüfungen und TypedDict-Casts passieren die strikte Typprüfung ohne Suppressions.【F:custom_components/pawcontrol/missing_sensors.py†L5-L610】【5e83a6†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/discovery.py tests/unit/test_discovery.py` – Die Discovery-Helfer liefern jetzt PEP-695-Typalias, dedizierte Capability-Listen für alle Kategorien und priorisieren die erweiterten Heuristiken ohne neue Lint-Verstöße.【F:custom_components/pawcontrol/discovery.py†L32-L135】【F:custom_components/pawcontrol/discovery.py†L329-L402】【29ccc2†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_discovery.py -q` – Die Suite deckt sowohl den Legacy-Export als auch die neuen Kategorie-Heuristiken für `smart_collar`, `treat_dispenser`, `water_fountain`, `camera` und `door_sensor` ab.【F:tests/unit/test_discovery.py†L22-L190】【105a7d†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Für die Discovery-Typisierung sind keine zusätzlichen Testabhängigkeiten erforderlich.【8e0781†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/discovery.py tests/unit/test_discovery.py` – Die neuen Discovery-TypedDicts und der Legacy-Test bestehen die strenge Typprüfung ohne Suppressions.【F:custom_components/pawcontrol/discovery.py†L38-L392】【d514a7†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/garden_manager.py tests/unit/test_garden_manager_snapshot.py tests/unit/test_services.py` – Der Garden-Manager persistiert Sitzungs- und Statistikdaten jetzt über strukturierte TypedDict-Payloads, und die Service-Stubs akzeptieren typisierte Aktivitätssequenzen für Sessions.【F:custom_components/pawcontrol/garden_manager.py†L53-L191】【F:tests/unit/test_services.py†L420-L454】【19f2ea†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_garden_manager_snapshot.py -q` – Neue Roundtrip-Tests sichern, dass Aktivitäten- und Sitzungs-Payloads die TypedDict-Hilfen ohne Informationsverlust nutzen.【F:tests/unit/test_garden_manager_snapshot.py†L108-L161】【b9db64†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_services.py -k garden -q` – Die Garden-Service-Telemetrie verarbeitet die typisierten Aktivitätslisten weiterhin erfolgreich.【F:tests/unit/test_services.py†L420-L454】【7afe03†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – Für die erweiterten Garden-Typprüfungen sind keine zusätzlichen Testabhängigkeiten erforderlich.【57dba6†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/garden_manager.py tests/unit/test_garden_manager_snapshot.py` – Die neuen Garden-TypedDicts und Roundtrip-Tests bestehen die strikte Typprüfung.【F:custom_components/pawcontrol/garden_manager.py†L53-L489】【F:tests/unit/test_garden_manager_snapshot.py†L108-L161】【aba850†L1-L3】
- ✅ `ruff check custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Der Validator modelliert JSON-Payloads jetzt über rekursive `JSONValue`-/`JSONSequence`-Aliase, sodass Capability-Parsing ohne `object`-Fallbacks läuft und Tuple- sowie Leerliste-Szenarien abgedeckt sind.【F:custom_components/pawcontrol/api_validator.py†L33-L87】【F:custom_components/pawcontrol/api_validator.py†L460-L487】【4aa0f7†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_api_validator.py -q` – Die neuen Tests sichern Tupel- und Leerlisten-Capabilities sowie die bestehenden Fehlerpfade des Validators.【F:tests/unit/test_api_validator.py†L93-L214】【9c0fcc†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – Keine zusätzlichen Testabhängigkeiten für die erweiterten Validator-Tests nötig.【506f06†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Die rekursiven JSON-Aliase bestehen die Typprüfung gemeinsam mit den neuen Capability-Tests.【F:custom_components/pawcontrol/api_validator.py†L33-L487】【F:tests/unit/test_api_validator.py†L1-L214】【e30187†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Der Validator nutzt jetzt `_APIAuthPayload`- und `_RequestOptions`-TypedDicts sowie das `JSONMapping`-Alias, sodass Reachability- und Auth-Proben ohne `Any`-Fallbacks laufen und Capabilities weiterhin normalisiert werden.【F:custom_components/pawcontrol/api_validator.py†L33-L83】【F:custom_components/pawcontrol/api_validator.py†L265-L364】【fd02f0†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_api_validator.py -q` – Die Dummy-Session bestätigt, dass getypte Auth-Payloads fehlertolerant verarbeitet werden und nur String-Capabilities in die Ergebnisse einfließen.【F:tests/unit/test_api_validator.py†L1-L165】【2d93ea†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Testabhängigkeiten für die aktualisierten Validator-Szenarien erforderlich.【8b10d1†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Die neuen TypedDicts bestehen die Typprüfung und schützen die aiohttp-Aufrufe ohne breit getypte Keyword-Argumente.【F:custom_components/pawcontrol/api_validator.py†L33-L364】【06e847†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Der Validator teilt sich jetzt das PEP-695-`CapabilityList`-Alias und eine `AUTH_SUCCESS_STATUS_CODES`-Konstante, wodurch die Authentifizierungslogik ohne doppelte Session-Zweige auskommt und der Capabilities-Parser keine `TypeError` mehr auf String-Sequenzen wirft.【F:custom_components/pawcontrol/api_validator.py†L27-L361】【d9ad63†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_api_validator.py -q` – Die Dummy-Session nutzt streng typisierte Payload-Aliase und deckt weiterhin Capabilities-Filter, JSON-Fehlerpfade und Health-Status ab.【F:tests/unit/test_api_validator.py†L1-L163】【589e0b†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Testabhängigkeiten erforderlich.【c74155†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Die neuen TypedDict-Rückgaben und die Dummy-Session bestehen die strengen Typprüfungen ohne Suppressions.【F:custom_components/pawcontrol/api_validator.py†L33-L461】【F:tests/unit/test_api_validator.py†L1-L163】【574563†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Der Validator liefert jetzt strikt typisierte `APIAuthenticationResult`- und `APIHealthStatus`-Payloads und die Dummy-Aiohttp-Sitzung in den Unit-Tests nutzt einen PEP-695-kompatiblen Kontextmanager für Reachability- und Auth-Proben.【F:custom_components/pawcontrol/api_validator.py†L32-L195】【F:custom_components/pawcontrol/api_validator.py†L252-L362】【F:tests/unit/test_api_validator.py†L1-L163】【f576b7†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_api_validator.py -q` – Die neuen Tests decken JSON-Parsing, Capabilities-Filter und den Authentifizierungsstatus über den stubbed `ClientSession`-Kontext sauber ab.【F:tests/unit/test_api_validator.py†L91-L163】【68eb00†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – Für die API-Validator-Tests werden keine zusätzlichen Abhängigkeiten benötigt.【a33837†L1】【49f658†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/api_validator.py tests/unit/test_api_validator.py` – Die neuen TypedDicts und der Test-Stub bestehen die strenge Typprüfung ohne Suppressions.【F:custom_components/pawcontrol/api_validator.py†L32-L339】【F:tests/unit/test_api_validator.py†L1-L163】【76f7c9†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/dashboard_cards.py custom_components/pawcontrol/dashboard_shared.py custom_components/pawcontrol/person_entity_manager.py custom_components/pawcontrol/types.py` – Die Card-Generator-Helfer nutzen jetzt durchgängig PEP-695-Type-Aliase und bleiben lint-frei.【F:custom_components/pawcontrol/dashboard_cards.py†L80-L85】【54f46a†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_cards.py tests/unit/test_person_entity_manager.py -q` – Die aktualisierten Card- und Person-Storage-Typen bestehen die gezielten Regressionstests.【F:custom_components/pawcontrol/dashboard_cards.py†L80-L85】【F:custom_components/pawcontrol/person_entity_manager.py†L126-L187】【9f8a34†L1-L10】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol/dashboard_cards.py custom_components/pawcontrol/dashboard_shared.py custom_components/pawcontrol/person_entity_manager.py custom_components/pawcontrol/types.py` – `CardModConfig` wohnt jetzt zentral in `types.py`, die Dashboard-Vorlagen nutzen typisierte Card-Mod-Stile und der Notification-Cache ist annotiert.【F:custom_components/pawcontrol/types.py†L1499-L1514】【F:custom_components/pawcontrol/dashboard_templates.py†L1031-L1050】【F:custom_components/pawcontrol/notifications.py†L567-L575】【a7e9fc†L1-L1】
- ✅ `ruff check` – Dashboard-Karten und Person-Manager nutzen jetzt `LovelaceCardConfig`- und Storage-TypedDicts ohne neue Lint-Verstöße.【F:custom_components/pawcontrol/dashboard_shared.py†L5-L24】【F:custom_components/pawcontrol/person_entity_manager.py†L126-L187】【376015†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_person_entity_manager.py tests/unit/test_dashboard_cards.py -q` – Getypte Personen-Snapshots und globale Dashboard-Statistiken bleiben regressionsfrei.【F:custom_components/pawcontrol/person_entity_manager.py†L126-L187】【F:custom_components/pawcontrol/dashboard_cards.py†L3050-L3060】【099eb4†L1-L11】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – alle Module bestehen die Vollprüfung nach den Lovelace- und Benachrichtigungs-Typfixes.【F:custom_components/pawcontrol/dashboard_templates.py†L3340-L3399】【F:custom_components/pawcontrol/dashboard_cards.py†L774-L803】【a7e9fc†L1-L1】
- ✅ `ruff check` – Config-Flow-Basisvalidierung und getypte Feeding-Defaults bleiben lint-frei.【F:custom_components/pawcontrol/config_flow_base.py†L208-L289】【F:custom_components/pawcontrol/types.py†L1659-L1735】【e4ef32†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_base.py tests/unit/test_config_flow_modules.py -q` – Neue Regressionstests decken Name-Validierung und Feeding-Defaults für den Basis-Flow ab.【F:tests/unit/test_config_flow_base.py†L30-L72】【9a2e0a†L1-L10】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – IntegrationNameValidationResult und FeedingSizeDefaults integrieren sich sauber in die Config-Flows.【F:custom_components/pawcontrol/types.py†L1659-L1735】【F:custom_components/pawcontrol/config_flow_base.py†L208-L289】【fc4916†L1-L1】
- ✅ `ruff check` – Config-Flow-TypedDicts und Platzhalter-Builder bleiben lint-frei.【F:custom_components/pawcontrol/config_flow_modules.py†L137-L249】【639e2d†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_config_flow_modules.py -q` – Neue Konfigurationshelfer-Tests sichern Module-, Dashboard- und Feeding-Coercion ab.【F:tests/unit/test_config_flow_modules.py†L5-L142】【5e0bad†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – Keine zusätzlichen Abhängigkeiten für die Config-Flow-Tests nötig.【c8a4ff†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Config-Flow-Mixe akzeptieren die typisierten Eingaben für Module-, Dashboard- und Feeding-Schritte konsistent.【F:custom_components/pawcontrol/config_flow.py†L1997-L2010】【F:custom_components/pawcontrol/config_flow_dogs.py†L1831-L1884】【F:custom_components/pawcontrol/config_flow_dashboard_extension.py†L123-L216】【612438†L1-L1】
- ✅ `ruff check` – DateTypedDict-Refactor und neue Tests bleiben lint-frei.【f667a9†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_date_entities.py -q` – Date-Entitäten liefern getypte Attribute und Health-Snapshots ohne Regressionen.【e58016†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Abhängigkeiten für die Date-Entitätstests erforderlich.【7eca04†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – DateExtraAttributes und DogProfileSnapshot bestehen die Typprüfung.【75fa10†L1-L1】
- ✅ `ruff check custom_components/pawcontrol/binary_sensor.py tests/components/pawcontrol/test_binary_sensor.py` – Die neuen Wahrheitswert-Shims verhindern, dass geerbte 0/1-Sentinelwerte oder Strings als Alerts durchrutschen, und die Regressionstests bleiben lint-frei.【F:custom_components/pawcontrol/binary_sensor.py†L72-L81】【F:custom_components/pawcontrol/binary_sensor.py†L1393-L1403】【F:custom_components/pawcontrol/binary_sensor.py†L1783-L1792】【F:tests/components/pawcontrol/test_binary_sensor.py†L255-L421】【41a6dc†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_binary_sensor.py -q` – Die zusätzlichen Edge-Case-Szenarien sichern, dass Geofence- und Health-Alerts nur bei echten Booleschen Payloads aktiv werden und fehlerhafte Attribute verworfen werden.【F:tests/components/pawcontrol/test_binary_sensor.py†L255-L421】【67c77f†L1-L5】
- ✅ `ruff check custom_components/pawcontrol/button.py tests/components/pawcontrol/test_button_edge_cases.py` – Walk-Buttons werten boolesche Flags jetzt konsistent aus und melden unbekannte Werte nur noch im Debug-Log, während die neue Regression lint-frei bleibt.【F:custom_components/pawcontrol/button.py†L65-L118】【F:custom_components/pawcontrol/button.py†L1291-L1424】【F:tests/components/pawcontrol/test_button_edge_cases.py†L1-L193】【5f6620†L1-L5】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_button_edge_cases.py -q` – Die Suite prüft Start-/End-Verfügbarkeit, Service-Aufrufe sowie Fehlerpfade (`WalkAlreadyInProgressError`/`WalkNotInProgressError`) unter Wahrheitswert-Varianten.【F:tests/components/pawcontrol/test_button_edge_cases.py†L39-L193】【3e1f49†L1-L9】
- ✅ `ruff check custom_components/pawcontrol/button.py tests/components/pawcontrol/test_button_snapshots.py` – Die Button-Basis behält typisierte Extra-Attribute, während die neue Snapshot-Suite Cache-Erneuerung und Modul-Casts lint-frei belegt.【F:custom_components/pawcontrol/button.py†L780-L868】【F:custom_components/pawcontrol/button.py†L1312-L1964】【F:tests/components/pawcontrol/test_button_snapshots.py†L1-L133】【14ba4a†L1-L3】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_button_snapshots.py -q` – Die Regression verifiziert `ButtonExtraAttributes`, Modul-Snapshots und Cache-Refresh-Verhalten ohne Regressionen.【F:tests/components/pawcontrol/test_button_snapshots.py†L68-L133】【af0c6f†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Pakete für die Binärsensor-Regressionstests erforderlich.【96fb44†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – die Binärsensor-Helfer bestehen die strengen Typprüfungen nach den neuen Guards.【253fe8†L1-L1】
- ✅ `ruff check` – Runtime-Performance-TypedDicts und Stat-Helper bestehen den Import- und Snapshot-Refactor ohne Lint-Verstöße.【719e80†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_services.py -q` – Daily-Reset- und Service-Telemetrie halten die neuen Performance-Buckets stabil.【c1e461†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_system_health.py -q` – System-Health-Diagnostik konsumiert die typisierten Runtime-Stats ohne Regressionen.【7e89d0†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_generator.py -q` – Dashboard-Metriken nutzen die getypten Performance-Exporte erfolgreich.【802505†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_diagnostics.py -q` – Diagnostikoberflächen lesen die strukturierten Performance-Statistiken korrekt.【d08e52†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – RuntimePerformanceStats und die neuen Helper bestehen die strengen Typanforderungen.【1dd0c3†L1-L1】
- ✅ `ruff check` – Button-Telemetrie und Cache-Helfer bleiben lint-frei nach der neuen TypedDict-Integration.【ab2ddb†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_all_platforms.py -q` – Button-Plattform und Garden-Steuerungen bestehen die typisierten Snapshot-Anpassungen.【2b30a7†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Button-Extras, Modul-Casts und Zeitparser erfüllen die strengen Typregeln.【fb65da†L1-L1】
- ✅ `ruff check` – Select-Plattform und Tracking-Presets bleiben lint-frei nach der JSON-TypedDict-Umstellung.【a42645†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_select_entities.py -q` – GPS- und Benachrichtigungs-Selects persistieren die neuen Snapshot-Casts ohne Regressionen.【b7aa00†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – SelectExtraAttributes, Manager-Casts und Tracking-Konfigurationen bestehen die strenge Typprüfung.【689bcf†L1-L1】
- ✅ `ruff check` – Performance- und Wartungs-Telemetrie laufen lint-frei nach der neuen MaintenanceMetadataPayload-Typisierung.【dec77b†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_performance.py -q` – Performance-Tracker-Änderungen bleiben regressionsfrei und behalten die Benchmarks stabil.【06c6d1†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_entity_performance_scaling.py -q` – Skalierungs-Benchmarks akzeptieren die JSON-typisierten Maintenance-Metadaten ohne Ausreißer.【ab19e4†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine neuen Abhängigkeiten für die Performance-Tests erforderlich.【25ba70†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Maintenance-Metadaten und Coordinator-Tasks sind jetzt streng typisiert.【a8bf56†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – scheitert weiterhin ohne das vendorte PyYAML-Modul; Laufzeitfehler dokumentiert.【894a6d†L1-L26】
- ✅ `ruff check` – GPS-Tracker-Telemetrie und Export-Payloads bleiben lint-frei nach der Umstellung auf TypedDict-Attribute.【f5ac08†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_device_tracker.py -q` – neue GPS-Tracker-Regressionen sichern attribut- und exportbezogene TypedDicts ab.【d1238c†L1-L9】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Abhängigkeiten für die Device-Tracker-Tests erforderlich.【d8e833†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – die getypten Tracker-Attribute und Exporter bestehen die strengen Typvorgaben.【a413ff†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – schlägt weiterhin ohne das vendorte PyYAML-Modul fehl; Container-Limitation dokumentiert.【7a218d†L1-L25】
- ✅ `ruff check` – Health-Calculator- und Feeding-Manager-Refactors laufen lint-frei.【464a8a†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_health_calculator_quality.py tests/unit/test_feeding_manager.py -q` – typisierte Feeding-Historie und Gesundheitsberichte bestehen die Regressionen.【472f2c†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten für die neuen Health-Telemetrie-Tests erforderlich.【646c05†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Feeding- und Health-TypedDicts erfüllen die strengen Typvorgaben.【9fa2a6†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – schlägt weiterhin ohne das vendorte PyYAML-Modul fehl.【aca346†L1-L27】
- ✅ `ruff check` – Feeding-TypedDict-Refactor und Manager-Snapshots bleiben lint-frei.【0ff8bd†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_feeding_manager.py -q` – Feeding-Snapshots und Statistik-Caches liefern strukturierte Payloads ohne Regressionen.【34123e†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Abhängigkeiten für die Feeding-Tests erforderlich.【6801a4†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – FeedingSnapshot-, Statistik- und Adapter-Payloads bestehen die strenge Typprüfung.【c8e1e5†L1-L2】
- ✅ `ruff check` – Dashboard-Karten-Optionen und Renderer-Casts bleiben lint-frei nach den neuen TypedDict-Refactors.【d88f6d†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_cards.py -q` – neue Karten-Helper-Tests sichern Themauswahl und Performance-Statistik-Snapshots.【934ba6†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Abhängigkeiten für die Dashboard-Karten-Regressionen erforderlich.【5cd65a†L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Kartenoptionen und Renderer-Signaturen bleiben streng typisiert.【8e2cb4†L1-L2】
- ✅ `ruff check` – Number-Attribute-Payloads und Coordinator-Dog-Daten bleiben lint-frei nach den neuen JSON-Aliasen.【714c29†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_missing_sensor_telemetry.py -q` – Regressionen für die typisierten Entity-Attribute bleiben grün und spiegeln die aktualisierten Number-Helfer wider.【caebd2†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Entity-Attribute-Generics und die erweiterten CoordinatorDogData-Snapshots bestehen die strenge Typprüfung.【b18978†L1-L2】
- ✅ `ruff check` – Render-Job-Generics, Dashboard-Casts und Switch-Attribute laufen lint-frei durch die neue Typisierung.【c1c7a3†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_dashboard_renderer.py tests/unit/test_dashboard_generator.py tests/unit/test_dashboard_templates.py tests/components/pawcontrol/test_all_platforms.py -q` – Renderer-, Generator-, Template- und Plattform-Flows bestehen die typisierten Lovelace-/Switch-Änderungen.【dc90c7†L1-L9】【213752†L1-L3】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Testabhängigkeiten für die Renderer- und Dashboard-Suites nötig.【c29639†L1】【8d26f8†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – neue Dashboard- und Switch-TypedDicts bestehen die strenge Typprüfung.【4b8995†L1】【98a1de†L1-L2】
- ✅ `ruff check` – Geofencing-Storage und Benachrichtigungs-TypedDicts bleiben lint-frei.【a6306a†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_geofencing.py -q` – die Suite prüft jetzt Metadaten-Sanitisierung, Legacy-Listen-Speicher, persistente Storage-Roundtrips und Benachrichtigungs-Payloads für Geofences.【F:tests/unit/test_geofencing.py†L17-L148】【0cb7da†L1-L10】
- ✅ `python -m script.enforce_test_requirements && echo "requirements ok"` – keine zusätzlichen Testabhängigkeiten für die Geofencing-Regressionen notwendig.【371114†L1-L2】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – typisierte Geofencing-Speicherpfade bestehen die strenge Typprüfung.【2b5409†L1-L2】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – scheitert weiterhin ohne PyYAML-Vendorpaket; Laufzeitfehler dokumentiert.【fe0b83†L1-L26】
- ✅ `ruff check custom_components/pawcontrol/geofencing.py tests/unit/test_geofencing.py` – Metadaten-Sanitisierung und Legacy-Storage-Pfade bleiben lint-frei.【F:custom_components/pawcontrol/geofencing.py†L1-L362】【aa5405†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_gps_manager.py -q` – GPS-Manager liefert strukturierte Snapshots und Export-Payloads mit TypedDicts.【2802b7†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – neue Geofence- und Export-Typen bestehen die strenge Typprüfung.【f39573†L1-L2】
- ✅ `ruff check` – Service-Guard-Typisierung und Guard-Verlaufsnormalisierung bleiben lint-frei.【8fe70f†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_service_guard.py tests/unit/test_services.py tests/unit/test_dashboard_generator.py tests/unit/test_coordinator_tasks.py -q` – Guard-Snapshots, Service-Aggregation und Dashboard-Metriken laufen grün.【7b19a5†L1-L5】
- ✅ `PYTHONPATH=. pytest tests/unit/test_dashboard_templates.py -q` – Template-Renderer und Guard-Anzeige bleiben stabil.【90465a†L1-L9】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten notwendig.【aee9df†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Service-Guard-Payloads und Dashboard-Formatter erfüllen die strengen Typvorgaben.【d947d9†L1-L2】
- ✅ `ruff check` – Storage-Namespace-Typisierung und Cache-Generics bleiben lint-frei.【98a381†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_helpers.py tests/unit/test_data_manager.py -q` – Storage-Cache- und Namespace-Guards bestehen die Regressionen.【f88535†L1-L10】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten für die Storage-Typisierung erforderlich.【c31eb2†L1-L1】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – StorageNamespace-Payloads und Cache-Werte erfüllen die strengen Typvorgaben.【675f65†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – schlägt weiterhin ohne PyYAML-Vendorpaket fehl.【1f7a1d†L1-L27】
- ✅ `ruff check` – Missing-Sensor-Telemetrie und Protokoll-Helper bestehen den Lint-Durchlauf.【996c09†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/unit/test_missing_sensor_telemetry.py -q` – neue Helper-Tests decken Aktivitäts-, Kalorien- und Zeitberechnungen ab.【1e4aa5†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – Protokoll-gestützte Modulzugriffe und Sensor-Hilfsfunktionen sind streng typisiert.【dfdda4†L1-L2】
- ✅ `ruff check custom_components/pawcontrol/helpers.py custom_components/pawcontrol/types.py` – Health- und Walk-Namespaces bestehen die neuen TypedDict-Lint-Gates ohne Beanstandungen.【20ae77†L1-L1】
- ✅ `PYTHONPATH=. pytest tests/unit/test_data_manager.py -q` – die helpergestützte Speicher-Hydrierung verarbeitet Health- und Walk-Historien weiterhin korrekt.【4f2864†L1-L9】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_data_manager.py -q` – Options- und Storage-Flows behalten ihre Laufzeitkompatibilität mit den typisierten Walk-Ereignissen.【60341c†L1-L9】
- ✅ `mypy --config-file pyproject.toml --follow-imports=skip custom_components/pawcontrol/helpers.py custom_components/pawcontrol/types.py` – neue Storage-Aliasse und Walk-Start-Payloads bestehen die strenge Typprüfung.【7ee94f†L1-L1】
- ✅ `python -m script.enforce_test_requirements` – keine zusätzlichen Testabhängigkeiten für die neuen Telemetrie-Tests erforderlich.【933c35†L1-L1】
- ⚠️ `python -m script.hassfest --integration-path custom_components/pawcontrol` – Lauf scheitert weiterhin ohne PyYAML-Stub und benötigt das Vendor-Paket für den Loader.【ff1743†L1-L27】
- ✅ `ruff check` – System-Health-Typisierung und Listener-Normalisierung bestehen den Lint-Durchlauf.【f7d063†L1-L2】
- ✅ `PYTHONPATH=. pytest tests/components/pawcontrol/test_system_health.py -q` – Manuelle Events, Resilience-Script-Threshholds und die Breaker-Übersicht bleiben stabil; neue Tests prüfen die Schwellenwertauflösung sowie die serialisierte Breaker-Indikatorausgabe.【F:tests/components/pawcontrol/test_system_health.py†L357-L460】【74e515†L1-L9】
- ✅ `mypy --config-file pyproject.toml custom_components/pawcontrol` – System-Health- und Script-Manager-Typisierung bleibt streng.【b1601d†L1-L2】
- ✅ `ruff check` – neue Storage- und Performance-Snapshots bleiben lint-frei.【9ad2b2†L1-L1】

## Offene Fehler und Verbesserungen

### Fehler-Backlog

- [ ] **Dokumentationsspiegel komplettieren:** Fehlende Sync-Nachweise in der Einsatzhistorie und divergierende README-/Info-Abschnitte verhindern eine lückenlose Platinum-Dokumentation; nach jedem Content-Update den Contributor-Guide-Sync fahren, die Markdown-Review-Checkliste abhaken und Links zu den Läufen im Wochenprotokoll nachtragen.【F:.github/copilot-instructions.md†L29-L53】【F:script/sync_contributor_guides.py†L1-L92】【F:docs/markdown_compliance_review.md†L1-L60】
  - Verantwortliche Scribes protokollieren jeden Sync-Lauf inklusive Commit-Hash und Step-Summary, damit die Einsatzhistorie rekonstruierbar bleibt (`python -m script.sync_contributor_guides`).
  - README, `info.md`, Produktions- und Compliance-Dokumentation direkt nach dem Sync mit der Markdown-Checkliste spiegeln und Abweichungen mit Fundstellen im Artefakt-Log dokumentieren.【F:README.md†L31-L53】【F:info.md†L101-L114】【F:docs/production_integration_documentation.md†L636-L669】
  - Fehlende Belege werden als Eskalation im Wochenprotokoll verlinkt, bis sowohl die Markdown-Checkliste als auch der Sync-Lauf mit Evidenz hinterlegt sind.
- [ ] **Quality-Gate-Vollsuiten terminieren:** Die reservierten `scheduled-pytest`-Slots und der CI-`TypedDict audit` benötigen eine verantwortliche Rotation, die Laufprotokolle sammelt, Findings dokumentiert und Regressionen sofort mit `pytest -q`, `mypy` und `ruff check` adressiert.【F:.github/workflows/scheduled-pytest.yml†L1-L55】【F:.github/workflows/ci.yml†L1-L67】【F:.github/copilot-instructions.md†L31-L53】
  - Vor jedem Slot Ownership bestätigen, Step-Summaries sichern und Regressionen mit lokalen Gegenläufen (`pytest -q`, `mypy`, `ruff check`) inklusive Artefakt-Links schließen.
  - TypedDict-Funde direkt im Audit-Issue katalogisieren, erforderliche Type-Aliasse in `custom_components/pawcontrol/types.py` ergänzen und `python script/check_typed_dicts.py` erneut ausführen, bis der Guard sauber ist.【F:script/check_typed_dicts.py†L1-L187】【F:custom_components/pawcontrol/types.py†L1-L6332】
  - Ergebnisse und Eskalationen im Wochenprotokoll referenzieren, damit Rotation und Nachverfolgung transparent bleiben.
- [ ] **Anleitungsspiegel aktuell halten:** Nach jeder Änderung an `.github/copilot-instructions.md` konsequent `python -m script.sync_contributor_guides` laufen lassen und den Sync-Status im PR verlinken, damit die Claude- und Gemini-Handbücher automatisch auf demselben Stand bleiben.【F:.github/copilot-instructions.md†L1-L160】【F:script/sync_contributor_guides.py†L1-L92】

### Verbesserungs-Backlog

- [ ] **Guard-Alerts in Dashboard & Config-Flow visualisieren:** Die neuen `level_duration_guard_alerts` aus Telemetrie, Diagnostics und Repairs müssen in den Dashboard-Templates und im Config-/Options-Flow auftauchen (z. B. opt-in Badge/Markdown-Karte sowie neue Strings für Alarm-Schwellen). Die UI soll Nutzer*innen warnen, sobald `p95`-Dauern definierte Guard-Ranges überschreiten und ein Lovelace-Update auslösen.【F:custom_components/pawcontrol/dashboard_templates.py†L1-L2740】【F:custom_components/pawcontrol/telemetry.py†L300-L520】【F:custom_components/pawcontrol/strings.json†L1330-L1405】
  - Dashboard-Renderer, Templates und Markdown-Karten um Guard-Alert-Badges ergänzen, inklusive Tests in `tests/components/pawcontrol/test_dashboard_renderer.py` und `tests/components/pawcontrol/test_dashboard_templates.py`.
  - Config-/Options-Flows um ein Opt-in für Guard-Alarme erweitern, damit Anwender*innen Dashboard-Markierungen gezielt aktivieren können (`custom_components/pawcontrol/config_flow.py`, `custom_components/pawcontrol/options_flow.py`).
  - Dokumentation und Release-Notizen aktualisieren, sobald Lovelace-/Repair-Änderungen veröffentlicht werden, und die bestehenden Guard-Evidenzen in `docs/diagnostik.md` spiegeln.
## Monitoring & Rhythmus
- Durchlaufe monatlich die Aufgaben aus `docs/MAINTENANCE.md`, damit Lokalisierungen, Diagnostik und Qualitätsnachweise aktuell bleiben.【F:docs/MAINTENANCE.md†L1-L40】
- Aktualisiere nach Feature-Änderungen die Contributor-Guides per `python -m script.sync_contributor_guides`, damit alle Assistenten dieselben Richtlinien ausliefern.【F:script/sync_contributor_guides.py†L1-L92】
